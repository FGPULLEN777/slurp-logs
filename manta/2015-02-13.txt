{"nick":"trentm","reason":"Quit: Leaving.","date":"2015-02-13T01:03:53.946Z","type":"quit"}
{"nick":"chorrell","date":"2015-02-13T01:04:20.335Z","type":"join"}
{"nick":"pmooney","reason":"Ping timeout: 252 seconds","date":"2015-02-13T01:09:12.911Z","type":"quit"}
{"nick":"dap_","reason":"Quit: Leaving.","date":"2015-02-13T01:14:23.557Z","type":"quit"}
{"nick":"ryancnelson","reason":"Quit: Leaving.","date":"2015-02-13T01:18:38.729Z","type":"quit"}
{"nick":"ed209","reason":"Remote host closed the connection","date":"2015-02-13T01:20:01.160Z","type":"quit"}
{"nick":"ed209","date":"2015-02-13T01:20:08.358Z","type":"join"}
{"nick":"nfitch","reason":"Ping timeout: 245 seconds","date":"2015-02-13T01:26:29.598Z","type":"quit"}
{"nick":"pgale","reason":"Quit: Leaving.","date":"2015-02-13T01:26:47.986Z","type":"quit"}
{"nick":"fredk","reason":"Quit: Leaving.","date":"2015-02-13T01:26:55.349Z","type":"quit"}
{"nick":"nfitch","date":"2015-02-13T01:39:17.968Z","type":"join"}
{"nick":"chorrell","reason":"Read error: Connection reset by peer","date":"2015-02-13T01:42:13.165Z","type":"quit"}
{"nick":"chorrell","date":"2015-02-13T01:43:58.337Z","type":"join"}
{"nick":"chorrell","reason":"Client Quit","date":"2015-02-13T01:45:51.656Z","type":"quit"}
{"nick":"nfitch","reason":"Remote host closed the connection","date":"2015-02-13T02:11:10.183Z","type":"quit"}
{"nick":"pmooney","date":"2015-02-13T03:10:46.225Z","type":"join"}
{"nick":"pmooney","reason":"Ping timeout: 240 seconds","date":"2015-02-13T03:15:22.938Z","type":"quit"}
{"nick":"marsell","reason":"Quit: marsell","date":"2015-02-13T03:48:49.990Z","type":"quit"}
{"nick":"bahamas10","reason":"Ping timeout: 245 seconds","date":"2015-02-13T06:21:29.685Z","type":"quit"}
{"nick":"_Tenchi_","date":"2015-02-13T06:53:06.443Z","type":"join"}
{"nick":"bixu_","date":"2015-02-13T08:46:22.020Z","type":"join"}
{"nick":"bixu_","reason":"Remote host closed the connection","date":"2015-02-13T10:11:11.028Z","type":"quit"}
{"nick":"bixu_","date":"2015-02-13T10:11:37.689Z","type":"join"}
{"nick":"bixu_","new_nick":"bixu","date":"2015-02-13T10:12:56.852Z","type":"nick"}
{"nick":"|woody|","reason":"Quit: ZNC - http://znc.in","date":"2015-02-13T10:14:51.433Z","type":"quit"}
{"nick":"|woody|","date":"2015-02-13T10:15:45.675Z","type":"join"}
{"nick":"bixu_","date":"2015-02-13T10:17:41.409Z","type":"join"}
{"nick":"bixu_","reason":"Client Quit","date":"2015-02-13T10:18:58.439Z","type":"quit"}
{"nick":"bixu_","date":"2015-02-13T10:19:16.412Z","type":"join"}
{"nick":"ed209","reason":"Remote host closed the connection","date":"2015-02-13T10:20:00.551Z","type":"quit"}
{"nick":"ed209","date":"2015-02-13T10:20:07.337Z","type":"join"}
{"nick":"bixu","reason":"Ping timeout: 245 seconds","date":"2015-02-13T10:21:07.708Z","type":"quit"}
{"nick":"bixu_","new_nick":"bixu","date":"2015-02-13T10:41:53.324Z","type":"nick"}
{"nick":"xmerlin","date":"2015-02-13T10:59:53.925Z","type":"join"}
{"nick":"bixu","reason":"Remote host closed the connection","date":"2015-02-13T11:20:07.323Z","type":"quit"}
{"nick":"bixu","date":"2015-02-13T11:20:33.396Z","type":"join"}
{"nick":"pmooney","date":"2015-02-13T11:23:52.625Z","type":"join"}
{"nick":"bixu_","date":"2015-02-13T11:24:51.670Z","type":"join"}
{"nick":"bixu","reason":"Ping timeout: 264 seconds","date":"2015-02-13T11:28:01.381Z","type":"quit"}
{"nick":"pmooney","reason":"Ping timeout: 246 seconds","date":"2015-02-13T11:28:12.038Z","type":"quit"}
{"nick":"bixu_","new_nick":"bixu","date":"2015-02-13T12:18:57.760Z","type":"nick"}
{"nick":"marsell","date":"2015-02-13T12:32:49.604Z","type":"join"}
{"nick":"happy-dude","date":"2015-02-13T13:15:04.752Z","type":"join"}
{"nick":"xmerlin","new_nick":"Guest19071","date":"2015-02-13T14:20:41.857Z","type":"nick"}
{"nick":"pmooney","date":"2015-02-13T15:04:41.210Z","type":"join"}
{"nick":"pgale","date":"2015-02-13T16:13:56.275Z","type":"join"}
{"nick":"trentm","date":"2015-02-13T17:31:43.225Z","type":"join"}
{"nick":"ryancnelson","date":"2015-02-13T17:33:54.082Z","type":"join"}
{"nick":"dap_","date":"2015-02-13T17:36:44.954Z","type":"join"}
{"nick":"ryancnelson","date":"2015-02-13T17:37:53.689Z","type":"part"}
{"nick":"fredk","date":"2015-02-13T18:01:31.249Z","type":"join"}
{"nick":"dap_1","date":"2015-02-13T18:01:35.402Z","type":"join"}
{"nick":"dap_2","date":"2015-02-13T18:03:49.506Z","type":"join"}
{"nick":"dap_","reason":"Ping timeout: 240 seconds","date":"2015-02-13T18:04:52.986Z","type":"quit"}
{"nick":"dap_1","reason":"Ping timeout: 265 seconds","date":"2015-02-13T18:06:26.402Z","type":"quit"}
{"nick":"nfitch_","date":"2015-02-13T18:31:02.936Z","type":"join"}
{"nick":"nfitch_","reason":"Quit: Leaving.","date":"2015-02-13T18:47:05.659Z","type":"quit"}
{"nick":"dap_2","reason":"Quit: Leaving.","date":"2015-02-13T19:02:56.705Z","type":"quit"}
{"nick":"dap_","date":"2015-02-13T19:03:27.926Z","type":"join"}
{"nick":"codecaver","date":"2015-02-13T19:18:05.423Z","type":"join"}
{"nick":"pmooney","reason":"Quit: WeeChat 1.1.1","date":"2015-02-13T19:43:54.946Z","type":"quit"}
{"nick":"bixu","reason":"Remote host closed the connection","date":"2015-02-13T19:53:01.666Z","type":"quit"}
{"nick":"bixu","date":"2015-02-13T19:53:28.330Z","type":"join"}
{"nick":"bixu","reason":"Client Quit","date":"2015-02-13T19:54:07.076Z","type":"quit"}
{"nick":"pmooney","date":"2015-02-13T19:56:32.956Z","type":"join"}
{"nick":"pgale","reason":"Quit: Leaving.","date":"2015-02-13T20:03:38.902Z","type":"quit"}
{"nick":"pgale","date":"2015-02-13T20:07:14.298Z","type":"join"}
{"nick":"nfitch_","date":"2015-02-13T20:10:14.997Z","type":"join"}
{"nick":"nfitch_","message":"Probably off topic here, but the right audience is here, so sorry :/","date":"2015-02-13T20:12:25.930Z","type":"message"}
{"nick":"nfitch_","message":"Anyone tried this lately? https://www.joyent.com/blog/mdb-and-linux","date":"2015-02-13T20:12:41.470Z","type":"message"}
{"nick":"rmustacc","message":"nfitch_: In theory you shouldn't need any of the LD_PRELOAD bits in manta or on recent SmartOS bits.","date":"2015-02-13T20:13:22.869Z","type":"message"}
{"nick":"rmustacc","message":"But what's up?","date":"2015-02-13T20:13:25.863Z","type":"message"}
{"nick":"nfitch_","message":"I have 2 vms running on my mac, one smartos and the other ubuntu, and mdb says the core is \"corrupt or missing required data\".","date":"2015-02-13T20:13:37.599Z","type":"message"}
{"nick":"nfitch_","message":"Ah, I'll try without that...","date":"2015-02-13T20:13:50.869Z","type":"message"}
{"nick":"rmustacc","message":"Depends how recent they are.","date":"2015-02-13T20:14:02.317Z","type":"message"}
{"nick":"rmustacc","message":"But you're supplying both the node binary and the core file?","date":"2015-02-13T20:14:25.894Z","type":"message"}
{"nick":"rmustacc","message":"How'd you generate the core file?","date":"2015-02-13T20:14:29.205Z","type":"message"}
{"nick":"nfitch_","message":"Here are all the commands (as copied when I was trying to repro):","date":"2015-02-13T20:15:14.981Z","type":"message"}
{"nick":"nfitch_","message":"https://gist.github.com/nfitch/cd3e77be6d1851b6780d","date":"2015-02-13T20:15:15.300Z","type":"message"}
{"nick":"nfitch_","message":"Ga, I hate emojis.","date":"2015-02-13T20:15:21.245Z","type":"message"}
{"nick":"nfitch_","message":":)","date":"2015-02-13T20:15:40.542Z","type":"message"}
{"nick":"nfitch_","message":"Ok, much better.","date":"2015-02-13T20:15:44.766Z","type":"message"}
{"nick":"rmustacc","message":"It looks like you didn't copy over the node binary from Ubuntu?","date":"2015-02-13T20:16:37.971Z","type":"message"}
{"nick":"rmustacc","message":"When you specify the node binary, it's not the SmartOS one, you have to specify the one from Linux.","date":"2015-02-13T20:17:03.049Z","type":"message"}
{"nick":"nfitch_","message":"No… ok… that makes more sense, now doesn't it...","date":"2015-02-13T20:17:22.966Z","type":"message"}
{"nick":"nfitch_","message":"Trying...","date":"2015-02-13T20:17:27.745Z","type":"message"}
{"nick":"nfitch_","message":"rm: Yup that worked.  You rock, as always!","date":"2015-02-13T20:18:58.276Z","type":"message"}
{"nick":"rmustacc","message":"No problem, glad it's working.","date":"2015-02-13T20:19:36.275Z","type":"message"}
{"nick":"ed209","reason":"Remote host closed the connection","date":"2015-02-13T20:20:00.857Z","type":"quit"}
{"nick":"ed209","date":"2015-02-13T20:20:07.307Z","type":"join"}
{"nick":"nfitch_","message":"dap_: I was about to ask when the 0.12 debugging blog post was going to come out… but then I saw https://www.joyent.com/blog/debugging-enhancements-in-node-0-12","date":"2015-02-13T20:25:33.278Z","type":"message"}
{"nick":"nfitch_","message":"Much thanks!","date":"2015-02-13T20:25:37.068Z","type":"message"}
{"nick":"dap_","message":"nfitch_: glad it's helpful!","date":"2015-02-13T20:35:16.402Z","type":"message"}
{"nick":"pmooney","reason":"Read error: Connection reset by peer","date":"2015-02-13T20:57:17.684Z","type":"quit"}
{"nick":"pmooney","date":"2015-02-13T20:58:12.518Z","type":"join"}
{"nick":"nfitch_","reason":"Quit: Leaving.","date":"2015-02-13T21:07:08.206Z","type":"quit"}
{"nick":"axisys_away","reason":"Quit: leaving","date":"2015-02-13T21:22:28.243Z","type":"quit"}
{"nick":"axisys","date":"2015-02-13T21:22:53.030Z","type":"join"}
{"nick":"axisys","reason":"Changing host","date":"2015-02-13T21:22:58.196Z","type":"quit"}
{"nick":"axisys","date":"2015-02-13T21:22:58.381Z","type":"join"}
{"nick":"nfitch_","date":"2015-02-13T21:46:25.979Z","type":"join"}
{"nick":"dap_","message":"nfitch_: Someone has ported the guts of manatee v2 to Go: https://github.com/flynn/flynn/pull/986","date":"2015-02-13T21:59:21.114Z","type":"message"}
{"nick":"pmooney","reason":"Ping timeout: 250 seconds","date":"2015-02-13T22:01:28.491Z","type":"quit"}
{"nick":"nfitch_","message":"dap_: Wow.  I mean… just… wow.","date":"2015-02-13T22:06:38.281Z","type":"message"}
{"nick":"nfitch_","message":"dap_: Speaking of which… any major manatee issues lately?","date":"2015-02-13T22:08:02.517Z","type":"message"}
{"nick":"nfitch_","message":"(S'ok if you don't want to discuss :)","date":"2015-02-13T22:08:19.148Z","type":"message"}
{"nick":"dap_","message":"We've had a few issues...","date":"2015-02-13T22:08:38.690Z","type":"message"}
{"nick":"pmooney","date":"2015-02-13T22:09:15.624Z","type":"join"}
{"nick":"dap_","message":"There was this, although it didn't result in any actual problem before we found it:","date":"2015-02-13T22:09:17.286Z","type":"message"}
{"nick":"dap_","message":"https://smartos.org/bugview/MANATEE-252","date":"2015-02-13T22:09:17.590Z","type":"message"}
{"nick":"dap_","message":"We had this one: https://github.com/joyent/manatee/commit/2951be10d8a70b6aebeeb9bb93bc0eb6835a1612","date":"2015-02-13T22:09:50.574Z","type":"message"}
{"nick":"nfitch_","message":"> The system is down at this point, and it's not exactly clear how to recover or finish the upgrade.","date":"2015-02-13T22:12:20.078Z","type":"message"}
{"nick":"nfitch_","message":"You don't.  You roll back.","date":"2015-02-13T22:12:25.913Z","type":"message"}
{"nick":"dap_","message":"We've had some trouble trying to upgrade some ancient manatees, but the problems were only on the ancient bits","date":"2015-02-13T22:12:29.853Z","type":"message"}
{"nick":"dap_","message":"nfitch_: We basically decided that it was better to just leave the cluster frozen.  It can't *actually* recover from a primary failure at that point, so there's no point in allowing it to try, given that it can only result in you having to rollback.","date":"2015-02-13T22:13:38.549Z","type":"message"}
{"nick":"nfitch_","message":"The upgrade procedure assumes you always have the sync to recover from.  Maybe I'm missing something, though…","date":"2015-02-13T22:13:38.848Z","type":"message"}
{"nick":"dap_","message":"Basically, when you reprovision the primary, there's no interlock in the procedure to ensure that the sync was ever actually caught up.","date":"2015-02-13T22:14:02.277Z","type":"message"}
{"nick":"dap_","message":"The interlock in v2 is the initWal value, but that was made up by cluster-backfill.","date":"2015-02-13T22:14:17.111Z","type":"message"}
{"nick":"nfitch_","message":"Right, which is why you have to roll back Z and Y should naturally take over as primary (which is correct).  I thought that's why we had to add cluster state freezing.","date":"2015-02-13T22:15:03.011Z","type":"message"}
{"nick":"dap_","message":"The problem is that the original procedure unfreezed the cluster before there's any guarantee that the sync is actually up to date.","date":"2015-02-13T22:15:27.571Z","type":"message"}
{"nick":"nfitch_","message":"(so that Z wouldn't actually ever take over as primary since we're fibbing that Z could take over).","date":"2015-02-13T22:15:56.937Z","type":"message"}
{"nick":"dap_","message":"Remember that the original async (now on v2) treats itself as the sync, but the *primary* (still on v1) was never actually configured to replicate synchronously to the original async.","date":"2015-02-13T22:16:12.031Z","type":"message"}
{"nick":"nfitch_","message":"Until Y is reprovisioned.  Then Z is promoted in X's eyes to be the sync.  It should catch up.  So the problem was there there was no guarantee that Z actually caught up to X?","date":"2015-02-13T22:17:25.022Z","type":"message"}
{"nick":"dap_","message":"Correct","date":"2015-02-13T22:18:02.374Z","type":"message"}
{"nick":"nfitch_","message":"I can see that… but I thought in the upgrade proceduer an operator was supposed to check cluster state before reprovisioning X...","date":"2015-02-13T22:18:02.803Z","type":"message"}
{"nick":"dap_","message":"Well, the cluster *state* was fine","date":"2015-02-13T22:18:28.786Z","type":"message"}
{"nick":"nfitch_","message":"No, I meant looking at the xlog positions.","date":"2015-02-13T22:18:59.259Z","type":"message"}
{"nick":"nfitch_","message":"And no, I didn't explicitly state to make sure the sync (Z) was making forward progress as a sync.","date":"2015-02-13T22:19:33.474Z","type":"message"}
{"nick":"dap_","message":"If that was there, I think we missed it.","date":"2015-02-13T22:20:12.648Z","type":"message"}
{"nick":"nfitch_","message":"But yeah, I see the problem.  I think the solution on failure is to roll back rather than unfreeze.","date":"2015-02-13T22:20:24.195Z","type":"message"}
{"nick":"nfitch_","message":"No, I just checked.  I didn't say it, only that it should \"look normal\":","date":"2015-02-13T22:20:40.444Z","type":"message"}
{"nick":"nfitch_","message":"https://github.com/joyent/manatee/blob/master/docs/migrate-1-to-2.md#reprovision-sync","date":"2015-02-13T22:20:52.191Z","type":"message"}
{"nick":"dap_","message":"The problem is it's not just a failure… you can get into trouble right up to the very last step when you reprovision X","date":"2015-02-13T22:20:54.401Z","type":"message"}
{"nick":"nfitch_","message":"Right if it's not caught up.","date":"2015-02-13T22:21:14.732Z","type":"message"}
{"nick":"dap_","message":"Yeah.  Anyway, this didn't really cause a problem, and the fix was simple.","date":"2015-02-13T22:21:22.485Z","type":"message"}
{"nick":"dap_","message":"LeftWing and I also decided it was safer to disable morays if possible, but I don't remember which cases he had identified that led to that.","date":"2015-02-13T22:21:53.748Z","type":"message"}
{"nick":"nfitch_","message":"Ok, phew.","date":"2015-02-13T22:22:03.165Z","type":"message"}
{"nick":"dap_","message":"nfitch_: The scariest problem we've run into was not really either of our faults, but it did lead to a considerable outage :( It was basically https://github.com/brianc/node-postgres/issues/718","date":"2015-02-13T22:22:56.017Z","type":"message"}
{"nick":"dap_","message":"We had a health-check query black-hole","date":"2015-02-13T22:23:08.305Z","type":"message"}
{"nick":"nfitch_","message":"Oh?  That would be interesting since they were meant to be backward compatible…","date":"2015-02-13T22:23:12.640Z","type":"message"}
{"nick":"nfitch_","message":"dap_: Oh, that postgres issue is scary… and unfortunate :(","date":"2015-02-13T22:24:03.276Z","type":"message"}
{"nick":"dap_","message":"Yeah… it was totally a client issue.","date":"2015-02-13T22:24:11.808Z","type":"message"}
{"nick":"nfitch_","message":"That's too bad about problems on upgrade… has regular manatee operation been fine otherwise?","date":"2015-02-13T22:25:23.657Z","type":"message"}
{"nick":"dap_","message":"Basically, Manatee issued a health check query to the postgres client when postgres was down (I don't remember why), and then before that query completed, Manatee started a takeover.  (That's all fine so far.)  Eventually the first query failed with 'connect ETIMEDOUT' (again, all fine so far), but the postgres client just ate the second query.  (Basically, the client queues queries and wasn't smart enough to abort the queued query, nor retry it.)  That query was b","date":"2015-02-13T22:28:30.626Z","type":"message"}
{"nick":"nfitch_","message":"https://github.com/flynn/flynn/pull/986  <— is crazy!  I don't know whether to be impressed or… what...","date":"2015-02-13T22:28:58.291Z","type":"message"}
{"nick":"dap_","message":"Anyways, the summary is that the first week or so after upgrading was a little rocky, but Manatee itself has been largely fine.","date":"2015-02-13T22:29:28.580Z","type":"message"}
{"nick":"nfitch_","message":"Eating the query is scary… good to hear it's been fine since :)","date":"2015-02-13T22:30:44.555Z","type":"message"}
{"nick":"dap_","message":"Yeah :)  I think the Go thing is pretty cool.","date":"2015-02-13T22:31:56.742Z","type":"message"}
{"nick":"nfitch_","message":"It's certainly cool to see people pick up the theory, even if they wanted another implementation.","date":"2015-02-13T22:32:41.264Z","type":"message"}
{"nick":"dap_","message":"Yeah.","date":"2015-02-13T22:34:40.229Z","type":"message"}
{"nick":"pgale","reason":"Quit: Leaving.","date":"2015-02-13T22:48:51.286Z","type":"quit"}
{"nick":"marsell","reason":"Ping timeout: 245 seconds","date":"2015-02-13T22:55:14.635Z","type":"quit"}
{"nick":"pmooney","reason":"Quit: WeeChat 1.1.1","date":"2015-02-13T23:27:12.597Z","type":"quit"}
{"nick":"pmooney","date":"2015-02-13T23:41:56.384Z","type":"join"}
{"nick":"nfitch_","message":"Hrmmmm… I must be missing something fundamental on how dmods are delivered and loaded.","date":"2015-02-13T23:57:11.677Z","type":"message"}
{"nick":"nfitch_","message":"I downloaded and ran a node program from the official node binaries: http://nodejs.org/download/","date":"2015-02-13T23:57:44.598Z","type":"message"}
{"nick":"nfitch_","message":"For 0.12, that is.","date":"2015-02-13T23:58:03.352Z","type":"message"}
{"nick":"nfitch_","message":"When I dumped a core and ::load v8, I got the \"old\" dmods.","date":"2015-02-13T23:58:21.999Z","type":"message"}
{"nick":"nfitch_","message":"I had to load the .so bundled to get the \"new\" dmods:","date":"2015-02-13T23:58:45.924Z","type":"message"}
{"nick":"rmustacc","message":"By default, when you don't specify an absolute path to the module, we search the built-in path.","date":"2015-02-13T23:58:52.465Z","type":"message"}
{"nick":"nfitch_","message":"[root@dev-1 ~]# mdb core.node.8104","date":"2015-02-13T23:58:57.258Z","type":"message"}
{"nick":"nfitch_","message":"Loading modules: [ libumem.so.1 libc.so.1 ld.so.1 ]","date":"2015-02-13T23:58:57.444Z","type":"message"}
{"nick":"nfitch_","message":"> ::load ./node-0.12/node-v0.12.0/out/Release/mdb_v8.so","date":"2015-02-13T23:58:57.444Z","type":"message"}
{"nick":"rmustacc","message":"Which includes a copy of mdb_v8; however, it's not quite the latest one yet.","date":"2015-02-13T23:59:06.072Z","type":"message"}
{"nick":"nfitch_","message":"Is there a way to tell what .so the dmods are loaded from?","date":"2015-02-13T23:59:28.295Z","type":"message"}
