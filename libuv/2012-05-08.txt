{"nick":"loladiro","date":"2012-05-08T00:07:34.898Z","type":"join"}
{"nick":"isaacs","reason":"Remote host closed the connection","date":"2012-05-08T00:23:04.099Z","type":"quit"}
{"nick":"piscisaureus_","message":"time to go. later","date":"2012-05-08T00:26:32.336Z","type":"message"}
{"nick":"piscisaureus_","reason":"Quit: ~ Trillian Astra - www.trillian.im ~","date":"2012-05-08T00:33:59.652Z","type":"quit"}
{"nick":"orlandovftw","reason":"Ping timeout: 256 seconds","date":"2012-05-08T00:48:59.721Z","type":"quit"}
{"nick":"mjr_","date":"2012-05-08T00:50:46.421Z","type":"join"}
{"nick":"dap","reason":"Quit: Leaving.","date":"2012-05-08T00:51:37.772Z","type":"quit"}
{"nick":"isaacs","date":"2012-05-08T01:09:05.125Z","type":"join"}
{"nick":"isaacs","new_nick":"SubStack_","date":"2012-05-08T01:18:47.085Z","type":"nick"}
{"nick":"SubStack_","new_nick":"isaacs","date":"2012-05-08T01:19:10.680Z","type":"nick"}
{"nick":"orlandovftw","date":"2012-05-08T01:27:04.421Z","type":"join"}
{"nick":"pietern","reason":"Quit: pietern","date":"2012-05-08T01:32:58.480Z","type":"quit"}
{"nick":"erickt","reason":"Ping timeout: 244 seconds","date":"2012-05-08T01:33:42.077Z","type":"quit"}
{"nick":"abraxas","date":"2012-05-08T01:40:38.138Z","type":"join"}
{"nick":"c4milo","date":"2012-05-08T01:42:49.431Z","type":"join"}
{"nick":"orlandovftw","reason":"Ping timeout: 245 seconds","date":"2012-05-08T01:58:41.213Z","type":"quit"}
{"nick":"pietern","date":"2012-05-08T02:04:22.972Z","type":"join"}
{"nick":"brson","reason":"Quit: leaving","date":"2012-05-08T02:09:11.711Z","type":"quit"}
{"nick":"orlandovftw","date":"2012-05-08T02:20:52.362Z","type":"join"}
{"nick":"isaacs","reason":"Remote host closed the connection","date":"2012-05-08T02:48:44.787Z","type":"quit"}
{"nick":"orlandovftw","reason":"Ping timeout: 250 seconds","date":"2012-05-08T02:51:02.419Z","type":"quit"}
{"nick":"isaacs","date":"2012-05-08T03:09:22.808Z","type":"join"}
{"nick":"c4milo","reason":"Ping timeout: 250 seconds","date":"2012-05-08T03:40:26.273Z","type":"quit"}
{"nick":"isaacs","reason":"Remote host closed the connection","date":"2012-05-08T03:49:13.955Z","type":"quit"}
{"nick":"pietern","reason":"Quit: pietern","date":"2012-05-08T03:53:08.754Z","type":"quit"}
{"nick":"mjr_","reason":"Quit: mjr_","date":"2012-05-08T04:00:29.144Z","type":"quit"}
{"nick":"isaacs","date":"2012-05-08T04:06:20.954Z","type":"join"}
{"nick":"isaacs","reason":"Remote host closed the connection","date":"2012-05-08T04:07:43.587Z","type":"quit"}
{"nick":"orlandovftw","date":"2012-05-08T04:13:18.054Z","type":"join"}
{"nick":"AlbireoX","reason":"Ping timeout: 276 seconds","date":"2012-05-08T04:20:47.087Z","type":"quit"}
{"nick":"AlbireoX","date":"2012-05-08T04:36:14.475Z","type":"join"}
{"nick":"toothr","reason":"*.net *.split","date":"2012-05-08T05:22:02.718Z","type":"quit"}
{"nick":"russell_h","reason":"*.net *.split","date":"2012-05-08T05:22:02.719Z","type":"quit"}
{"nick":"saghul","reason":"*.net *.split","date":"2012-05-08T05:22:03.317Z","type":"quit"}
{"nick":"elijah-mbp","reason":"*.net *.split","date":"2012-05-08T05:22:03.517Z","type":"quit"}
{"nick":"tjfontaine","reason":"*.net *.split","date":"2012-05-08T05:22:04.318Z","type":"quit"}
{"nick":"DrPizza","reason":"*.net *.split","date":"2012-05-08T05:22:04.717Z","type":"quit"}
{"nick":"dshaw_","reason":"*.net *.split","date":"2012-05-08T05:22:05.318Z","type":"quit"}
{"nick":"AvianFlu","reason":"*.net *.split","date":"2012-05-08T05:22:05.517Z","type":"quit"}
{"nick":"jce","reason":"*.net *.split","date":"2012-05-08T05:22:05.918Z","type":"quit"}
{"nick":"orlandovftw","reason":"*.net *.split","date":"2012-05-08T05:22:06.517Z","type":"quit"}
{"nick":"TooTallNate","reason":"*.net *.split","date":"2012-05-08T05:22:06.717Z","type":"quit"}
{"nick":"luvit-irc-bot","reason":"*.net *.split","date":"2012-05-08T05:22:06.917Z","type":"quit"}
{"nick":"ryah_","reason":"*.net *.split","date":"2012-05-08T05:22:07.718Z","type":"quit"}
{"nick":"kohai","reason":"*.net *.split","date":"2012-05-08T05:22:08.337Z","type":"quit"}
{"nick":"chilts","reason":"*.net *.split","date":"2012-05-08T05:22:09.338Z","type":"quit"}
{"nick":"igorzi","reason":"*.net *.split","date":"2012-05-08T05:22:09.738Z","type":"quit"}
{"nick":"orlandovftw","date":"2012-05-08T05:22:40.232Z","type":"join"}
{"nick":"kohai","date":"2012-05-08T05:22:40.438Z","type":"join"}
{"nick":"TooTallNate","date":"2012-05-08T05:22:40.438Z","type":"join"}
{"nick":"saghul","date":"2012-05-08T05:22:40.438Z","type":"join"}
{"nick":"elijah-mbp","date":"2012-05-08T05:22:40.438Z","type":"join"}
{"nick":"luvit-irc-bot","date":"2012-05-08T05:22:40.438Z","type":"join"}
{"nick":"jce","date":"2012-05-08T05:22:40.438Z","type":"join"}
{"nick":"DrPizza","date":"2012-05-08T05:22:40.438Z","type":"join"}
{"nick":"tjfontaine","date":"2012-05-08T05:22:40.438Z","type":"join"}
{"nick":"toothr","date":"2012-05-08T05:22:40.438Z","type":"join"}
{"nick":"russell_h","date":"2012-05-08T05:22:40.438Z","type":"join"}
{"nick":"ryah_","date":"2012-05-08T05:22:40.438Z","type":"join"}
{"nick":"chilts","date":"2012-05-08T05:22:40.438Z","type":"join"}
{"nick":"philips","reason":"Changing host","date":"2012-05-08T05:23:16.678Z","type":"quit"}
{"nick":"philips","date":"2012-05-08T05:23:16.879Z","type":"join"}
{"nick":"TooTallNate","reason":"Quit: Linkinus - http://linkinus.com","date":"2012-05-08T05:23:47.325Z","type":"quit"}
{"nick":"AvianFlu","date":"2012-05-08T05:28:20.994Z","type":"join"}
{"nick":"loladiro","date":"2012-05-08T05:41:26.590Z","type":"part"}
{"nick":"paddybyers","date":"2012-05-08T05:50:44.241Z","type":"join"}
{"nick":"stephank","reason":"Quit: *Poof!*","date":"2012-05-08T06:49:07.370Z","type":"quit"}
{"nick":"rendar","date":"2012-05-08T07:29:18.870Z","type":"join"}
{"nick":"mjr_","date":"2012-05-08T07:32:30.276Z","type":"join"}
{"nick":"AvianFlu","reason":"Ping timeout: 244 seconds","date":"2012-05-08T08:03:46.948Z","type":"quit"}
{"nick":"AvianFlu","date":"2012-05-08T08:04:51.095Z","type":"join"}
{"nick":"ira","date":"2012-05-08T08:32:52.866Z","type":"join"}
{"nick":"orlandovftw","reason":"Ping timeout: 250 seconds","date":"2012-05-08T08:47:12.567Z","type":"quit"}
{"nick":"mjr_","reason":"Quit: mjr_","date":"2012-05-08T09:00:10.734Z","type":"quit"}
{"nick":"toothr","reason":"*.net *.split","date":"2012-05-08T09:10:28.777Z","type":"quit"}
{"nick":"russell_h","reason":"*.net *.split","date":"2012-05-08T09:10:28.777Z","type":"quit"}
{"nick":"toothr","date":"2012-05-08T09:11:52.348Z","type":"join"}
{"nick":"russell_h","date":"2012-05-08T09:13:16.338Z","type":"join"}
{"nick":"ira","reason":"Ping timeout: 248 seconds","date":"2012-05-08T09:26:18.480Z","type":"quit"}
{"nick":"abraxas","reason":"Remote host closed the connection","date":"2012-05-08T10:21:27.523Z","type":"quit"}
{"nick":"mmalecki[away]","reason":"Ping timeout: 272 seconds","date":"2012-05-08T10:32:04.759Z","type":"quit"}
{"nick":"avsej","reason":"Quit: Quit","date":"2012-05-08T10:40:03.064Z","type":"quit"}
{"nick":"avsej","date":"2012-05-08T10:40:45.165Z","type":"join"}
{"nick":"c4milo","date":"2012-05-08T11:16:22.427Z","type":"join"}
{"nick":"loladiro","date":"2012-05-08T12:23:33.025Z","type":"join"}
{"nick":"bnoordhuis","date":"2012-05-08T12:38:22.559Z","type":"join"}
{"nick":"piscisaureus_","date":"2012-05-08T12:54:50.231Z","type":"join"}
{"nick":"piscisaureus_","message":"bnoordhuis: did you take a look at the benchmark yet?","date":"2012-05-08T12:59:05.961Z","type":"message"}
{"nick":"bnoordhuis","message":"piscisaureus_: hey","date":"2012-05-08T12:59:12.822Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: I would like to proceed, fix and land","date":"2012-05-08T12:59:19.390Z","type":"message"}
{"nick":"piscisaureus_","message":"(and \"fix\" bytesWritten)","date":"2012-05-08T12:59:34.061Z","type":"message"}
{"nick":"bnoordhuis","message":"you mean the bytes/xxx thing with non-ascii?","date":"2012-05-08T12:59:34.926Z","type":"message"}
{"nick":"piscisaureus_","message":"yerp","date":"2012-05-08T12:59:44.469Z","type":"message"}
{"nick":"bnoordhuis","message":"50% yes - i patched http_simple_auto, then got distracted by other things","date":"2012-05-08T13:00:16.071Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: I also found an issue with v8 which gives +10% for non-unicode bytes/10240","date":"2012-05-08T13:01:16.997Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: they landed a fix already in v8 trunk","date":"2012-05-08T13:01:26.446Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: (on windows, that is. not sure about unix)","date":"2012-05-08T13:01:43.063Z","type":"message"}
{"nick":"bnoordhuis","message":"can you link me to the commit?","date":"2012-05-08T13:02:16.976Z","type":"message"}
{"nick":"piscisaureus_","message":"https://github.com/v8/v8/commit/29862e81b67a2e778ad63fdf4dadcd07cb3dc1a0","date":"2012-05-08T13:02:21.668Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: the problem was that msvc was not inlining something that really should be inlined","date":"2012-05-08T13:02:41.646Z","type":"message"}
{"nick":"bnoordhuis","message":"that rascal msvc","date":"2012-05-08T13:03:37.313Z","type":"message"}
{"nick":"bnoordhuis","message":"i've never seen Get() or CopyChars() in any profiles","date":"2012-05-08T13:03:53.378Z","type":"message"}
{"nick":"bnoordhuis","message":"so presumably it's not an issue with gcc","date":"2012-05-08T13:03:58.399Z","type":"message"}
{"nick":"piscisaureus_","message":"then for you it probably already worked :-)","date":"2012-05-08T13:04:08.049Z","type":"message"}
{"nick":"piscisaureus_","message":"Get() is a function with a big switch statement","date":"2012-05-08T13:04:29.145Z","type":"message"}
{"nick":"piscisaureus_","message":"msvc has the tendency not to inline those","date":"2012-05-08T13:04:39.279Z","type":"message"}
{"nick":"piscisaureus_","message":"which is really lame in this case, since the calling functions also read the field that it switched on","date":"2012-05-08T13:05:03.587Z","type":"message"}
{"nick":"piscisaureus_","message":"(and do `if`s with it0","date":"2012-05-08T13:05:21.736Z","type":"message"}
{"nick":"bnoordhuis","message":"okay, the difference with non-ascii strings is quite convincing","date":"2012-05-08T13:06:24.131Z","type":"message"}
{"nick":"bnoordhuis","message":"like a 130% speedup","date":"2012-05-08T13:06:39.858Z","type":"message"}
{"nick":"piscisaureus_","message":"that works mostly because it avoids flattening the string twice","date":"2012-05-08T13:07:13.123Z","type":"message"}
{"nick":"bnoordhuis","message":"2.55 times faster","date":"2012-05-08T13:07:24.820Z","type":"message"}
{"nick":"piscisaureus_","message":"maybe we can add some benchmarks","date":"2012-05-08T13:07:41.421Z","type":"message"}
{"nick":"piscisaureus_","message":"like unicode/xxx and flat/xxx","date":"2012-05-08T13:07:47.411Z","type":"message"}
{"nick":"bnoordhuis","message":"benchmarks would be good","date":"2012-05-08T13:07:51.372Z","type":"message"}
{"nick":"piscisaureus_","message":"(where flat/xxx is a string that is forcefully flattened","date":"2012-05-08T13:08:01.990Z","type":"message"}
{"nick":"bnoordhuis","message":"bytes/1024 is less brutal but still a ~35% speedup","date":"2012-05-08T13:09:56.302Z","type":"message"}
{"nick":"bnoordhuis","message":"that v8","date":"2012-05-08T13:10:08.661Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: unfortunately I didn't find the time to write a more efficient flattener for unicode cons strings","date":"2012-05-08T13:10:28.227Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: or rather, I never finished it","date":"2012-05-08T13:10:41.029Z","type":"message"}
{"nick":"bnoordhuis","message":"7-8% speedup on bytes/64","date":"2012-05-08T13:12:23.231Z","type":"message"}
{"nick":"bnoordhuis","message":"nice","date":"2012-05-08T13:12:25.719Z","type":"message"}
{"nick":"piscisaureus_","message":"bytes/64 is mostly dominated by io","date":"2012-05-08T13:12:42.953Z","type":"message"}
{"nick":"piscisaureus_","message":"and if not, it's dominated by writing headers","date":"2012-05-08T13:12:52.383Z","type":"message"}
{"nick":"piscisaureus_","message":"it's hard to make a big difference there","date":"2012-05-08T13:13:03.143Z","type":"message"}
{"nick":"bnoordhuis","message":"yeah, i can see that","date":"2012-05-08T13:13:22.495Z","type":"message"}
{"nick":"bnoordhuis","message":"i see a 15% speedup on bytes/10240 with mostly ascii output (10240 bytes of ascii + one unicode char)","date":"2012-05-08T13:16:07.378Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: funny, I got almost twice as fast there","date":"2012-05-08T13:16:38.357Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: it may depend on where the unicode char appears in your string","date":"2012-05-08T13:16:49.577Z","type":"message"}
{"nick":"bnoordhuis","message":"piscisaureus_: sounds likely. if the string is fully unicode, i see that 2.55x difference","date":"2012-05-08T13:17:23.980Z","type":"message"}
{"nick":"bnoordhuis","message":"piscisaureus_: since you're hacking v8, can you fix this too? /(.*)+{/.test(Array(24).join(\"x\"))","date":"2012-05-08T13:18:56.893Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: what's up with that? Is there a v8 bug for it?","date":"2012-05-08T13:19:14.535Z","type":"message"}
{"nick":"bnoordhuis","message":"piscisaureus_: don't know. ruben found it","date":"2012-05-08T13:19:50.356Z","type":"message"}
{"nick":"piscisaureus_","message":"I can try","date":"2012-05-08T13:20:01.657Z","type":"message"}
{"nick":"bnoordhuis","message":"at first i thought it was a worst-case regex","date":"2012-05-08T13:20:06.053Z","type":"message"}
{"nick":"bnoordhuis","message":"but spidermonkey handles it well, v8 doesn't","date":"2012-05-08T13:20:25.029Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: is it slow or is it broken?","date":"2012-05-08T13:20:25.425Z","type":"message"}
{"nick":"bnoordhuis","message":"really, really slow","date":"2012-05-08T13:20:30.548Z","type":"message"}
{"nick":"piscisaureus_","message":"v8 may not flatten the string","date":"2012-05-08T13:20:34.298Z","type":"message"}
{"nick":"bnoordhuis","message":"just try it","date":"2012-05-08T13:20:34.505Z","type":"message"}
{"nick":"piscisaureus_","message":"ouch","date":"2012-05-08T13:20:49.608Z","type":"message"}
{"nick":"piscisaureus_","message":"does it work for literals too?","date":"2012-05-08T13:20:57.246Z","type":"message"}
{"nick":"piscisaureus_","message":"yeah, is not flattening dependent","date":"2012-05-08T13:21:23.080Z","type":"message"}
{"nick":"piscisaureus_","message":"I will bench it","date":"2012-05-08T13:21:39.320Z","type":"message"}
{"nick":"piscisaureus_","message":"see if I can do something about it","date":"2012-05-08T13:21:44.022Z","type":"message"}
{"nick":"bnoordhuis","message":"let's see what callgrind has to say about it","date":"2012-05-08T13:23:25.271Z","type":"message"}
{"nick":"piscisaureus_","message":"I think these regexes are compiled","date":"2012-05-08T13:23:39.362Z","type":"message"}
{"nick":"piscisaureus_","message":"so I doubt that callgrind will help you in any way","date":"2012-05-08T13:23:49.099Z","type":"message"}
{"nick":"piscisaureus_","message":"but sure, try","date":"2012-05-08T13:23:51.419Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: I think v8 should be able to easily detect that pattern even","date":"2012-05-08T13:25:18.265Z","type":"message"}
{"nick":"piscisaureus_","message":"I mean, { does not even appear in the string","date":"2012-05-08T13:25:30.350Z","type":"message"}
{"nick":"bnoordhuis","message":"1,103,099,802  ???:0x000010b97f287840 [???] <- yep :)","date":"2012-05-08T13:27:09.715Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: how many runs?","date":"2012-05-08T13:27:22.703Z","type":"message"}
{"nick":"piscisaureus_","message":"one?","date":"2012-05-08T13:27:24.891Z","type":"message"}
{"nick":"piscisaureus_","message":"yeah that's definitely a bug ;-)","date":"2012-05-08T13:27:37.593Z","type":"message"}
{"nick":"piscisaureus_","message":"I will investigate","date":"2012-05-08T13:27:46.080Z","type":"message"}
{"nick":"erickt","date":"2012-05-08T13:28:27.923Z","type":"join"}
{"nick":"bnoordhuis","message":"is there a way to force v8 to use the regex interpreter instead of the assembler?","date":"2012-05-08T13:28:34.187Z","type":"message"}
{"nick":"piscisaureus_","message":"yeah there's a compile flag for that","date":"2012-05-08T13:29:25.497Z","type":"message"}
{"nick":"piscisaureus_","message":"but I know only to do  that with scons","date":"2012-05-08T13:29:33.442Z","type":"message"}
{"nick":"bnoordhuis","message":"V8_INTERPRETED_REGEXP :(","date":"2012-05-08T13:29:34.692Z","type":"message"}
{"nick":"bnoordhuis","message":"i hate recompiling v8, it's so slow","date":"2012-05-08T13:29:44.660Z","type":"message"}
{"nick":"piscisaureus_","message":"use \u000301--trace-regexp-macro-assembler\u0003\u000301","date":"2012-05-08T13:29:46.707Z","type":"message"}
{"nick":"piscisaureus_","message":"and --print-code","date":"2012-05-08T13:29:54.811Z","type":"message"}
{"nick":"kohai","message":"and has -1 beer","date":"2012-05-08T13:29:55.209Z","type":"message"}
{"nick":"piscisaureus_","message":"^-- that's what Erik just told me","date":"2012-05-08T13:30:02.242Z","type":"message"}
{"nick":"bnoordhuis","message":"you're idling in #v8?","date":"2012-05-08T13:30:27.173Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: I have direct lines with Erik","date":"2012-05-08T13:30:45.022Z","type":"message"}
{"nick":"piscisaureus_","message":":-p","date":"2012-05-08T13:30:57.090Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: the issue is know. It's known as 'catastrophic backtracking'","date":"2012-05-08T13:33:58.627Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: http://code.google.com/p/v8/issues/detail?id=430","date":"2012-05-08T13:36:22.988Z","type":"message"}
{"nick":"bnoordhuis","message":"will they have it fixed by 4 pm?","date":"2012-05-08T13:36:24.632Z","type":"message"}
{"nick":"bnoordhuis","message":"going by the issue id... no","date":"2012-05-08T13:36:35.871Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: Erik says that perl made all regex 2x slower by trying to detect it. But it has been proven that reliable detection of this pattern is undetectable.","date":"2012-05-08T13:37:06.808Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: the regex should be rewrittend as (.+){ and it would be all fine","date":"2012-05-08T13:37:22.706Z","type":"message"}
{"nick":"bnoordhuis","message":"right, i understand that the regex goes exponential","date":"2012-05-08T13:37:54.578Z","type":"message"}
{"nick":"felixge","date":"2012-05-08T13:38:11.228Z","type":"join"}
{"nick":"felixge","reason":"Changing host","date":"2012-05-08T13:38:11.549Z","type":"quit"}
{"nick":"felixge","date":"2012-05-08T13:38:11.748Z","type":"join"}
{"nick":"piscisaureus_","message":"Hmm","date":"2012-05-08T13:42:40.459Z","type":"message"}
{"nick":"piscisaureus_","message":"compiled regexes seem to confuse the sampling profiler is msvc","date":"2012-05-08T13:42:50.057Z","type":"message"}
{"nick":"bnoordhuis","message":"piscisaureus_: did erik mention why they can't simply abort after x iterations, like spidermonkey does?","date":"2012-05-08T13:44:09.592Z","type":"message"}
{"nick":"piscisaureus_","message":"No, I didn't ask","date":"2012-05-08T13:44:26.413Z","type":"message"}
{"nick":"piscisaureus_","message":"I think it's a correctness issue :-)","date":"2012-05-08T13:44:37.725Z","type":"message"}
{"nick":"felixge","message":"I'm currently looking into: \"throw e; // process.nextTick error, or 'error' event on first tick\"","date":"2012-05-08T13:47:44.223Z","type":"message"}
{"nick":"felixge","message":"it would be really nice if we could show the real call site","date":"2012-05-08T13:47:52.898Z","type":"message"}
{"nick":"felixge","message":"instead of this one for those errors","date":"2012-05-08T13:47:57.185Z","type":"message"}
{"nick":"felixge","message":"the real problem is the 'uncaughtException' feature","date":"2012-05-08T13:49:17.823Z","type":"message"}
{"nick":"felixge","message":"if it wasn't for that we wouldn't need to catch process.nextTick exceptions","date":"2012-05-08T13:49:27.259Z","type":"message"}
{"nick":"felixge","message":"If we did stop to support this use case, we would get good errors again: https://github.com/joyent/node/commit/57642e23497d5698aa4c5b8a44edff7b265c2283","date":"2012-05-08T13:50:15.087Z","type":"message"}
{"nick":"felixge","message":"using 'uncaughtException' is really unsafe anyway","date":"2012-05-08T13:50:53.974Z","type":"message"}
{"nick":"felixge","message":"that being said … I may have an idea that doesn't hurt performance, will try","date":"2012-05-08T13:52:01.267Z","type":"message"}
{"nick":"erickt","reason":"Quit: erickt","date":"2012-05-08T14:00:32.467Z","type":"quit"}
{"nick":"CIA-155","message":"\u0002node:\u000f \u000303Ben Noordhuis\u000f \u000307master\u000f * r\u000278e831a\u000f \u000310\u000f/ (src/node.cc src/node_crypto.cc src/node_extensions.cc)\u0002:\u000f ","date":"2012-05-08T14:04:32.024Z","type":"message"}
{"nick":"CIA-155","message":"\u0002node:\u000f Don't use _snprintf() on Windows, it's not safe.","date":"2012-05-08T14:04:32.024Z","type":"message"}
{"nick":"CIA-155","message":"\u0002node:\u000f  - http://git.io/-Fm2pA","date":"2012-05-08T14:04:32.025Z","type":"message"}
{"nick":"bnoordhuis","message":"piscisaureus_: is this code in node_crypto.cc still necessary?","date":"2012-05-08T14:05:40.070Z","type":"message"}
{"nick":"bnoordhuis","message":"  40 #ifdef _WIN32                                                                     |  9   va_start(ap, fmt);                                                             ","date":"2012-05-08T14:05:40.808Z","type":"message"}
{"nick":"bnoordhuis","message":"  41 # include <windows.h>                                                             |  8   int n = _vsprintf_p(buf, len, fmt, ap);                                        ","date":"2012-05-08T14:05:41.006Z","type":"message"}
{"nick":"bnoordhuis","message":"  42 #else                                                                             |  7   if (len) buf[len - 1] = '\\0';                                                  ","date":"2012-05-08T14:05:41.006Z","type":"message"}
{"nick":"bnoordhuis","message":"  43 # include <pthread.h>                                                             |  6   va_end(ap);                                                                    ","date":"2012-05-08T14:05:41.807Z","type":"message"}
{"nick":"bnoordhuis","message":"  44 #endif      ","date":"2012-05-08T14:05:44.806Z","type":"message"}
{"nick":"bnoordhuis","message":"ignore the bits from my second tab :)","date":"2012-05-08T14:06:03.487Z","type":"message"}
{"nick":"tjfontaine","message":"how many vims cna you fit in your terminal","date":"2012-05-08T14:06:37.295Z","type":"message"}
{"nick":"felixge","message":"I think I got something really neat","date":"2012-05-08T14:07:44.483Z","type":"message"}
{"nick":"bnoordhuis","message":"tjfontaine: 3 or 4. 28\" screens ftw","date":"2012-05-08T14:08:16.216Z","type":"message"}
{"nick":"tjfontaine","message":"I usually max out at 4, but mostly stay at 3","date":"2012-05-08T14:09:42.890Z","type":"message"}
{"nick":"felixge","message":"ok, here it is: https://github.com/felixge/node/commit/2d104e1189e8ac9e44afd37cacfb54968687f6a2","date":"2012-05-08T14:11:29.719Z","type":"message"}
{"nick":"felixge","message":"bnoordhuis / piscisaureus_ : ^--- could I get your opinion on this?","date":"2012-05-08T14:11:43.757Z","type":"message"}
{"nick":"bnoordhuis","message":"felixge: it'll have to be piscisaureus_, i'm afk for the next two hours","date":"2012-05-08T14:12:48.531Z","type":"message"}
{"nick":"felixge","message":"bnoordhuis: ok. Doesn't need to be rushed, would be bad to fuck this up : )","date":"2012-05-08T14:13:07.848Z","type":"message"}
{"nick":"felixge","message":"bnoordhuis: so would also like to get your input when u get back","date":"2012-05-08T14:13:23.281Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: the problem with that patch is that if an exception is ignored by an uncaughtException handler then the nextTickQueue is not processed further","date":"2012-05-08T14:15:10.173Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: yeah, but that should be fixable","date":"2012-05-08T14:15:20.456Z","type":"message"}
{"nick":"felixge","message":"I'll simply set the needs_next_tick flag in node.cc on uncaught exceptions","date":"2012-05-08T14:15:33.269Z","type":"message"}
{"nick":"felixge","message":"worst case: the queue is empty and still gets processed after an uncaught exception","date":"2012-05-08T14:15:45.159Z","type":"message"}
{"nick":"felixge","message":"need_tick_cb","date":"2012-05-08T14:16:08.831Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: yeah. We could also just just do:","date":"2012-05-08T14:16:47.892Z","type":"message"}
{"nick":"piscisaureus_","message":"if (process.listeners('uncaughtException').length)","date":"2012-05-08T14:16:48.090Z","type":"message"}
{"nick":"piscisaureus_","message":"oh wait","date":"2012-05-08T14:17:01.252Z","type":"message"}
{"nick":"piscisaureus_","message":"the problem is in rethrowing","date":"2012-05-08T14:17:05.154Z","type":"message"}
{"nick":"felixge","message":"y","date":"2012-05-08T14:17:10.184Z","type":"message"}
{"nick":"piscisaureus_","message":"maybe we can salvage the stack somehow","date":"2012-05-08T14:17:13.991Z","type":"message"}
{"nick":"felixge","message":"the re-throwing breaks the call site","date":"2012-05-08T14:17:15.544Z","type":"message"}
{"nick":"piscisaureus_","message":"I agree that this would be a big win","date":"2012-05-08T14:17:47.171Z","type":"message"}
{"nick":"felixge","message":"weirdly, this patch seems to break 'test/simple/test-child-process-cwd.js' and others right now","date":"2012-05-08T14:17:53.431Z","type":"message"}
{"nick":"felixge","message":"but I think it's fixable, looking into that now","date":"2012-05-08T14:18:04.422Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: yeah, I'll see if I can get this into a shape where I think the edge cases are covered","date":"2012-05-08T14:18:16.993Z","type":"message"}
{"nick":"felixge","message":"but it seems that at least in theory we can do with catch/re-throw","date":"2012-05-08T14:18:30.982Z","type":"message"}
{"nick":"felixge","message":"and simplify things","date":"2012-05-08T14:18:32.907Z","type":"message"}
{"nick":"felixge","message":"* can do without","date":"2012-05-08T14:18:37.606Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: I think nextTickIndex should be reset to 0 too","date":"2012-05-08T14:19:58.232Z","type":"message"}
{"nick":"felixge","message":"fuck yes","date":"2012-05-08T14:20:08.287Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: when you do nextTickQueue = []","date":"2012-05-08T14:20:08.701Z","type":"message"}
{"nick":"felixge","message":"yeah","date":"2012-05-08T14:20:10.594Z","type":"message"}
{"nick":"felixge","message":"had that in before","date":"2012-05-08T14:20:21.168Z","type":"message"}
{"nick":"felixge","message":"this fixes the breaking tests","date":"2012-05-08T14:20:25.784Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: https://github.com/felixge/node/commit/7718a8fd8fe8bf381cb3316d7d6228ab668a3962","date":"2012-05-08T14:22:29.480Z","type":"message"}
{"nick":"felixge","message":"one remaining issue: if a process.nextTick creates another process.nextTick it will create a tight infinite loop","date":"2012-05-08T14:23:09.258Z","type":"message"}
{"nick":"felixge","message":"rather than a \"loose\" infinite loop with other events still being processed","date":"2012-05-08T14:23:27.431Z","type":"message"}
{"nick":"piscisaureus_","message":"hmm","date":"2012-05-08T14:23:33.444Z","type":"message"}
{"nick":"felixge","message":"will write a test for that / see if it can be fixed","date":"2012-05-08T14:23:36.235Z","type":"message"}
{"nick":"felixge","message":"generally speaking people shouldn't do that","date":"2012-05-08T14:23:44.206Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: I think you can store the length of the nextTick queue","date":"2012-05-08T14:23:48.976Z","type":"message"}
{"nick":"felixge","message":"but we also shouldn't change behavior here if possible","date":"2012-05-08T14:23:50.860Z","type":"message"}
{"nick":"piscisaureus_","message":"and break out of the loop when nextTickIndex reaches that number","date":"2012-05-08T14:24:00.322Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: but then clearing the array and resetting the index to 0 is wrong","date":"2012-05-08T14:24:16.968Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: yeah so you would do","date":"2012-05-08T14:24:24.644Z","type":"message"}
{"nick":"felixge","message":"because one of the nextTick callbacks could have pushed things into the array","date":"2012-05-08T14:24:28.358Z","type":"message"}
{"nick":"piscisaureus_","message":"nextTickQueue.splice(0, nextTickIndex)","date":"2012-05-08T14:24:34.590Z","type":"message"}
{"nick":"piscisaureus_","message":"nextTickIndex = 0;","date":"2012-05-08T14:24:37.594Z","type":"message"}
{"nick":"piscisaureus_","message":"easy","date":"2012-05-08T14:24:39.215Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: also, about \"need_tick_callback = true\"  in FatalException","date":"2012-05-08T14:25:03.687Z","type":"message"}
{"nick":"piscisaureus_","message":"are you sure that the tick spinner is always running when that happens?","date":"2012-05-08T14:25:14.724Z","type":"message"}
{"nick":"piscisaureus_","message":"otherwise you'd have to call NeedTickCallback() instread","date":"2012-05-08T14:25:28.111Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: no","date":"2012-05-08T14:25:31.344Z","type":"message"}
{"nick":"felixge","message":"good point","date":"2012-05-08T14:25:33.368Z","type":"message"}
{"nick":"felixge","message":"thanks","date":"2012-05-08T14:25:34.511Z","type":"message"}
{"nick":"piscisaureus_","message":"or otherwise make sure that the tick spinner is started","date":"2012-05-08T14:25:42.422Z","type":"message"}
{"nick":"piscisaureus_","message":"if (!uv_is_active((uv_handle_t*) &tick_spinner)) {","date":"2012-05-08T14:25:43.524Z","type":"message"}
{"nick":"piscisaureus_","message":"    uv_idle_start(&tick_spinner, Spin);","date":"2012-05-08T14:25:43.723Z","type":"message"}
{"nick":"piscisaureus_","message":"    uv_ref(uv_default_loop());","date":"2012-05-08T14:25:43.723Z","type":"message"}
{"nick":"piscisaureus_","message":"  }","date":"2012-05-08T14:25:43.723Z","type":"message"}
{"nick":"piscisaureus_","message":"maybe move that code into a separate function","date":"2012-05-08T14:26:00.989Z","type":"message"}
{"nick":"piscisaureus_","message":"the tick spinner is rather lame btw","date":"2012-05-08T14:26:29.076Z","type":"message"}
{"nick":"piscisaureus_","message":"we should be able to do without an uv_idle completely","date":"2012-05-08T14:26:40.326Z","type":"message"}
{"nick":"piscisaureus_","message":"that would also speed up ndoe","date":"2012-05-08T14:26:58.726Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: how should I call that function?","date":"2012-05-08T14:27:50.022Z","type":"message"}
{"nick":"felixge","message":"or would you want to do that?","date":"2012-05-08T14:27:57.417Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: you don't. Just make another function \"startTickCallback\" or something that does the same as NeedTickCallback","date":"2012-05-08T14:28:37.191Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: then change NeedTickCallback to do this","date":"2012-05-08T14:28:45.480Z","type":"message"}
{"nick":"piscisaureus_","message":"Handle<Value> NeedTickCallback(const Arguments& args) {","date":"2012-05-08T14:29:20.105Z","type":"message"}
{"nick":"piscisaureus_","message":"  startTickSpinner();","date":"2012-05-08T14:29:20.308Z","type":"message"}
{"nick":"piscisaureus_","message":"  return v8::Undefined();","date":"2012-05-08T14:29:20.308Z","type":"message"}
{"nick":"piscisaureus_","message":"}","date":"2012-05-08T14:29:20.308Z","type":"message"}
{"nick":"isaacs","date":"2012-05-08T14:29:25.228Z","type":"join"}
{"nick":"felixge","message":"ok","date":"2012-05-08T14:30:01.399Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: btw - I think we can rid of the idle callback entirely","date":"2012-05-08T14:30:24.434Z","type":"message"}
{"nick":"piscisaureus_","message":"but it can cause subtle behavior changes so I'd want to do that in 0.8","date":"2012-05-08T14:30:39.765Z","type":"message"}
{"nick":"felixge","message":"ok","date":"2012-05-08T14:31:28.508Z","type":"message"}
{"nick":"felixge","message":"I'd like to land the call site patch for 0.6 if possible so","date":"2012-05-08T14:31:41.065Z","type":"message"}
{"nick":"felixge","message":"it really helps debugging node apps","date":"2012-05-08T14:31:46.460Z","type":"message"}
{"nick":"felixge","message":"and should cause no issues","date":"2012-05-08T14:31:49.921Z","type":"message"}
{"nick":"piscisaureus_","message":"that would be nice","date":"2012-05-08T14:32:11.923Z","type":"message"}
{"nick":"felixge","message":"https://github.com/felixge/node/commit/0878cb8ad9a5d567626e3bb3512d5ccc020bbffa","date":"2012-05-08T14:32:12.195Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: ^---","date":"2012-05-08T14:32:15.033Z","type":"message"}
{"nick":"felixge","message":"potential candidate for merging","date":"2012-05-08T14:32:20.004Z","type":"message"}
{"nick":"piscisaureus_","message":"Although I would want to have isaacs' second opinion","date":"2012-05-08T14:32:23.480Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: drop ther handleScope at line 272 :-)","date":"2012-05-08T14:32:53.650Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: it's just a time sink","date":"2012-05-08T14:33:01.200Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: lol","date":"2012-05-08T14:33:05.119Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: s/interfer/interfere/","date":"2012-05-08T14:33:41.698Z","type":"message"}
{"nick":"felixge","message":"dropped it","date":"2012-05-08T14:33:44.857Z","type":"message"}
{"nick":"felixge","message":"https://github.com/felixge/node/commit/d1d4cce9f8e3dee0a1341398eaed8502e3232e75","date":"2012-05-08T14:33:45.696Z","type":"message"}
{"nick":"felixge","message":"ok will fix","date":"2012-05-08T14:33:57.793Z","type":"message"}
{"nick":"felixge","message":"https://github.com/felixge/node/commit/e73b9e031fd4ef42e4841f29021a786b1a5b04f9","date":"2012-05-08T14:34:25.142Z","type":"message"}
{"nick":"isaacs","message":"g'morning","date":"2012-05-08T14:34:28.216Z","type":"message"}
{"nick":"felixge","message":"now with less spelling errors: ^---","date":"2012-05-08T14:34:30.345Z","type":"message"}
{"nick":"felixge","message":"isaacs: hey","date":"2012-05-08T14:34:35.145Z","type":"message"}
{"nick":"felixge","message":"isaacs: how are you?","date":"2012-05-08T14:34:44.557Z","type":"message"}
{"nick":"isaacs","message":"great","date":"2012-05-08T14:35:44.316Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: hmm","date":"2012-05-08T14:36:03.200Z","type":"message"}
{"nick":"piscisaureus_","message":"oh nvm","date":"2012-05-08T14:36:17.146Z","type":"message"}
{"nick":"felixge","message":"isaacs: check out that patch I just linked when you get a chance","date":"2012-05-08T14:36:50.694Z","type":"message"}
{"nick":"felixge","message":"it fixes throw call sites for process.nextTick","date":"2012-05-08T14:37:05.171Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: yeah that patch looks good","date":"2012-05-08T14:37:06.579Z","type":"message"}
{"nick":"felixge","message":"and simplifies the code","date":"2012-05-08T14:37:07.993Z","type":"message"}
{"nick":"isaacs","message":"yeah, reading it now","date":"2012-05-08T14:37:13.752Z","type":"message"}
{"nick":"isaacs","message":"yeah, this is good.","date":"2012-05-08T14:37:22.807Z","type":"message"}
{"nick":"isaacs","message":"felixge: so, just to make sure..","date":"2012-05-08T14:37:39.168Z","type":"message"}
{"nick":"isaacs","message":"felixge: process.on('uncaughtException', function (er) { console.log(er) }); function thrower () { throw 'hi' }; process.nextTick(thrower); process.nextTick(thrower)","date":"2012-05-08T14:38:17.040Z","type":"message"}
{"nick":"isaacs","message":"felixge: that should log twice, not once","date":"2012-05-08T14:38:21.647Z","type":"message"}
{"nick":"philips","reason":"Excess Flood","date":"2012-05-08T14:38:22.252Z","type":"quit"}
{"nick":"piscisaureus_","message":"This patch should not interfere with that.","date":"2012-05-08T14:38:45.286Z","type":"message"}
{"nick":"isaacs","message":"i know","date":"2012-05-08T14:38:48.399Z","type":"message"}
{"nick":"felixge","message":"yes","date":"2012-05-08T14:38:50.568Z","type":"message"}
{"nick":"felixge","message":"https://github.com/joyent/node/commit/57642e23497d5698aa4c5b8a44edff7b265c2283","date":"2012-05-08T14:38:52.362Z","type":"message"}
{"nick":"piscisaureus_","message":"isaacs: but that is actually a good test :-)","date":"2012-05-08T14:38:55.602Z","type":"message"}
{"nick":"felixge","message":"^--- this is when this behavior introduced","date":"2012-05-08T14:38:56.765Z","type":"message"}
{"nick":"felixge","message":"I'd like to get rid of uncaughtException entirely as it's really fucked","date":"2012-05-08T14:39:07.159Z","type":"message"}
{"nick":"isaacs","message":"yeah","date":"2012-05-08T14:39:11.976Z","type":"message"}
{"nick":"felixge","message":"and people don't understand how fucked it is","date":"2012-05-08T14:39:12.833Z","type":"message"}
{"nick":"felixge","message":":)","date":"2012-05-08T14:39:13.488Z","type":"message"}
{"nick":"isaacs","message":"felixge: domains are the replacement","date":"2012-05-08T14:39:17.510Z","type":"message"}
{"nick":"isaacs","message":"but domains use it","date":"2012-05-08T14:39:19.176Z","type":"message"}
{"nick":"philips","date":"2012-05-08T14:39:21.141Z","type":"join"}
{"nick":"felixge","message":"I don't know if domains are fucked yet, need to play with them","date":"2012-05-08T14:39:29.619Z","type":"message"}
{"nick":"felixge","message":":)","date":"2012-05-08T14:39:30.132Z","type":"message"}
{"nick":"philips","reason":"Changing host","date":"2012-05-08T14:39:33.742Z","type":"quit"}
{"nick":"philips","date":"2012-05-08T14:39:33.941Z","type":"join"}
{"nick":"felixge","message":"but exceptions / error handling is always riddled with subtle problems","date":"2012-05-08T14:39:45.606Z","type":"message"}
{"nick":"felixge","message":"anyway","date":"2012-05-08T14:39:46.880Z","type":"message"}
{"nick":"isaacs","message":"and with domains + cluster, you can easily run a server that gracefully exits after sending a 500 response to the request that got the error, without disturbing the rest of the site.","date":"2012-05-08T14:39:50.497Z","type":"message"}
{"nick":"felixge","message":"let me try your use case","date":"2012-05-08T14:39:53.082Z","type":"message"}
{"nick":"felixge","message":"isaacs: yeah, my patch passes your one-liner ('hi' is logged twice)","date":"2012-05-08T14:40:39.292Z","type":"message"}
{"nick":"isaacs","message":"in fact, with domains and the cluster-master module, you can find an error in development, fix it, and press cmd-R to refresh until all the busted workers are dead and restarted :)","date":"2012-05-08T14:40:40.606Z","type":"message"}
{"nick":"isaacs","message":"felixge: great.","date":"2012-05-08T14:40:43.972Z","type":"message"}
{"nick":"isaacs","message":"felixge: i think that's roughly what the test does, too","date":"2012-05-08T14:40:49.553Z","type":"message"}
{"nick":"isaacs","message":"felixge: there'll be a few message tests that fail, make sure you update those as well.","date":"2012-05-08T14:41:10.533Z","type":"message"}
{"nick":"isaacs","message":"since this changes the reported stack of the error","date":"2012-05-08T14:41:25.384Z","type":"message"}
{"nick":"felixge","message":"yeah","date":"2012-05-08T14:41:32.138Z","type":"message"}
{"nick":"felixge","message":"running the full test suite before/after now","date":"2012-05-08T14:41:41.293Z","type":"message"}
{"nick":"isaacs","message":"kewl","date":"2012-05-08T14:41:45.680Z","type":"message"}
{"nick":"felixge","message":"to make sure nothing slips through","date":"2012-05-08T14:41:49.080Z","type":"message"}
{"nick":"isaacs","message":"make test-all should catch them.","date":"2012-05-08T14:41:52.704Z","type":"message"}
{"nick":"felixge","message":"but otherwise I'm hoping this could be a 0.6 candidate ?","date":"2012-05-08T14:41:56.156Z","type":"message"}
{"nick":"isaacs","message":"yes.","date":"2012-05-08T14:41:58.600Z","type":"message"}
{"nick":"felixge","message":"one thing so: It won't cleanly merge into 0.8 because of the domain code, but it should be easy to rebase on 0.8 as well","date":"2012-05-08T14:42:17.620Z","type":"message"}
{"nick":"felixge","message":"not sure how you manage that, but let me know if I can help","date":"2012-05-08T14:42:29.581Z","type":"message"}
{"nick":"isaacs","message":"i'll merge it in from 0.6","date":"2012-05-08T14:42:45.517Z","type":"message"}
{"nick":"isaacs","message":"as long as there's no other code changes required, though, go ahead and land it.","date":"2012-05-08T14:42:57.483Z","type":"message"}
{"nick":"isaacs","message":"it's pretty simple and clearly winful.","date":"2012-05-08T14:43:14.111Z","type":"message"}
{"nick":"felixge","message":"ok, running double checks on tests so","date":"2012-05-08T14:43:53.590Z","type":"message"}
{"nick":"felixge","message":"will ping you when rdy with final patch for a last look","date":"2012-05-08T14:44:02.479Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: it would be nice to land isaac's test as a test","date":"2012-05-08T14:46:27.878Z","type":"message"}
{"nick":"isaacs","message":"piscisaureus_: the test that's in there is basically that","date":"2012-05-08T14:46:36.291Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: maybe also one for process.nextTick not busylooping","date":"2012-05-08T14:46:40.694Z","type":"message"}
{"nick":"isaacs","message":"ryah_ and i think alike, apparently","date":"2012-05-08T14:46:46.850Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: I'm not quite sure how to test for non-busylooping, maybe with a timer?","date":"2012-05-08T14:47:25.228Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: that would be something like:","date":"2012-05-08T14:47:31.813Z","type":"message"}
{"nick":"piscisaureus_","message":"setTimeout(process.exit, 10);","date":"2012-05-08T14:47:32.012Z","type":"message"}
{"nick":"piscisaureus_","message":"function onNextTick() { process.nextTick(onNextTick));","date":"2012-05-08T14:47:32.012Z","type":"message"}
{"nick":"piscisaureus_","message":"onNextTick();","date":"2012-05-08T14:47:32.012Z","type":"message"}
{"nick":"isaacs","message":"actually, it's a bit more thorough than that: https://github.com/joyent/node/blob/v0.6/test/simple/test-next-tick-errors.js","date":"2012-05-08T14:48:08.590Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: actually, that test is also there I think","date":"2012-05-08T14:48:29.886Z","type":"message"}
{"nick":"piscisaureus_","message":"test-next-tick-starvation.js","date":"2012-05-08T14:48:30.277Z","type":"message"}
{"nick":"isaacs","message":"piscisaureus_: https://github.com/joyent/node/blob/v0.6/test/simple/test-next-tick-starvation.js","date":"2012-05-08T14:48:34.986Z","type":"message"}
{"nick":"isaacs","message":"yeah","date":"2012-05-08T14:48:35.984Z","type":"message"}
{"nick":"isaacs","message":"the tests we have are sufficient, i think","date":"2012-05-08T14:48:42.995Z","type":"message"}
{"nick":"felixge","message":"isaacs: that patch was done by ben: https://github.com/joyent/node/commit/57642e23497d5698aa4c5b8a44edff7b265c2283","date":"2012-05-08T14:48:45.191Z","type":"message"}
{"nick":"isaacs","message":"just the message tests might have to change.","date":"2012-05-08T14:48:47.587Z","type":"message"}
{"nick":"isaacs","message":"oh, haha","date":"2012-05-08T14:48:56.314Z","type":"message"}
{"nick":"isaacs","message":"bentomas and i think alike, then ;)","date":"2012-05-08T14:49:02.312Z","type":"message"}
{"nick":"felixge","message":"I tracked down the history to see when the try..catch was introduced","date":"2012-05-08T14:49:06.153Z","type":"message"}
{"nick":"felixge","message":":)","date":"2012-05-08T14:49:07.107Z","type":"message"}
{"nick":"felixge","message":"and was really upset when I discovered it was just there to fix the complexity of uncaughtException :)","date":"2012-05-08T14:49:34.018Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: but I really like that you're fixing this. It is so important and the test seems so simple.","date":"2012-05-08T14:50:07.476Z","type":"message"}
{"nick":"piscisaureus_","message":"s/test/fix/","date":"2012-05-08T14:50:14.567Z","type":"message"}
{"nick":"felixge","message":"isaacs: the tests you linked seem to cover the scenarios we discussed","date":"2012-05-08T14:50:51.142Z","type":"message"}
{"nick":"isaacs","message":"felixge: well, it's really just there to fix the fact that throwing gets you completely out of the territory","date":"2012-05-08T14:51:02.094Z","type":"message"}
{"nick":"felixge","message":"not sure if there is value in adding more starvation / uncaughtException tests","date":"2012-05-08T14:51:03.383Z","type":"message"}
{"nick":"isaacs","message":"nah","date":"2012-05-08T14:51:07.593Z","type":"message"}
{"nick":"isaacs","message":"more tests isn't always better.","date":"2012-05-08T14:51:20.556Z","type":"message"}
{"nick":"felixge","message":"in that case I'll just fix the message tests","date":"2012-05-08T14:51:21.677Z","type":"message"}
{"nick":"felixge","message":"those are the only ones broken","date":"2012-05-08T14:51:28.115Z","type":"message"}
{"nick":"isaacs","message":"kewl","date":"2012-05-08T14:51:28.919Z","type":"message"}
{"nick":"isaacs","message":"thanks felixge :)","date":"2012-05-08T14:51:32.744Z","type":"message"}
{"nick":"TheJH","date":"2012-05-08T14:55:55.018Z","type":"join"}
{"nick":"felixge","message":"https://github.com/felixge/node/commit/77def43c283dbc215b357560b5256e7c44c7708d","date":"2012-05-08T14:56:43.066Z","type":"message"}
{"nick":"felixge","message":"^--- new version","date":"2012-05-08T14:56:45.179Z","type":"message"}
{"nick":"felixge","message":"turns out we have another stupid re-throw thingie in module.js","date":"2012-05-08T14:57:00.405Z","type":"message"}
{"nick":"felixge","message":"that obfuscates errors","date":"2012-05-08T14:57:04.677Z","type":"message"}
{"nick":"felixge","message":"*sigh*","date":"2012-05-08T14:57:05.893Z","type":"message"}
{"nick":"felixge","message":"lets see if we can make that go away as well","date":"2012-05-08T14:57:14.806Z","type":"message"}
{"nick":"felixge","message":":0","date":"2012-05-08T14:57:15.780Z","type":"message"}
{"nick":"felixge","message":":)","date":"2012-05-08T14:57:16.768Z","type":"message"}
{"nick":"felixge","message":"seems like I'm to blame for all the bad error reporting in node: 66601f13d9f841fe4e644a0b106ea3106054f46a","date":"2012-05-08T14:59:22.591Z","type":"message"}
{"nick":"felixge","message":":'(","date":"2012-05-08T14:59:23.782Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: maybe you can salvage the stack.","date":"2012-05-08T15:00:45.661Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: I'm hoping this try…catch isn't even needed and we can change the order on the cache population","date":"2012-05-08T15:01:27.242Z","type":"message"}
{"nick":"felixge","message":"but I have a feeling it runs into conflict with circular require()","date":"2012-05-08T15:01:41.904Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: yeah I think that will break stuff","date":"2012-05-08T15:01:52.713Z","type":"message"}
{"nick":"felixge","message":"(which IMO we shouldn't allow, it almost always doesn't work the way you want it to)","date":"2012-05-08T15:01:58.814Z","type":"message"}
{"nick":"felixge","message":"yeah","date":"2012-05-08T15:02:24.917Z","type":"message"}
{"nick":"felixge","message":"breaks some module loading tests","date":"2012-05-08T15:02:28.714Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: \"not allowing\" is not that easy, because we would have to scan the require stack","date":"2012-05-08T15:02:29.675Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: we may need to salvage the stack here","date":"2012-05-08T15:02:45.475Z","type":"message"}
{"nick":"felixge","message":"but I'm not aware of how to do that","date":"2012-05-08T15:02:49.789Z","type":"message"}
{"nick":"felixge","message":"at least not without v8 magic","date":"2012-05-08T15:02:53.436Z","type":"message"}
{"nick":"piscisaureus_","message":"me neither","date":"2012-05-08T15:02:53.788Z","type":"message"}
{"nick":"felixge","message":"so hopefully I can find something better","date":"2012-05-08T15:03:02.288Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: I think an Error object captures a stack trace always. So maybe if we throw from c++ the stack will not be changed.","date":"2012-05-08T15:03:35.648Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: we could have something like process._rethrow(err)","date":"2012-05-08T15:03:53.725Z","type":"message"}
{"nick":"felixge","message":"well, but the capture stack trace is where the Error object was created","date":"2012-05-08T15:04:06.701Z","type":"message"}
{"nick":"felixge","message":"not where it was thrown","date":"2012-05-08T15:04:09.363Z","type":"message"}
{"nick":"felixge","message":"(I could be wrong)","date":"2012-05-08T15:04:23.055Z","type":"message"}
{"nick":"piscisaureus_","message":"yeah","date":"2012-05-08T15:04:35.485Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: so, why does the original stack not show up, then?","date":"2012-05-08T15:04:54.016Z","type":"message"}
{"nick":"piscisaureus_","message":"when we rethrow","date":"2012-05-08T15:05:01.825Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: btw - this also breaks in bad ways when caching a module is combined with circular deps","date":"2012-05-08T15:06:32.588Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: what breaks?","date":"2012-05-08T15:06:48.896Z","type":"message"}
{"nick":"felixge","message":"changing the order?","date":"2012-05-08T15:06:52.068Z","type":"message"}
{"nick":"felixge","message":"yeah, that's not gonna work","date":"2012-05-08T15:06:56.629Z","type":"message"}
{"nick":"piscisaureus_","message":"no","date":"2012-05-08T15:07:00.619Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: what is going on now","date":"2012-05-08T15:07:07.731Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: got a test case?","date":"2012-05-08T15:07:25.290Z","type":"message"}
{"nick":"felixge","message":"circular deps tangle my brainz","date":"2012-05-08T15:07:34.838Z","type":"message"}
{"nick":"felixge","message":":)","date":"2012-05-08T15:07:38.978Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: consider this thing:","date":"2012-05-08T15:08:22.713Z","type":"message"}
{"nick":"piscisaureus_","message":"// a.js:","date":"2012-05-08T15:08:22.911Z","type":"message"}
{"nick":"piscisaureus_","message":"var B = require('b');","date":"2012-05-08T15:08:22.911Z","type":"message"}
{"nick":"piscisaureus_","message":"\u0003throw \"foo\";","date":"2012-05-08T15:08:22.911Z","type":"message"}
{"nick":"piscisaureus_","message":"\u0003// b.js","date":"2012-05-08T15:08:22.911Z","type":"message"}
{"nick":"piscisaureus_","message":"var A = require('b');","date":"2012-05-08T15:08:23.111Z","type":"message"}
{"nick":"piscisaureus_","message":"// master.js","date":"2012-05-08T15:08:23.111Z","type":"message"}
{"nick":"piscisaureus_","message":"require('a');","date":"2012-05-08T15:08:24.025Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: b.js is still cached","date":"2012-05-08T15:08:37.021Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: but it is using the broken & throwing copy of a","date":"2012-05-08T15:08:52.737Z","type":"message"}
{"nick":"felixge","message":"you mean './'","date":"2012-05-08T15:08:55.351Z","type":"message"}
{"nick":"felixge","message":"in all your requires?","date":"2012-05-08T15:09:02.326Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: yeah so whenever you require('b') it will use the broken copy of a","date":"2012-05-08T15:09:23.849Z","type":"message"}
{"nick":"piscisaureus_","message":"er well there's some bugs in my code","date":"2012-05-08T15:09:47.165Z","type":"message"}
{"nick":"piscisaureus_","message":"let me create a real test case","date":"2012-05-08T15:09:55.863Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: that'd be great","date":"2012-05-08T15:10:03.525Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: I think it is unfixable though","date":"2012-05-08T15:10:15.975Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: I thought that about process.nextTick as well for a long time","date":"2012-05-08T15:10:37.866Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: I'd like to at least see if I can get somewhere with it","date":"2012-05-08T15:11:12.101Z","type":"message"}
{"nick":"loladiro","reason":"Quit: loladiro","date":"2012-05-08T15:12:39.370Z","type":"quit"}
{"nick":"piscisaureus_","message":"felixge: https://github.com/piscisaureus/forfelix","date":"2012-05-08T15:17:31.353Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: if it is correct, you `node main.js` should output \"ok\" twice","date":"2012-05-08T15:17:49.987Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: good luck with that. I think this is unfixable.","date":"2012-05-08T15:18:00.418Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: and this is with the current module system without mods, right?","date":"2012-05-08T15:18:31.677Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: yep","date":"2012-05-08T15:18:47.808Z","type":"message"}
{"nick":"felixge","message":"ok","date":"2012-05-08T15:19:27.028Z","type":"message"}
{"nick":"felixge","message":"I like unfixable","date":"2012-05-08T15:19:34.834Z","type":"message"}
{"nick":"felixge","message":"will have a look","date":"2012-05-08T15:19:37.150Z","type":"message"}
{"nick":"piscisaureus_","message":"isaacs: you too - try that: \u000301https://github.com/\u000310piscisaureus\u000301/forfelix\u0003","date":"2012-05-08T15:19:47.991Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: brain hurts","date":"2012-05-08T15:22:35.490Z","type":"message"}
{"nick":"felixge","message":":)","date":"2012-05-08T15:22:36.233Z","type":"message"}
{"nick":"felixge","message":"I would actually expect b.getStateOfA() to report 'broken'","date":"2012-05-08T15:23:25.028Z","type":"message"}
{"nick":"felixge","message":"but: console.log(a.getState()); should report 'ok'","date":"2012-05-08T15:24:04.417Z","type":"message"}
{"nick":"felixge","message":"in your example","date":"2012-05-08T15:24:07.061Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: well it does report ok, right?","date":"2012-05-08T15:24:17.515Z","type":"message"}
{"nick":"felixge","message":"at least that would seem like the correct/best behavior to me","date":"2012-05-08T15:24:17.716Z","type":"message"}
{"nick":"felixge","message":"oh shit","date":"2012-05-08T15:24:34.662Z","type":"message"}
{"nick":"felixge","message":"hah, was running wrong node build","date":"2012-05-08T15:24:41.425Z","type":"message"}
{"nick":"felixge","message":"yes","date":"2012-05-08T15:24:41.950Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: but how would b.js have know that a.js is broken","date":"2012-05-08T15:24:43.166Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: require('a.js') succeeded without throwing for it","date":"2012-05-08T15:25:03.274Z","type":"message"}
{"nick":"felixge","message":"because it was broken at the time it required it","date":"2012-05-08T15:25:04.109Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: well, normally that could never happen. require() would throw, and the module would not be cached","date":"2012-05-08T15:25:45.891Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: but in the presence of circular deps, that doesn't work","date":"2012-05-08T15:25:57.287Z","type":"message"}
{"nick":"dshaw_","date":"2012-05-08T15:26:06.225Z","type":"join"}
{"nick":"piscisaureus_","message":"felixge: because a.js *is* cached for a while and is then removed from the cache again when it throws","date":"2012-05-08T15:26:39.322Z","type":"message"}
{"nick":"felixge","message":"yes","date":"2012-05-08T15:26:48.286Z","type":"message"}
{"nick":"felixge","message":"this whole caching business is very fucked up :)","date":"2012-05-08T15:26:59.536Z","type":"message"}
{"nick":"piscisaureus_","message":"yup","date":"2012-05-08T15:27:10.042Z","type":"message"}
{"nick":"felixge","message":"that's why I'd rather have circular deps report call stack size exceeded","date":"2012-05-08T15:27:31.765Z","type":"message"}
{"nick":"felixge","message":"and say fuck it to those who think they need it","date":"2012-05-08T15:27:38.897Z","type":"message"}
{"nick":"felixge","message":":)","date":"2012-05-08T15:27:39.836Z","type":"message"}
{"nick":"piscisaureus_","message":"what we maybe could do is expunge b.js from the cache too","date":"2012-05-08T15:27:42.853Z","type":"message"}
{"nick":"piscisaureus_","message":"somehow","date":"2012-05-08T15:27:48.199Z","type":"message"}
{"nick":"piscisaureus_","message":"when a throws","date":"2012-05-08T15:27:53.188Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: I had a patch for cascading caches a long time ago","date":"2012-05-08T15:28:01.830Z","type":"message"}
{"nick":"felixge","message":"where each module had it's own cache","date":"2012-05-08T15:28:07.549Z","type":"message"}
{"nick":"felixge","message":"and things could branch off","date":"2012-05-08T15:28:12.840Z","type":"message"}
{"nick":"felixge","message":"IMO that would have made things like this simpler","date":"2012-05-08T15:28:21.245Z","type":"message"}
{"nick":"piscisaureus_","message":"you'd have to talk to isaacs about that","date":"2012-05-08T15:28:34.252Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: actually I sworn to myself never to talk about it again : p","date":"2012-05-08T15:28:47.412Z","type":"message"}
{"nick":"felixge","message":"as it was a similar time sink as my work on promises ","date":"2012-05-08T15:28:57.313Z","type":"message"}
{"nick":"felixge","message":"30-40 hours down the train without much to show for it :p","date":"2012-05-08T15:29:13.027Z","type":"message"}
{"nick":"piscisaureus_","message":":-)","date":"2012-05-08T15:29:17.775Z","type":"message"}
{"nick":"tjfontaine","message":"last I heard isaacs doesn't want to touch the module stuff anymore :)","date":"2012-05-08T15:29:28.897Z","type":"message"}
{"nick":"piscisaureus_","message":"Hows does tc39 define caching for their ES.next module system?","date":"2012-05-08T15:29:34.283Z","type":"message"}
{"nick":"pfox__","message":"Morning. /w 2","date":"2012-05-08T15:29:47.632Z","type":"message"}
{"nick":"pfox__","message":"heh. whoops.","date":"2012-05-08T15:29:52.880Z","type":"message"}
{"nick":"felixge","message":"so for now … all I'm interested in is to see if I can fix stack trace output without changing existing behavior","date":"2012-05-08T15:29:58.190Z","type":"message"}
{"nick":"piscisaureus_","message":"right","date":"2012-05-08T15:30:24.543Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: well  you have a test here :-0","date":"2012-05-08T15:30:30.300Z","type":"message"}
{"nick":"piscisaureus_","message":"Imma finish up the string speed patch","date":"2012-05-08T15:30:47.753Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: YES!","date":"2012-05-08T15:30:58.838Z","type":"message"}
{"nick":"felixge","message":"please do that","date":"2012-05-08T15:31:01.574Z","type":"message"}
{"nick":"felixge","message":":)","date":"2012-05-08T15:31:02.723Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: oh - not that one ...","date":"2012-05-08T15:31:09.042Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: this one speeds up string writes to a socket","date":"2012-05-08T15:31:19.255Z","type":"message"}
{"nick":"felixge","message":"that I like too!","date":"2012-05-08T15:31:25.426Z","type":"message"}
{"nick":"felixge","message":":)","date":"2012-05-08T15:31:25.948Z","type":"message"}
{"nick":"felixge","message":"right now there is no intelligent batching when doing lots of small write()'s","date":"2012-05-08T15:31:51.341Z","type":"message"}
{"nick":"felixge","message":"I helped the VoltDB guys get their insert / sec performance from 7k / sec to ~12k / sec doing write batching in user land","date":"2012-05-08T15:32:18.814Z","type":"message"}
{"nick":"felixge","message":"(assuming this is kind of what you're going to do as well)","date":"2012-05-08T15:32:27.077Z","type":"message"}
{"nick":"felixge","message":"oh wait","date":"2012-05-08T15:32:28.901Z","type":"message"}
{"nick":"felixge","message":"you mean copying data out of a v8 string","date":"2012-05-08T15:32:34.912Z","type":"message"}
{"nick":"felixge","message":"the old problem","date":"2012-05-08T15:32:38.248Z","type":"message"}
{"nick":"felixge","message":"nvm","date":"2012-05-08T15:32:38.911Z","type":"message"}
{"nick":"felixge","message":":)","date":"2012-05-08T15:32:39.576Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: well... let's just say it's something :-)","date":"2012-05-08T15:32:52.681Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: the intelligent batching we could do too... But only for strings, and not for buffers","date":"2012-05-08T15:33:19.542Z","type":"message"}
{"nick":"isaacs","message":"piscisaureus_: can you explain this test?  i'm kind of confused.","date":"2012-05-08T15:36:53.176Z","type":"message"}
{"nick":"isaacs","message":"what's the issue?","date":"2012-05-08T15:36:54.943Z","type":"message"}
{"nick":"piscisaureus_","message":"isaacs: so modules that throw are not supposed to be cached","date":"2012-05-08T15:37:24.713Z","type":"message"}
{"nick":"piscisaureus_","message":"isaacs: but a.js does get cached","date":"2012-05-08T15:37:34.351Z","type":"message"}
{"nick":"isaacs","message":"you'd expect the require('./a.js') from b.js to re-load it?","date":"2012-05-08T15:37:36.112Z","type":"message"}
{"nick":"isaacs","message":"who says that modules that throw are not supposed to be cached?","date":"2012-05-08T15:37:43.053Z","type":"message"}
{"nick":"piscisaureus_","message":"isaacs: module.js says that","date":"2012-05-08T15:37:50.551Z","type":"message"}
{"nick":"isaacs","message":"hrm...","date":"2012-05-08T15:37:55.913Z","type":"message"}
{"nick":"isaacs","message":"where?","date":"2012-05-08T15:38:00.176Z","type":"message"}
{"nick":"isaacs","message":"cuz i think it module.js says that a.js should be cached ;P","date":"2012-05-08T15:38:09.863Z","type":"message"}
{"nick":"isaacs","message":"since it's getting cached.","date":"2012-05-08T15:38:14.200Z","type":"message"}
{"nick":"piscisaureus_","message":"umm felix came up with that","date":"2012-05-08T15:38:15.078Z","type":"message"}
{"nick":"piscisaureus_","message":"isaacs: have to run now. bb in 20 minutes.","date":"2012-05-08T15:38:23.115Z","type":"message"}
{"nick":"piscisaureus_","message":"sorry","date":"2012-05-08T15:38:26.362Z","type":"message"}
{"nick":"isaacs","message":"k","date":"2012-05-08T15:38:57.791Z","type":"message"}
{"nick":"isaacs","message":"  Module._cache[filename] = module;","date":"2012-05-08T15:38:59.747Z","type":"message"}
{"nick":"isaacs","message":"  try {","date":"2012-05-08T15:38:59.952Z","type":"message"}
{"nick":"isaacs","message":"    module.load(filename);","date":"2012-05-08T15:38:59.952Z","type":"message"}
{"nick":"isaacs","message":"  } catch (err) {","date":"2012-05-08T15:39:01.783Z","type":"message"}
{"nick":"isaacs","message":"    delete Module._cache[filename];","date":"2012-05-08T15:39:03.784Z","type":"message"}
{"nick":"isaacs","message":"    throw err;","date":"2012-05-08T15:39:05.782Z","type":"message"}
{"nick":"isaacs","message":"  }","date":"2012-05-08T15:39:07.813Z","type":"message"}
{"nick":"isaacs","message":"this bit?","date":"2012-05-08T15:39:09.798Z","type":"message"}
{"nick":"isaacs","message":"ohh.... i see.","date":"2012-05-08T15:41:32.177Z","type":"message"}
{"nick":"isaacs","message":"so, modules that throw ARE removed from the cache.  however, that doesn't mean that all their CHILDREN are removed from teh cache.","date":"2012-05-08T15:41:48.587Z","type":"message"}
{"nick":"isaacs","message":"or that their children won't already have a reference to the module contents that were in the cache in the first place.","date":"2012-05-08T15:42:09.189Z","type":"message"}
{"nick":"isaacs","message":"after first require, cache= [ '/Users/isaacs/dev/js/forfelix/main.js',","date":"2012-05-08T15:43:06.145Z","type":"message"}
{"nick":"isaacs","message":"  '/Users/isaacs/dev/js/forfelix/b.js' ]","date":"2012-05-08T15:43:06.348Z","type":"message"}
{"nick":"felixge","message":"isaacs: ^--- yes, afaik that's what is being discussed (slightly confused myself with bert's brain twister)","date":"2012-05-08T15:44:37.256Z","type":"message"}
{"nick":"felixge","message":"unfortunately headed out for food now","date":"2012-05-08T15:44:43.456Z","type":"message"}
{"nick":"isaacs","message":"ok","date":"2012-05-08T15:44:46.291Z","type":"message"}
{"nick":"felixge","message":"will be back later today","date":"2012-05-08T15:44:50.679Z","type":"message"}
{"nick":"isaacs","message":"well, i have a small fix that seems correct.","date":"2012-05-08T15:44:55.337Z","type":"message"}
{"nick":"isaacs","message":"this does seem like a bug, but it's enough of an edge case that i think we can justify not fixing it, maybe.","date":"2012-05-08T15:45:10.430Z","type":"message"}
{"nick":"felixge","message":"isaacs: looking forward to discuss in a bit. I was mostly interested in getting rid of the re-throw to stop obfuscating exceptions that are thrown during module loading","date":"2012-05-08T15:45:37.335Z","type":"message"}
{"nick":"felixge","message":"so if your patch helps with that as well, that'd be insanely great","date":"2012-05-08T15:45:48.597Z","type":"message"}
{"nick":"felixge","message":"ok ttyl","date":"2012-05-08T15:45:51.038Z","type":"message"}
{"nick":"isaacs","message":"felixge: no, it makes it worse :)","date":"2012-05-08T15:45:54.049Z","type":"message"}
{"nick":"isaacs","message":"enjoy your food","date":"2012-05-08T15:45:59.743Z","type":"message"}
{"nick":"stephank","date":"2012-05-08T15:46:38.038Z","type":"join"}
{"nick":"c4milo","reason":"Read error: Connection reset by peer","date":"2012-05-08T15:51:02.752Z","type":"quit"}
{"nick":"dap","date":"2012-05-08T15:51:42.721Z","type":"join"}
{"nick":"felixge","reason":"Quit: felixge","date":"2012-05-08T15:55:41.022Z","type":"quit"}
{"nick":"c4milo","date":"2012-05-08T15:56:46.456Z","type":"join"}
{"nick":"stephank","reason":"Read error: No route to host","date":"2012-05-08T16:00:52.752Z","type":"quit"}
{"nick":"bnoordhuis","message":"back","date":"2012-05-08T16:01:34.273Z","type":"message"}
{"nick":"bnoordhuis","message":"oh, felixge is gone again","date":"2012-05-08T16:03:34.562Z","type":"message"}
{"nick":"mmalecki","date":"2012-05-08T16:05:17.668Z","type":"join"}
{"nick":"orlandovftw","date":"2012-05-08T16:19:50.907Z","type":"join"}
{"nick":"isaacs","message":"i've got a fix that i think makes this work like we all want.","date":"2012-05-08T16:22:55.625Z","type":"message"}
{"nick":"isaacs","message":"unfortunately, it changes module.js /o\\","date":"2012-05-08T16:23:06.022Z","type":"message"}
{"nick":"isaacs","message":"but i don't think there's a way around that","date":"2012-05-08T16:23:12.324Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: does gcc support the c++ keyword \"decltype\" ?","date":"2012-05-08T16:24:35.030Z","type":"message"}
{"nick":"piscisaureus_","message":"or __typeof__ / typeof ?","date":"2012-05-08T16:24:40.313Z","type":"message"}
{"nick":"bnoordhuis","message":"piscisaureus_: gcc has a typeof operator","date":"2012-05-08T16:25:08.986Z","type":"message"}
{"nick":"bnoordhuis","message":"decltype is a c++11 thing btw","date":"2012-05-08T16:25:27.219Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: I know...","date":"2012-05-08T16:25:35.216Z","type":"message"}
{"nick":"bnoordhuis","message":"piscisaureus_: so what are you trying to do?","date":"2012-05-08T16:26:43.923Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: check if buf.len doesn't overflow","date":"2012-05-08T16:27:16.710Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: so basically, assert((typeof(buf.len)) size == size)","date":"2012-05-08T16:28:23.500Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: but I will do the bit twiddling instead... that's more supported","date":"2012-05-08T16:28:51.247Z","type":"message"}
{"nick":"isaacs","message":"piscisaureus_: https://github.com/isaacs/node/commit/790fe6253f529d32c20c5d29a855a86798356d35","date":"2012-05-08T16:32:54.412Z","type":"message"}
{"nick":"piscisaureus_","message":"isaacs: so now what happens if the user does","date":"2012-05-08T16:35:03.962Z","type":"message"}
{"nick":"piscisaureus_","message":"try {","date":"2012-05-08T16:35:04.163Z","type":"message"}
{"nick":"piscisaureus_","message":"  require('a');","date":"2012-05-08T16:35:04.164Z","type":"message"}
{"nick":"piscisaureus_","message":"} catch(e) {","date":"2012-05-08T16:35:04.164Z","type":"message"}
{"nick":"piscisaureus_","message":"  require('a');","date":"2012-05-08T16:35:04.164Z","type":"message"}
{"nick":"piscisaureus_","message":"}","date":"2012-05-08T16:35:04.164Z","type":"message"}
{"nick":"piscisaureus_","message":"isaacs: does the second require make another attempt or does it return the broken module","date":"2012-05-08T16:35:21.710Z","type":"message"}
{"nick":"piscisaureus_","message":"isaacs: (these cases are so edge-y that they are hardly worth thinking of)","date":"2012-05-08T16:35:37.402Z","type":"message"}
{"nick":"isaacs","message":"piscisaureus_: nono, they're definitely worth thinking of.","date":"2012-05-08T16:36:00.225Z","type":"message"}
{"nick":"isaacs","message":"it tries again","date":"2012-05-08T16:36:02.550Z","type":"message"}
{"nick":"piscisaureus_","message":"isaacs: are you sure?","date":"2012-05-08T16:36:15.274Z","type":"message"}
{"nick":"isaacs","message":"which is what it would have done last time, as well, except that the *child* caused another cached copy to be created.","date":"2012-05-08T16:36:16.177Z","type":"message"}
{"nick":"piscisaureus_","message":"isaacs: it depends on when the finally block runs right?","date":"2012-05-08T16:36:23.835Z","type":"message"}
{"nick":"isaacs","message":"piscisaureus_: the finally block runs after everything.","date":"2012-05-08T16:36:34.861Z","type":"message"}
{"nick":"isaacs","message":"piscisaureus_: but before teh return","date":"2012-05-08T16:36:41.856Z","type":"message"}
{"nick":"piscisaureus_","message":"ah, right, ok","date":"2012-05-08T16:36:46.599Z","type":"message"}
{"nick":"piscisaureus_","message":"then it works","date":"2012-05-08T16:36:51.285Z","type":"message"}
{"nick":"c4milo","reason":"Ping timeout: 252 seconds","date":"2012-05-08T16:37:01.216Z","type":"quit"}
{"nick":"piscisaureus_","message":"I never realized that you could do this stuff with try..finally","date":"2012-05-08T16:37:04.364Z","type":"message"}
{"nick":"isaacs","message":"the key is that the line after the load in the try block","date":"2012-05-08T16:37:05.938Z","type":"message"}
{"nick":"isaacs","message":"gets skipped over","date":"2012-05-08T16:37:10.657Z","type":"message"}
{"nick":"isaacs","message":"piscisaureus_: wanna see a *really* awesome trick?","date":"2012-05-08T16:37:15.503Z","type":"message"}
{"nick":"piscisaureus_","message":"actually it's pretty powerful","date":"2012-05-08T16:37:17.946Z","type":"message"}
{"nick":"isaacs","message":"and by awesome, i mean, \"don't ever do this ever\"?","date":"2012-05-08T16:37:24.062Z","type":"message"}
{"nick":"piscisaureus_","message":"sure","date":"2012-05-08T16:37:28.475Z","type":"message"}
{"nick":"isaacs","message":"> var y; function x () { y = 100; try { return y } finally { y = 0 } }; x()","date":"2012-05-08T16:38:17.007Z","type":"message"}
{"nick":"isaacs","message":"100","date":"2012-05-08T16:38:17.212Z","type":"message"}
{"nick":"isaacs","message":"> y","date":"2012-05-08T16:38:17.212Z","type":"message"}
{"nick":"isaacs","message":"0","date":"2012-05-08T16:38:18.593Z","type":"message"}
{"nick":"piscisaureus_","message":"heh","date":"2012-05-08T16:38:45.502Z","type":"message"}
{"nick":"piscisaureus_","message":"orly","date":"2012-05-08T16:38:46.583Z","type":"message"}
{"nick":"piscisaureus_","message":"lol","date":"2012-05-08T16:38:56.776Z","type":"message"}
{"nick":"piscisaureus_","message":"is that in the spec?","date":"2012-05-08T16:39:02.075Z","type":"message"}
{"nick":"isaacs","message":"function x () { y = {foo:'bar'}; try { return y } finally { delete y.foo } }; x().foo","date":"2012-05-08T16:39:03.218Z","type":"message"}
{"nick":"isaacs","message":"oh, yeah","date":"2012-05-08T16:39:05.440Z","type":"message"}
{"nick":"isaacs","message":"so, pop quiz: does this eval to 'bar', or undefined?","date":"2012-05-08T16:39:18.416Z","type":"message"}
{"nick":"piscisaureus_","message":"undefined","date":"2012-05-08T16:39:45.300Z","type":"message"}
{"nick":"isaacs","message":"piscisaureus_++","date":"2012-05-08T16:39:49.966Z","type":"message"}
{"nick":"kohai","message":"piscisaureus_ has 10 beers","date":"2012-05-08T16:39:50.383Z","type":"message"}
{"nick":"piscisaureus_","message":"that makes sense","date":"2012-05-08T16:39:57.253Z","type":"message"}
{"nick":"isaacs","message":"the semantics of return are that it marks the object as the return value, then evaluates the finally block, then resolves to the eventual return value","date":"2012-05-08T16:40:17.069Z","type":"message"}
{"nick":"piscisaureus_","message":"it should not push the (.foo) resolution into the function obdy","date":"2012-05-08T16:40:18.422Z","type":"message"}
{"nick":"isaacs","message":"however, it's not a matter of moving the finally block above the return statement","date":"2012-05-08T16:40:42.870Z","type":"message"}
{"nick":"isaacs","message":"simple values are not changed","date":"2012-05-08T16:40:52.347Z","type":"message"}
{"nick":"piscisaureus_","message":"isaacs: because they are primitives","date":"2012-05-08T16:41:06.957Z","type":"message"}
{"nick":"isaacs","message":"right","date":"2012-05-08T16:41:09.803Z","type":"message"}
{"nick":"piscisaureus_","message":"isaacs: I wonder what happens with ValueObjects","date":"2012-05-08T16:41:13.508Z","type":"message"}
{"nick":"isaacs","message":"> var y; function x () { y = new Number(100); try { return y } finally { y.valueOf = function () { return 0 } } }; +x()","date":"2012-05-08T16:41:56.448Z","type":"message"}
{"nick":"isaacs","message":"0","date":"2012-05-08T16:41:56.647Z","type":"message"}
{"nick":"isaacs","message":"assigning the ref to a new thing won't chagne it","date":"2012-05-08T16:42:12.312Z","type":"message"}
{"nick":"isaacs","message":"> var y; function x () { y = new Number(100); try { return y } finally { y = new Number(0) } }; +x()","date":"2012-05-08T16:42:29.086Z","type":"message"}
{"nick":"isaacs","message":"100","date":"2012-05-08T16:42:29.288Z","type":"message"}
{"nick":"isaacs","message":"the return statement captures a reference to a specific object or value.","date":"2012-05-08T16:42:40.619Z","type":"message"}
{"nick":"isaacs","message":"uglify abuses this trick like crazy","date":"2012-05-08T16:43:21.641Z","type":"message"}
{"nick":"piscisaureus_","message":"I have the feeling that we could find a spec violation here if we look hard enough","date":"2012-05-08T16:43:29.561Z","type":"message"}
{"nick":"isaacs","message":"try { return node } finally { parse(node.children) }","date":"2012-05-08T16:43:35.361Z","type":"message"}
{"nick":"isaacs","message":"piscisaureus_: i doubt it","date":"2012-05-08T16:43:51.756Z","type":"message"}
{"nick":"piscisaureus_","message":"isaacs: something with the arguments is always a win","date":"2012-05-08T16:44:23.547Z","type":"message"}
{"nick":"theCole","date":"2012-05-08T16:49:14.227Z","type":"join"}
{"nick":"igorzi","date":"2012-05-08T16:53:12.346Z","type":"join"}
{"nick":"`3rdEden","date":"2012-05-08T16:53:21.025Z","type":"join"}
{"nick":"isaacs","message":"ircretary: tell felixge https://github.com/joyent/node/issues/3235","date":"2012-05-08T16:58:20.675Z","type":"message"}
{"nick":"ircretary","message":"isaacs: I'll be sure to tell felixge","date":"2012-05-08T16:58:20.879Z","type":"message"}
{"nick":"theCole","reason":"Quit: theCole","date":"2012-05-08T17:00:39.393Z","type":"quit"}
{"nick":"isaacs","reason":"Remote host closed the connection","date":"2012-05-08T17:03:45.921Z","type":"quit"}
{"nick":"philips","reason":"Excess Flood","date":"2012-05-08T17:11:05.288Z","type":"quit"}
{"nick":"orlandovftw","reason":"Ping timeout: 265 seconds","date":"2012-05-08T17:12:02.670Z","type":"quit"}
{"nick":"philips","date":"2012-05-08T17:13:50.787Z","type":"join"}
{"nick":"TooTallNate","date":"2012-05-08T17:29:30.262Z","type":"join"}
{"nick":"CoverSlide","date":"2012-05-08T17:33:15.417Z","type":"join"}
{"nick":"erickt","date":"2012-05-08T17:36:49.137Z","type":"join"}
{"nick":"avalanche123","date":"2012-05-08T17:43:24.020Z","type":"join"}
{"nick":"dshaw_","reason":"Quit: Leaving.","date":"2012-05-08T17:45:58.932Z","type":"quit"}
{"nick":"orlandovftw","date":"2012-05-08T17:57:33.150Z","type":"join"}
{"nick":"ljackson","reason":"Read error: Operation timed out","date":"2012-05-08T18:05:36.231Z","type":"quit"}
{"nick":"ljackson","date":"2012-05-08T18:07:45.263Z","type":"join"}
{"nick":"brson","date":"2012-05-08T18:09:36.609Z","type":"join"}
{"nick":"dshaw_","date":"2012-05-08T18:10:21.327Z","type":"join"}
{"nick":"c4milo","date":"2012-05-08T18:11:18.899Z","type":"join"}
{"nick":"isaacs","date":"2012-05-08T18:13:38.491Z","type":"join"}
{"nick":"piscisaureus_","message":"bnoordhuis: yt?","date":"2012-05-08T18:22:08.203Z","type":"message"}
{"nick":"mjr_","date":"2012-05-08T18:31:16.322Z","type":"join"}
{"nick":"indexzero","date":"2012-05-08T18:32:40.228Z","type":"join"}
{"nick":"mikeal","date":"2012-05-08T18:41:40.140Z","type":"join"}
{"nick":"mikeal","reason":"Quit: Leaving.","date":"2012-05-08T18:59:30.699Z","type":"quit"}
{"nick":"igorzi","message":"piscisaureus_: hey.. yt?","date":"2012-05-08T19:01:47.180Z","type":"message"}
{"nick":"brson","reason":"Ping timeout: 255 seconds","date":"2012-05-08T19:01:51.169Z","type":"quit"}
{"nick":"piscisaureus_","message":"igorzi: yep. sup?","date":"2012-05-08T19:02:03.128Z","type":"message"}
{"nick":"igorzi","message":"piscisaureus_: for junction points.. your original patch only worked if the source path is absolute.. i'm making it work with relative path as well (prepending cwd).. just wanted to confirm with you","date":"2012-05-08T19:02:55.513Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: oh, that's okay","date":"2012-05-08T19:03:07.943Z","type":"message"}
{"nick":"igorzi","message":"piscisaureus_: k.. i'll have a patch for you to review in a couple of hours","date":"2012-05-08T19:03:29.795Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: I think junction points can just be relative if you don't prepend \\\\.\\","date":"2012-05-08T19:03:30.515Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: but if they're absolute this thing has to be prepended","date":"2012-05-08T19:03:47.607Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: I don't think we should be making junctions absolute ourselves since that breaks moving them","date":"2012-05-08T19:04:09.357Z","type":"message"}
{"nick":"igorzi","message":"piscisaureus_: i see","date":"2012-05-08T19:04:35.490Z","type":"message"}
{"nick":"igorzi","message":"piscisaureus_: ok, i'll try that","date":"2012-05-08T19:04:55.630Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: also, we shouldn't prepend \\\\?\\ if it already has that :-)","date":"2012-05-08T19:05:28.732Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: I think my version doesn't account for that","date":"2012-05-08T19:05:37.785Z","type":"message"}
{"nick":"igorzi","message":"piscisaureus_: yep","date":"2012-05-08T19:05:45.265Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: kewl. I'll leave it to you from here.","date":"2012-05-08T19:05:58.742Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: still watching tv?","date":"2012-05-08T19:06:15.025Z","type":"message"}
{"nick":"theCole","date":"2012-05-08T19:11:12.228Z","type":"join"}
{"nick":"indexzero","reason":"Quit: indexzero","date":"2012-05-08T19:12:46.028Z","type":"quit"}
{"nick":"theCole","reason":"Client Quit","date":"2012-05-08T19:15:08.901Z","type":"quit"}
{"nick":"theCole","date":"2012-05-08T19:17:17.218Z","type":"join"}
{"nick":"`3rdEden","reason":"Quit: Leaving...","date":"2012-05-08T19:28:16.451Z","type":"quit"}
{"nick":"theCole","reason":"Quit: theCole","date":"2012-05-08T19:28:53.079Z","type":"quit"}
{"nick":"felixge","date":"2012-05-08T19:39:41.230Z","type":"join"}
{"nick":"felixge","reason":"Changing host","date":"2012-05-08T19:39:41.579Z","type":"quit"}
{"nick":"felixge","date":"2012-05-08T19:39:41.778Z","type":"join"}
{"nick":"mikeal","date":"2012-05-08T19:42:56.510Z","type":"join"}
{"nick":"indexzero","date":"2012-05-08T19:44:38.155Z","type":"join"}
{"nick":"TheJH","reason":"Ping timeout: 272 seconds","date":"2012-05-08T19:52:34.755Z","type":"quit"}
{"nick":"felixge","message":"isaacs: finally !!!","date":"2012-05-08T19:53:37.346Z","type":"message"}
{"nick":"felixge","message":"never had a good use for this","date":"2012-05-08T19:53:42.910Z","type":"message"}
{"nick":"felixge","message":"https://github.com/isaacs/node/commit/790fe6253f529d32c20c5d29a855a86798356d35","date":"2012-05-08T19:54:11.897Z","type":"message"}
{"nick":"felixge","message":"^--- <3","date":"2012-05-08T19:54:13.687Z","type":"message"}
{"nick":"felixge","message":"isaacs: I dislike the added complexity","date":"2012-05-08T19:57:17.271Z","type":"message"}
{"nick":"felixge","message":"but love the end result","date":"2012-05-08T19:57:20.919Z","type":"message"}
{"nick":"felixge","message":"so +1 on merging","date":"2012-05-08T19:57:27.634Z","type":"message"}
{"nick":"felixge","message":"also https://github.com/felixge/node/commit/77def43c283dbc215b357560b5256e7c44c7708d (my commit) is done from my PoV","date":"2012-05-08T19:57:51.258Z","type":"message"}
{"nick":"felixge","message":"so those two would go together really well :)","date":"2012-05-08T19:58:05.720Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge's commit lgtm","date":"2012-05-08T19:58:45.303Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: looks like isaacs patch also fixes your \"unfixable\" problem? :)","date":"2012-05-08T19:59:19.287Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: I am sure there is an edge case it doesn't cover :-)","date":"2012-05-08T19:59:33.812Z","type":"message"}
{"nick":"piscisaureus_","message":"but it's an improvement so _1","date":"2012-05-08T19:59:54.568Z","type":"message"}
{"nick":"piscisaureus_","message":"+1","date":"2012-05-08T19:59:56.092Z","type":"message"}
{"nick":"felixge","message":"I'm actually not sure if I want to fix your problem and do the throw thing in one patch","date":"2012-05-08T20:00:01.433Z","type":"message"}
{"nick":"felixge","message":"I think the 'finally' trick itself fixes the call site issue","date":"2012-05-08T20:00:10.907Z","type":"message"}
{"nick":"felixge","message":"and would be much simpler / less risky patch","date":"2012-05-08T20:00:16.735Z","type":"message"}
{"nick":"felixge","message":"unless I'm missing something","date":"2012-05-08T20:00:37.512Z","type":"message"}
{"nick":"felixge","message":"but I feel like isaacs patch seems more 0.8ish","date":"2012-05-08T20:00:51.910Z","type":"message"}
{"nick":"felixge","message":"than 0.6","date":"2012-05-08T20:00:54.097Z","type":"message"}
{"nick":"felixge","message":"but a small part of it could go into 0.6","date":"2012-05-08T20:00:59.747Z","type":"message"}
{"nick":"piscisaureus_","message":"maybe the patch can be broken up","date":"2012-05-08T20:00:59.946Z","type":"message"}
{"nick":"felixge","message":"yeah","date":"2012-05-08T20:01:02.760Z","type":"message"}
{"nick":"felixge","message":"let me try that","date":"2012-05-08T20:01:04.739Z","type":"message"}
{"nick":"piscisaureus_","message":"so we can port the try...finally thing to 0.6","date":"2012-05-08T20:01:08.902Z","type":"message"}
{"nick":"felixge","message":"ok, doesn't seem to be quite that easy","date":"2012-05-08T20:02:59.047Z","type":"message"}
{"nick":"felixge","message":"https://github.com/felixge/node/commit/9f146953bc6dd34c2f6c7f78842b97fb7954b7a2","date":"2012-05-08T20:03:21.410Z","type":"message"}
{"nick":"felixge","message":"^--- fails the module loading test for me","date":"2012-05-08T20:03:27.471Z","type":"message"}
{"nick":"felixge","message":"AssertionError: false == true","date":"2012-05-08T20:03:34.785Z","type":"message"}
{"nick":"felixge","message":"    at Object.<anonymous> (/Users/Felix/code/node/test/simple/test-module-loading.js:80:8)","date":"2012-05-08T20:03:35.341Z","type":"message"}
{"nick":"felixge","message":"oh wait I know why","date":"2012-05-08T20:03:48.442Z","type":"message"}
{"nick":"felixge","message":"I have to somehow know if finally was triggered by an exception or not","date":"2012-05-08T20:04:00.551Z","type":"message"}
{"nick":"piscisaureus_","message":"hmm","date":"2012-05-08T20:04:38.649Z","type":"message"}
{"nick":"piscisaureus_","message":"how does isaac know?","date":"2012-05-08T20:05:01.900Z","type":"message"}
{"nick":"felixge","message":"not sure","date":"2012-05-08T20:05:24.046Z","type":"message"}
{"nick":"felixge","message":"but this is how I do:","date":"2012-05-08T20:05:26.496Z","type":"message"}
{"nick":"felixge","message":"https://github.com/felixge/node/commit/d2e59d85e867a352806190d72ee8ec447a4e2eff","date":"2012-05-08T20:05:34.411Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: ^----","date":"2012-05-08T20:05:40.151Z","type":"message"}
{"nick":"piscisaureus_","message":"that works","date":"2012-05-08T20:05:59.417Z","type":"message"}
{"nick":"piscisaureus_","message":":-)","date":"2012-05-08T20:06:01.183Z","type":"message"}
{"nick":"felixge","message":":)","date":"2012-05-08T20:06:03.071Z","type":"message"}
{"nick":"felixge","message":"yeah, a bit hacky","date":"2012-05-08T20:06:05.505Z","type":"message"}
{"nick":"felixge","message":"but I'd feel much more comfortable with this for 0.6","date":"2012-05-08T20:06:13.661Z","type":"message"}
{"nick":"felixge","message":"in combination with my other patch","date":"2012-05-08T20:06:17.285Z","type":"message"}
{"nick":"felixge","message":"as it purely addresses stack output","date":"2012-05-08T20:06:34.447Z","type":"message"}
{"nick":"felixge","message":"but has no impact on behavior","date":"2012-05-08T20:06:39.144Z","type":"message"}
{"nick":"felixge","message":"ok, will give this a better commit message and put it in a pull","date":"2012-05-08T20:08:06.976Z","type":"message"}
{"nick":"felixge","message":"will be headed offline after that, but hopefully isaac can comment","date":"2012-05-08T20:08:21.210Z","type":"message"}
{"nick":"brson","date":"2012-05-08T20:08:22.905Z","type":"join"}
{"nick":"piscisaureus_","message":"yeah","date":"2012-05-08T20:08:37.588Z","type":"message"}
{"nick":"piscisaureus_","message":"Mention him in the pr","date":"2012-05-08T20:08:46.255Z","type":"message"}
{"nick":"piscisaureus_","message":"or let's just get it landed :-p","date":"2012-05-08T20:08:51.763Z","type":"message"}
{"nick":"piscisaureus_","message":"actually isaac is into that stuff so he should probably take a look","date":"2012-05-08T20:09:07.629Z","type":"message"}
{"nick":"mjr_","message":"isaacs: I think your recent http parser free change might not be working right.  We get a lot of these after upgrading:","date":"2012-05-08T20:13:29.074Z","type":"message"}
{"nick":"mjr_","message":"https://gist.github.com/2638935","date":"2012-05-08T20:13:29.910Z","type":"message"}
{"nick":"piscisaureus_","message":"mjr_: I think it has been addresses","date":"2012-05-08T20:13:55.747Z","type":"message"}
{"nick":"piscisaureus_","message":"*addressed","date":"2012-05-08T20:13:59.685Z","type":"message"}
{"nick":"mjr_","message":"piscisaureus_: post 0.6.17 you mean?","date":"2012-05-08T20:14:34.825Z","type":"message"}
{"nick":"piscisaureus_","message":"mjr_: hmm, I heard they had to fix some fallout bugs","date":"2012-05-08T20:14:47.673Z","type":"message"}
{"nick":"piscisaureus_","message":"mjr_: but this particular one I don't know","date":"2012-05-08T20:14:55.392Z","type":"message"}
{"nick":"mjr_","message":"The previous parser free fix I had in place didn't seem to cause these.","date":"2012-05-08T20:15:10.962Z","type":"message"}
{"nick":"indexzero","reason":"Quit: indexzero","date":"2012-05-08T20:16:13.326Z","type":"quit"}
{"nick":"felixge","message":"https://github.com/joyent/node/pull/3238","date":"2012-05-08T20:19:40.020Z","type":"message"}
{"nick":"felixge","message":"isaacs / piscisaureus_ : ^-----","date":"2012-05-08T20:19:53.008Z","type":"message"}
{"nick":"mraleph","date":"2012-05-08T20:20:06.393Z","type":"join"}
{"nick":"piscisaureus_","message":"yup, seen","date":"2012-05-08T20:20:10.289Z","type":"message"}
{"nick":"felixge","message":"I'm headed offline now, so if there needs to be more discussion, I'll be back tomorrow. Otherwise feel free to merge/tweak","date":"2012-05-08T20:20:23.855Z","type":"message"}
{"nick":"piscisaureus_","message":"alright. Felixge: sleep well","date":"2012-05-08T20:20:46.637Z","type":"message"}
{"nick":"piscisaureus_","message":"I am also about to head out. bnoordhuisL: still not there?","date":"2012-05-08T20:20:57.090Z","type":"message"}
{"nick":"piscisaureus_","message":"*bnoordhuis","date":"2012-05-08T20:21:10.965Z","type":"message"}
{"nick":"isaacs","message":"piscisaureus_: felixge: hey","date":"2012-05-08T20:22:02.645Z","type":"message"}
{"nick":"isaacs","message":"oh you","date":"2012-05-08T20:22:04.391Z","type":"message"}
{"nick":"felixge","message":"isaacs: hey","date":"2012-05-08T20:22:06.982Z","type":"message"}
{"nick":"isaacs","message":"you're heading offline","date":"2012-05-08T20:22:08.364Z","type":"message"}
{"nick":"felixge","message":"I can hang here for a few more minutes ","date":"2012-05-08T20:22:16.411Z","type":"message"}
{"nick":"isaacs","message":"real quick: yeah, my module.js thing cannot be done in 0.6","date":"2012-05-08T20:22:17.350Z","type":"message"}
{"nick":"isaacs","message":"it subtly changes semantics.","date":"2012-05-08T20:22:21.173Z","type":"message"}
{"nick":"felixge","message":"was just heading off since I thought you weren't coming back right away","date":"2012-05-08T20:22:25.507Z","type":"message"}
{"nick":"felixge","message":"isaacs: yeah","date":"2012-05-08T20:22:41.611Z","type":"message"}
{"nick":"isaacs","message":"it's not allowed change behavior in 0.6, even if it's right.","date":"2012-05-08T20:22:42.052Z","type":"message"}
{"nick":"felixge","message":"but that 'finally' thing was genius","date":"2012-05-08T20:22:46.398Z","type":"message"}
{"nick":"felixge","message":"I never considered finally for this","date":"2012-05-08T20:22:52.107Z","type":"message"}
{"nick":"isaacs","message":"yeah, i'm quite proud of it :)","date":"2012-05-08T20:22:58.471Z","type":"message"}
{"nick":"felixge","message":":)","date":"2012-05-08T20:23:00.707Z","type":"message"}
{"nick":"isaacs","message":"it's like actually a completely valid use case for exactly what try/finally is *supposed* to be used for: cleaning up after an error, without trapping the error itself","date":"2012-05-08T20:23:23.890Z","type":"message"}
{"nick":"felixge","message":"yes","date":"2012-05-08T20:23:31.872Z","type":"message"}
{"nick":"felixge","message":"never seen it used for that before so","date":"2012-05-08T20:23:39.970Z","type":"message"}
{"nick":"felixge","message":"which is why I always dismissed it as useless","date":"2012-05-08T20:23:53.428Z","type":"message"}
{"nick":"felixge","message":":)","date":"2012-05-08T20:23:54.031Z","type":"message"}
{"nick":"felixge","message":"isaacs: so how do you feel about my simplified patch?","date":"2012-05-08T20:24:20.296Z","type":"message"}
{"nick":"felixge","message":"isaacs: https://github.com/felixge/node/commit/13afa9fac1b1ddbc79dce8c42d638047b0ba6d60","date":"2012-05-08T20:24:31.817Z","type":"message"}
{"nick":"isaacs","message":"felixge: i'm ok on the approach.  need to study more carefully before i lgtm it","date":"2012-05-08T20:25:25.271Z","type":"message"}
{"nick":"felixge","message":"isaacs: sure","date":"2012-05-08T20:26:29.857Z","type":"message"}
{"nick":"felixge","message":"isaacs: I can stick around for another ~5min, otherwise we can re-connect tomorrow if you want more discussion","date":"2012-05-08T20:28:15.223Z","type":"message"}
{"nick":"loladiro","date":"2012-05-08T20:30:29.016Z","type":"join"}
{"nick":"isaacs","message":"felixge: i've got some other stuff to do right now, let's touch base tomorrow.","date":"2012-05-08T20:30:49.183Z","type":"message"}
{"nick":"isaacs","message":"have a good evening :)","date":"2012-05-08T20:30:55.006Z","type":"message"}
{"nick":"felixge","message":"isaacs: SGTM","date":"2012-05-08T20:30:56.131Z","type":"message"}
{"nick":"isaacs","message":"thanks","date":"2012-05-08T20:30:56.911Z","type":"message"}
{"nick":"felixge","message":"you too","date":"2012-05-08T20:30:58.408Z","type":"message"}
{"nick":"felixge","message":"thanks for the review on this stuff and coming up with using 'finally ' :)","date":"2012-05-08T20:31:17.292Z","type":"message"}
{"nick":"felixge","message":"very happy with this if we can land it","date":"2012-05-08T20:31:23.935Z","type":"message"}
{"nick":"felixge","message":"piscisaureus_: also huge thanks for your input on the nextTickQueue handling","date":"2012-05-08T20:31:41.202Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: np","date":"2012-05-08T20:31:46.489Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: this is a good think to do :-)","date":"2012-05-08T20:31:57.255Z","type":"message"}
{"nick":"felixge","message":"yeah, it annoyed the fuck out of me for ages :)","date":"2012-05-08T20:32:47.946Z","type":"message"}
{"nick":"felixge","message":"alright, good night","date":"2012-05-08T20:32:50.431Z","type":"message"}
{"nick":"piscisaureus_","message":"felixge: you too","date":"2012-05-08T20:33:19.426Z","type":"message"}
{"nick":"felixge","reason":"Quit: http://www.debuggable.com/","date":"2012-05-08T20:33:47.894Z","type":"quit"}
{"nick":"isaacs","message":"i think maybe my patch on 0.8 is not so great.  i'll try a re-merge once i review felixge's more.","date":"2012-05-08T20:40:55.575Z","type":"message"}
{"nick":"igorzi","reason":"Quit: Page closed","date":"2012-05-08T20:52:14.573Z","type":"quit"}
{"nick":"indexzero","date":"2012-05-08T21:01:40.860Z","type":"join"}
{"nick":"mjr_","message":"isaacs: did you see my earlier note about the HTTP parser exception?","date":"2012-05-08T21:11:21.172Z","type":"message"}
{"nick":"isaacs","message":"mjr_: yeah, that seems impossible.","date":"2012-05-08T21:12:31.085Z","type":"message"}
{"nick":"isaacs","message":"mjr_: i think your servers are lying to you.","date":"2012-05-08T21:12:35.576Z","type":"message"}
{"nick":"mjr_","message":"Oh, maybe I should get them drunk and see if they tell me the truth.","date":"2012-05-08T21:12:51.813Z","type":"message"}
{"nick":"isaacs","message":"mjr_: could help!","date":"2012-05-08T21:12:56.653Z","type":"message"}
{"nick":"mjr_","message":"servers++","date":"2012-05-08T21:13:03.388Z","type":"message"}
{"nick":"kohai","message":"servers has 1 beer","date":"2012-05-08T21:13:03.585Z","type":"message"}
{"nick":"mjr_","message":"isaacs: so presumably this is because onIncoming is set to null in freeParser","date":"2012-05-08T21:14:50.281Z","type":"message"}
{"nick":"isaacs","message":"mjr_: yes, of course.","date":"2012-05-08T21:15:34.335Z","type":"message"}
{"nick":"mjr_","message":"But it does seem that the timing of whatever this bullshit is has changed.","date":"2012-05-08T21:15:53.506Z","type":"message"}
{"nick":"isaacs","message":"mjr_: but if it's getting called anywhere between freeParser and being re-set-up for a new request, then there's big problems.","date":"2012-05-08T21:15:55.754Z","type":"message"}
{"nick":"mjr_","message":"On my previous fix for this, I did not see these exceptions.","date":"2012-05-08T21:16:25.463Z","type":"message"}
{"nick":"isaacs","message":"mjr_: onIncoming gets set when the parser is assigned to a socket, and removed when the parser is put back to the pool.","date":"2012-05-08T21:16:28.578Z","type":"message"}
{"nick":"isaacs","message":"mjr_: you also saw memory leaks with your previous fix ;)","date":"2012-05-08T21:16:38.430Z","type":"message"}
{"nick":"mjr_","message":"Tradeoffs.","date":"2012-05-08T21:16:48.099Z","type":"message"}
{"nick":"mjr_","message":"So would it help to slather some logging in there when this happens?","date":"2012-05-08T21:17:20.179Z","type":"message"}
{"nick":"piscisaureus_","message":"the http connection is somehow cleaned up, but data still arrives at the socket","date":"2012-05-08T21:18:51.988Z","type":"message"}
{"nick":"piscisaureus_","message":"I think the http parser is not properly disconnected from the socket object","date":"2012-05-08T21:19:10.368Z","type":"message"}
{"nick":"piscisaureus_","message":"it would probably help to do","date":"2012-05-08T21:20:19.915Z","type":"message"}
{"nick":"piscisaureus_","message":"socket.removeAllListeners('data');","date":"2012-05-08T21:20:20.114Z","type":"message"}
{"nick":"isaacs","message":"mjr_: what's like 1176 of lib/http.js","date":"2012-05-08T21:20:24.405Z","type":"message"}
{"nick":"piscisaureus_","message":"whenever onIncoming is set to nul","date":"2012-05-08T21:20:32.764Z","type":"message"}
{"nick":"mjr_","message":"      var ret = parser.execute(d, start, end - start);","date":"2012-05-08T21:20:51.003Z","type":"message"}
{"nick":"mjr_","message":"net.js:374 is:     if (self.ondata) self.ondata(buffer, offset, end);","date":"2012-05-08T21:21:25.473Z","type":"message"}
{"nick":"isaacs","message":"mjr_: so, there's this in http.js:","date":"2012-05-08T21:22:29.083Z","type":"message"}
{"nick":"isaacs","message":"    parser.onIncoming = null;","date":"2012-05-08T21:22:31.019Z","type":"message"}
{"nick":"isaacs","message":"    if (parser.socket) {","date":"2012-05-08T21:22:31.217Z","type":"message"}
{"nick":"isaacs","message":"      parser.socket.onend = null;","date":"2012-05-08T21:22:31.217Z","type":"message"}
{"nick":"isaacs","message":"      parser.socket.ondata = null;","date":"2012-05-08T21:22:33.078Z","type":"message"}
{"nick":"isaacs","message":"    }","date":"2012-05-08T21:22:34.980Z","type":"message"}
{"nick":"isaacs","message":"so how would ondata get called when onIncoming is null??","date":"2012-05-08T21:22:42.445Z","type":"message"}
{"nick":"isaacs","message":"i have to run to a meetin","date":"2012-05-08T21:22:51.198Z","type":"message"}
{"nick":"isaacs","message":"g","date":"2012-05-08T21:22:52.576Z","type":"message"}
{"nick":"mjr_","message":"yeah, crazy","date":"2012-05-08T21:23:30.280Z","type":"message"}
{"nick":"mjr_","message":"perhaps some silly thing like parser.socket isn't truthy, or even the incoming parser param isn't truthy?","date":"2012-05-08T21:24:10.492Z","type":"message"}
{"nick":"mjr_","message":"That would be dumb.","date":"2012-05-08T21:24:20.404Z","type":"message"}
{"nick":"piscisaureus_","message":"or maybe \"parser.socket\" got patched somehow","date":"2012-05-08T21:25:03.007Z","type":"message"}
{"nick":"piscisaureus_","message":"but data is still flowing off an old socket","date":"2012-05-08T21:25:19.492Z","type":"message"}
{"nick":"indexzero","reason":"Ping timeout: 265 seconds","date":"2012-05-08T21:41:15.676Z","type":"quit"}
{"nick":"mikeal","reason":"Quit: Leaving.","date":"2012-05-08T21:41:42.615Z","type":"quit"}
{"nick":"rendar","date":"2012-05-08T21:45:07.051Z","type":"quit"}
{"nick":"mikeal","date":"2012-05-08T21:48:58.019Z","type":"join"}
{"nick":"igorzi","date":"2012-05-08T21:56:31.422Z","type":"join"}
{"nick":"igorzi","message":"piscisaureus_: hey.. are you sure that you had junctions working with relative paths? ","date":"2012-05-08T21:57:28.642Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: lemme try","date":"2012-05-08T21:58:38.496Z","type":"message"}
{"nick":"igorzi","message":"piscisaureus_: doesn't work for me","date":"2012-05-08T21:58:52.640Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: they can be relative for sure","date":"2012-05-08T21:59:37.513Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: try this","date":"2012-05-08T21:59:50.340Z","type":"message"}
{"nick":"piscisaureus_","message":"mkdir foo\\bar","date":"2012-05-08T22:00:27.222Z","type":"message"}
{"nick":"piscisaureus_","message":"cd foo","date":"2012-05-08T22:00:27.428Z","type":"message"}
{"nick":"piscisaureus_","message":"mklink /j bar2 bar","date":"2012-05-08T22:00:27.428Z","type":"message"}
{"nick":"piscisaureus_","message":"cd ..","date":"2012-05-08T22:00:27.428Z","type":"message"}
{"nick":"piscisaureus_","message":"ren foo foo2","date":"2012-05-08T22:00:30.772Z","type":"message"}
{"nick":"piscisaureus_","message":"dir foo2/bar2","date":"2012-05-08T22:00:35.418Z","type":"message"}
{"nick":"piscisaureus_","message":"oh wait","date":"2012-05-08T22:00:47.815Z","type":"message"}
{"nick":"piscisaureus_","message":"heh","date":"2012-05-08T22:00:48.435Z","type":"message"}
{"nick":"piscisaureus_","message":"how lame","date":"2012-05-08T22:00:56.351Z","type":"message"}
{"nick":"piscisaureus_","message":"well, that settles it, then :-)","date":"2012-05-08T22:01:01.561Z","type":"message"}
{"nick":"igorzi","message":":)","date":"2012-05-08T22:01:09.102Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: sorry","date":"2012-05-08T22:03:00.378Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: btw - are you going to nodeconf?","date":"2012-05-08T22:03:05.738Z","type":"message"}
{"nick":"igorzi","message":"np","date":"2012-05-08T22:03:11.413Z","type":"message"}
{"nick":"igorzi","message":"piscisaureus_: so the question is what do we do if symlink is called with relative path.. to we just make it into absolute with cwd? (this is probably what mklink does)","date":"2012-05-08T22:03:12.968Z","type":"message"}
{"nick":"igorzi","message":"piscisaureus_: probably not unfortunately.. i've got relatives visiting from outside US exactly at the time of nodeconf","date":"2012-05-08T22:04:22.453Z","type":"message"}
{"nick":"igorzi","message":"piscisaureus_: are you?","date":"2012-05-08T22:04:25.735Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: re absolutize - I think so. But I think we shouldn't make junctions the default, then.","date":"2012-05-08T22:04:49.499Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: I am. I was hoping to meet you there.","date":"2012-05-08T22:04:57.801Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: no luck so it seems","date":"2012-05-08T22:05:05.704Z","type":"message"}
{"nick":"igorzi","message":"piscisaureus_: i might come down for 1 day (it's about 3 hour drive)","date":"2012-05-08T22:05:44.193Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: ah, right. I can also try to be there a little earlier (I might be there for oscon about a week earlier, so maybe I'll just stay there)","date":"2012-05-08T22:07:24.509Z","type":"message"}
{"nick":"paddybyers","reason":"Quit: paddybyers","date":"2012-05-08T22:15:07.747Z","type":"quit"}
{"nick":"paddybyers","date":"2012-05-08T22:15:51.182Z","type":"join"}
{"nick":"mjr_","message":"piscisaureus_ / isaacs: looks like we are also seeing a different error that seems related:","date":"2012-05-08T22:21:42.483Z","type":"message"}
{"nick":"mjr_","message":"https://gist.github.com/2638935","date":"2012-05-08T22:21:43.349Z","type":"message"}
{"nick":"piscisaureus_","message":"aha","date":"2012-05-08T22:22:03.682Z","type":"message"}
{"nick":"mjr_","message":"And perhaps this is what's really going on.","date":"2012-05-08T22:22:07.420Z","type":"message"}
{"nick":"piscisaureus_","message":"so it seems that halfway the headers the parser throws up","date":"2012-05-08T22:22:16.972Z","type":"message"}
{"nick":"piscisaureus_","message":"and the parser gets recycled","date":"2012-05-08T22:22:36.769Z","type":"message"}
{"nick":"mjr_","message":"oh right","date":"2012-05-08T22:22:42.417Z","type":"message"}
{"nick":"mjr_","message":"But it's not really done.","date":"2012-05-08T22:22:49.692Z","type":"message"}
{"nick":"piscisaureus_","message":"but the socket can still receive more data which gets pumped into the parser","date":"2012-05-08T22:22:58.694Z","type":"message"}
{"nick":"mjr_","message":"And before when we would leak them, it didn't matter.","date":"2012-05-08T22:23:00.464Z","type":"message"}
{"nick":"piscisaureus_","message":"that's supposed to be recycled","date":"2012-05-08T22:23:03.790Z","type":"message"}
{"nick":"piscisaureus_","message":"it looks good though","date":"2012-05-08T22:24:44.072Z","type":"message"}
{"nick":"piscisaureus_","message":"weird","date":"2012-05-08T22:25:38.316Z","type":"message"}
{"nick":"piscisaureus_","message":"parser.reinitialize(HTTPParser.RESPONSE);","date":"2012-05-08T22:25:39.655Z","type":"message"}
{"nick":"piscisaureus_","message":"that apparently throws somehow?","date":"2012-05-08T22:25:45.482Z","type":"message"}
{"nick":"mjr_","message":"Yeah, I guess. I kind of stopped following it at that point.","date":"2012-05-08T22:25:56.783Z","type":"message"}
{"nick":"piscisaureus_","message":"mjr_: which node is that? vanilla 0.6.17?","date":"2012-05-08T22:27:15.110Z","type":"message"}
{"nick":"mjr_","message":"It's node 0.6.17 with the no idle patch applied.","date":"2012-05-08T22:27:30.176Z","type":"message"}
{"nick":"mjr_","message":"https://github.com/Voxer/node","date":"2012-05-08T22:27:56.850Z","type":"message"}
{"nick":"mjr_","message":"Maybe a couple of days behind v0.6 now.","date":"2012-05-08T22:28:16.758Z","type":"message"}
{"nick":"mraleph","reason":"Quit: Leaving.","date":"2012-05-08T22:28:36.854Z","type":"quit"}
{"nick":"piscisaureus_","message":"so that's in ClientRequest","date":"2012-05-08T22:29:20.822Z","type":"message"}
{"nick":"piscisaureus_","message":"and the parser borks on receiving wrong headers","date":"2012-05-08T22:29:38.364Z","type":"message"}
{"nick":"piscisaureus_","message":"lemme try to reproduce","date":"2012-05-08T22:29:42.356Z","type":"message"}
{"nick":"mjr_","message":"We apparently have the ultimate continuous integration system: actual users","date":"2012-05-08T22:30:27.982Z","type":"message"}
{"nick":"piscisaureus_","message":"yep. Please capture them in a bottle for me.","date":"2012-05-08T22:30:44.099Z","type":"message"}
{"nick":"piscisaureus_","message":"hmm","date":"2012-05-08T22:43:10.994Z","type":"message"}
{"nick":"piscisaureus_","message":"node.js:201","date":"2012-05-08T22:43:12.506Z","type":"message"}
{"nick":"piscisaureus_","message":"        throw e; // process.nextTick error, or 'error' event on first tick","date":"2012-05-08T22:43:12.706Z","type":"message"}
{"nick":"piscisaureus_","message":"              ^","date":"2012-05-08T22:43:12.707Z","type":"message"}
{"nick":"piscisaureus_","message":"Error: Parse Error","date":"2012-05-08T22:43:12.707Z","type":"message"}
{"nick":"piscisaureus_","message":"    at Socket.<anonymous> (http.js:1176:24)","date":"2012-05-08T22:43:12.707Z","type":"message"}
{"nick":"piscisaureus_","message":"    at TCP.onread (net.js:374:27)","date":"2012-05-08T22:43:13.015Z","type":"message"}
{"nick":"piscisaureus_","message":"I can reproduce that","date":"2012-05-08T22:43:15.663Z","type":"message"}
{"nick":"piscisaureus_","message":"which, unfortunately, does not seem to be catchable","date":"2012-05-08T22:43:23.384Z","type":"message"}
{"nick":"piscisaureus_","message":"https://gist.github.com/2640099","date":"2012-05-08T22:47:46.146Z","type":"message"}
{"nick":"mikeal","reason":"Quit: Leaving.","date":"2012-05-08T22:47:47.330Z","type":"quit"}
{"nick":"erickt_","date":"2012-05-08T22:48:03.979Z","type":"join"}
{"nick":"piscisaureus_","message":"^-- mjr_: how are you guys catching these errors?","date":"2012-05-08T22:48:09.623Z","type":"message"}
{"nick":"piscisaureus_","message":"mjr_: or are you just crashing the process?","date":"2012-05-08T22:48:17.764Z","type":"message"}
{"nick":"mikeal","date":"2012-05-08T22:49:24.445Z","type":"join"}
{"nick":"mjr_","message":"piscisaureus_: we have an uncaught exception handler that logs, then exits.","date":"2012-05-08T22:50:13.838Z","type":"message"}
{"nick":"mjr_","message":"Neat that you have a repro.","date":"2012-05-08T22:50:38.526Z","type":"message"}
{"nick":"piscisaureus_","message":"mjr_: ah, right. So the parse error is not happening in the same instance as the onIncoming null error?","date":"2012-05-08T22:50:55.037Z","type":"message"}
{"nick":"piscisaureus_","message":"mjr_: well, the line number for the parse error is different than yours","date":"2012-05-08T22:51:10.917Z","type":"message"}
{"nick":"erickt","reason":"Ping timeout: 245 seconds","date":"2012-05-08T22:51:11.117Z","type":"quit"}
{"nick":"erickt_","new_nick":"erickt","date":"2012-05-08T22:51:11.117Z","type":"nick"}
{"nick":"piscisaureus_","message":"mjr_: are you sure that these errors come from node 0.6.17 with no patches applied to http.js?","date":"2012-05-08T22:51:55.272Z","type":"message"}
{"nick":"mjr_","message":"let me double check that there's nothing else different","date":"2012-05-08T22:55:21.371Z","type":"message"}
{"nick":"mjr_","message":"http.js is unchanged.  Our only changes are in src/node.cc","date":"2012-05-08T22:57:40.550Z","type":"message"}
{"nick":"mjr_","message":"Note that we are on 992e3464b8997210ea7f40f03f0386f8dd4f4f86, which is a couple of commits behind, and one of those did change http.js","date":"2012-05-08T22:58:51.574Z","type":"message"}
{"nick":"mjr_","message":"Does that explain the line number difference?","date":"2012-05-08T22:58:58.017Z","type":"message"}
{"nick":"piscisaureus_","message":"it could","date":"2012-05-08T23:01:03.233Z","type":"message"}
{"nick":"piscisaureus_","message":"mjr_: the funny thing is... this would mean they you are talking to an http server that sends broken responses","date":"2012-05-08T23:03:10.009Z","type":"message"}
{"nick":"piscisaureus_","message":"mjr_: is that any likely ?","date":"2012-05-08T23:03:18.749Z","type":"message"}
{"nick":"mjr_","message":"Entirely possible","date":"2012-05-08T23:03:33.158Z","type":"message"}
{"nick":"piscisaureus_","message":"mjr_: otherwise we are looking at some internal state fuckup in node","date":"2012-05-08T23:03:41.661Z","type":"message"}
{"nick":"mjr_","message":"We mostly talk to node, but our processes crash all the time.","date":"2012-05-08T23:03:45.874Z","type":"message"}
{"nick":"mjr_","message":"They crash due to bugs like this.  :)","date":"2012-05-08T23:03:54.444Z","type":"message"}
{"nick":"mjr_","message":"Crashes beget crashes. ","date":"2012-05-08T23:04:05.672Z","type":"message"}
{"nick":"piscisaureus_","message":"mjr_: if the server just hangs up I *also* trigger an uncatchable exception","date":"2012-05-08T23:04:21.956Z","type":"message"}
{"nick":"piscisaureus_","message":"mjr_: but that shows as [Error: socket hang up] code: 'ECONNRESET'","date":"2012-05-08T23:04:45.057Z","type":"message"}
{"nick":"mjr_","message":"The only HTTP server we talk to from this process is node.","date":"2012-05-08T23:05:27.111Z","type":"message"}
{"nick":"piscisaureus_","message":"it could happen when you are using a keepalive http server","date":"2012-05-08T23:06:19.305Z","type":"message"}
{"nick":"piscisaureus_","message":"but not set the Content-Length correctly","date":"2012-05-08T23:06:28.334Z","type":"message"}
{"nick":"mjr_","message":"We never explicitly set the content-length in our code. It should all be using chunked encoding.","date":"2012-05-08T23:07:29.665Z","type":"message"}
{"nick":"piscisaureus_","message":"hmm","date":"2012-05-08T23:09:41.749Z","type":"message"}
{"nick":"piscisaureus_","message":"server-size keepalive bugs sound highly unlikely","date":"2012-05-08T23:11:18.425Z","type":"message"}
{"nick":"piscisaureus_","message":"*side","date":"2012-05-08T23:11:26.169Z","type":"message"}
{"nick":"igorzi","message":"piscisaureus_: https://github.com/igorzi/libuv/commit/52553cddbcb2f7c5a135d5beac1638ef938393ec","date":"2012-05-08T23:14:38.477Z","type":"message"}
{"nick":"igorzi","message":"piscisaureus_: pls review when you get a chance","date":"2012-05-08T23:14:44.207Z","type":"message"}
{"nick":"igorzi","message":"isaacs: FYI ^","date":"2012-05-08T23:14:58.051Z","type":"message"}
{"nick":"piscisaureus_","message":"mjr_: I don't know atm. I will file a node bug. We should get these uncatchable errors rounded up first","date":"2012-05-08T23:15:01.059Z","type":"message"}
{"nick":"mjr_","message":"piscisaureus_: OK, thanks. If you want me to try anything, I'm open.  This is happening about 100 times / day right now.","date":"2012-05-08T23:15:40.900Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: you should probably take another approach","date":"2012-05-08T23:23:31.035Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: with this you will stat the link target","date":"2012-05-08T23:23:42.151Z","type":"message"}
{"nick":"igorzi","message":"piscisaureus_: you mean take another approach for lstat?","date":"2012-05-08T23:24:31.610Z","type":"message"}
{"nick":"piscisaureus_","message":"With this approach you will stat the symlink target","date":"2012-05-08T23:24:48.443Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: thats not what unix does","date":"2012-05-08T23:24:54.734Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: what you need to do is CreateFile with that flags that inhibits reparse points","date":"2012-05-08T23:25:26.485Z","type":"message"}
{"nick":"igorzi","message":"piscisaureus_: are you talking about stat or lstat?","date":"2012-05-08T23:26:01.428Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: lstat","date":"2012-05-08T23:26:12.368Z","type":"message"}
{"nick":"mikeal","reason":"Quit: Leaving.","date":"2012-05-08T23:26:27.847Z","type":"quit"}
{"nick":"piscisaureus_","message":"igorzi: I think it is easiest to create a function that can do both stat and lstat","date":"2012-05-08T23:26:28.469Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: (an internal one)","date":"2012-05-08T23:26:37.540Z","type":"message"}
{"nick":"toothr","reason":"Read error: Connection reset by peer","date":"2012-05-08T23:26:51.399Z","type":"quit"}
{"nick":"igorzi","message":"piscisaureus_: what's the unix behavior?  when you lstat a file - you get same results as stat?","date":"2012-05-08T23:26:57.239Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: nope","date":"2012-05-08T23:27:05.407Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: lemme give an example","date":"2012-05-08T23:27:13.554Z","type":"message"}
{"nick":"piscisaureus_","action":"boots up vm","date":"2012-05-08T23:27:20.019Z","type":"action"}
{"nick":"igorzi","message":"piscisaureus_: k, thanks","date":"2012-05-08T23:27:20.798Z","type":"message"}
{"nick":"paddybyers","reason":"Quit: paddybyers","date":"2012-05-08T23:28:27.887Z","type":"quit"}
{"nick":"toothr","date":"2012-05-08T23:28:37.763Z","type":"join"}
{"nick":"perezd","date":"2012-05-08T23:29:18.508Z","type":"join"}
{"nick":"piscisaureus_","message":"igorzi: https://gist.github.com/2640399","date":"2012-05-08T23:32:20.374Z","type":"message"}
{"nick":"igorzi","message":"piscisaureus_: what about require('fs').lstatSync('file') ? is that the same thing as require('fs').statSync('file') ?","date":"2012-05-08T23:38:03.210Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: yep","date":"2012-05-08T23:38:13.538Z","type":"message"}
{"nick":"igorzi","message":"piscisaureus_: ok, thanks","date":"2012-05-08T23:38:25.988Z","type":"message"}
{"nick":"piscisaureus_","message":"igorzi: sorry for the spam. I keep hitting ctrl+enter accidentally","date":"2012-05-08T23:42:41.720Z","type":"message"}
{"nick":"isaacs","action":"back","date":"2012-05-08T23:43:59.863Z","type":"action"}
{"nick":"piscisaureus_","message":"igorzi: +1 for having tests btw!","date":"2012-05-08T23:46:54.087Z","type":"message"}
{"nick":"bnoordhuis","message":"back","date":"2012-05-08T23:51:12.208Z","type":"message"}
{"nick":"bnoordhuis","message":"piscisaureus_: looking for me?","date":"2012-05-08T23:51:15.560Z","type":"message"}
{"nick":"piscisaureus_","message":"damn bnoordhuis","date":"2012-05-08T23:56:40.976Z","type":"message"}
{"nick":"piscisaureus_","message":"where  have you been :-p","date":"2012-05-08T23:56:47.424Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: anyway, can you review https://github.com/piscisaureus/node/compare/master...netwrite","date":"2012-05-08T23:57:13.768Z","type":"message"}
{"nick":"bnoordhuis","message":"is that the fixed-up version?","date":"2012-05-08T23:57:23.716Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: I has fixup commits. I will squash after your review","date":"2012-05-08T23:57:39.988Z","type":"message"}
{"nick":"piscisaureus_","message":"bnoordhuis: (I can also do that already but I suppose that makes reviewing more difficult)","date":"2012-05-08T23:57:57.032Z","type":"message"}
