{"nick":"ircretary","reason":"Remote host closed the connection","date":"2013-02-13T00:00:01.380Z","type":"quit"}
{"nick":"ircretary","date":"2013-02-13T00:00:08.719Z","type":"join"}
{"nick":"c4milo","reason":"Remote host closed the connection","date":"2013-02-13T00:04:29.886Z","type":"quit"}
{"nick":"trevnorris","message":"isaacs: pingidy. serious implementation question.","date":"2013-02-13T00:05:39.618Z","type":"message"}
{"nick":"isaacs","message":"pongidy","date":"2013-02-13T00:05:54.756Z","type":"message"}
{"nick":"isaacs","message":"whassup?","date":"2013-02-13T00:05:59.101Z","type":"message"}
{"nick":"trevnorris","message":"isaacs: so... i was thinking, would it be crazy to create domain specific nextTick and callback functions, then override the normal ones when require('domain') is loaded?","date":"2013-02-13T00:06:10.843Z","type":"message"}
{"nick":"isaacs","message":"hrm,/.","date":"2013-02-13T00:06:21.971Z","type":"message"}
{"nick":"isaacs","message":"it's only a little crazy","date":"2013-02-13T00:06:32.231Z","type":"message"}
{"nick":"trevnorris","message":"ok, i can handle a little crazy.","date":"2013-02-13T00:06:43.852Z","type":"message"}
{"nick":"isaacs","message":"but... i don't want to get a benchmark improvement just if you never load domains.","date":"2013-02-13T00:06:45.761Z","type":"message"}
{"nick":"isaacs","message":"that's kinda crap.","date":"2013-02-13T00:06:54.470Z","type":"message"}
{"nick":"isaacs","message":"i mean, node should be fast if you're using domains.","date":"2013-02-13T00:07:05.183Z","type":"message"}
{"nick":"isaacs","message":"that sorta feels like premature optimization.","date":"2013-02-13T00:07:19.461Z","type":"message"}
{"nick":"isaacs","action":"searching his gut...","date":"2013-02-13T00:07:32.470Z","type":"action"}
{"nick":"isaacs","message":"my gut says that's a scary road to go down.","date":"2013-02-13T00:07:41.528Z","type":"message"}
{"nick":"trevnorris","message":"isaacs: actually it would be faster for both. since we we don't need to check either way.","date":"2013-02-13T00:07:46.118Z","type":"message"}
{"nick":"isaacs","message":"having two tickCallbacks and nextTicks and MakeCallbacks to manage...","date":"2013-02-13T00:07:52.971Z","type":"message"}
{"nick":"isaacs","message":"ugh","date":"2013-02-13T00:07:53.511Z","type":"message"}
{"nick":"trevnorris","message":"yeah. that part is a pain.","date":"2013-02-13T00:08:01.028Z","type":"message"}
{"nick":"trevnorris","message":"ok, i'll leave that one out. just a \"little\" crazy thought. ;-)","date":"2013-02-13T00:08:19.025Z","type":"message"}
{"nick":"isaacs","message":"you'll always have a mix of domain'ed and non-domain'ed callback objects.","date":"2013-02-13T00:08:21.650Z","type":"message"}
{"nick":"isaacs","message":"so you still have to check, right?","date":"2013-02-13T00:08:46.750Z","type":"message"}
{"nick":"trevnorris","message":"isaacs: the problem is we'd need to check every callback for domain before it runs. that's the hit i've been trying to avoid most of all.","date":"2013-02-13T00:09:36.263Z","type":"message"}
{"nick":"trevnorris","message":"so we can optimize the old domain callback, which will still run faster than it did","date":"2013-02-13T00:10:10.573Z","type":"message"}
{"nick":"trevnorris","message":"but if you never use a domain, then it'll be like supa fast.","date":"2013-02-13T00:10:22.078Z","type":"message"}
{"nick":"isaacs","message":"right..","date":"2013-02-13T00:10:43.176Z","type":"message"}
{"nick":"isaacs","message":"but it'll only be supafast until you do require('domain')","date":"2013-02-13T00:10:53.849Z","type":"message"}
{"nick":"isaacs","message":"and then we have to check every callback","date":"2013-02-13T00:11:01.199Z","type":"message"}
{"nick":"trevnorris","message":"we had to do that anyways.","date":"2013-02-13T00:11:08.151Z","type":"message"}
{"nick":"trevnorris","message":"and will always have to.","date":"2013-02-13T00:11:14.547Z","type":"message"}
{"nick":"isaacs","message":"so.. i don't get the benefit","date":"2013-02-13T00:11:30.078Z","type":"message"}
{"nick":"trevnorris","message":"if you don't use domains it will be a lot faster. if you do use domains then it will be a little faster than it was.","date":"2013-02-13T00:11:48.405Z","type":"message"}
{"nick":"trevnorris","message":"for example, nextTick won't have to check for a domain every time.","date":"2013-02-13T00:12:09.208Z","type":"message"}
{"nick":"trevnorris","message":"it just is like. push that callback on, and forget the stinkin domain.","date":"2013-02-13T00:12:20.870Z","type":"message"}
{"nick":"isaacs","message":"right","date":"2013-02-13T00:12:48.387Z","type":"message"}
{"nick":"isaacs","message":"so then you do require('domain')","date":"2013-02-13T00:12:52.208Z","type":"message"}
{"nick":"isaacs","message":"and now you have a mix","date":"2013-02-13T00:12:55.267Z","type":"message"}
{"nick":"isaacs","message":"now you have to check all the time.","date":"2013-02-13T00:13:03.737Z","type":"message"}
{"nick":"isaacs","message":"so it's only faster if you're not using domains *at all*","date":"2013-02-13T00:13:09.257Z","type":"message"}
{"nick":"isaacs","message":"but even once you *might* be using domains, it goes right back where we are now.","date":"2013-02-13T00:13:18.078Z","type":"message"}
{"nick":"isaacs","message":"right?","date":"2013-02-13T00:13:19.334Z","type":"message"}
{"nick":"trevnorris","message":"well. i've made enough improvements that it'll still be a little faster using domains. just not as much as if you don't.","date":"2013-02-13T00:13:41.973Z","type":"message"}
{"nick":"trevnorris","message":"(e.g. setting process.domain = null by default helps a lot with type conversion checks)","date":"2013-02-13T00:14:09.020Z","type":"message"}
{"nick":"isaacs","message":"right","date":"2013-02-13T00:14:29.754Z","type":"message"}
{"nick":"isaacs","message":"we can get rid of the whole \"usingDomains\" bs in EventEmitter() as well","date":"2013-02-13T00:14:38.817Z","type":"message"}
{"nick":"trevnorris","message":"yeah, exactly.","date":"2013-02-13T00:14:44.856Z","type":"message"}
{"nick":"isaacs","message":"just set it to null at the outset, and always do this.domain = process.domain;","date":"2013-02-13T00:14:50.360Z","type":"message"}
{"nick":"trevnorris","message":"yeah.","date":"2013-02-13T00:14:57.195Z","type":"message"}
{"nick":"isaacs","message":"that's orthogonal to the makeCallback/nextTick improvements, though","date":"2013-02-13T00:15:06.783Z","type":"message"}
{"nick":"isaacs","message":"let's put it off for now","date":"2013-02-13T00:15:10.286Z","type":"message"}
{"nick":"trevnorris","message":"will do.","date":"2013-02-13T00:15:13.652Z","type":"message"}
{"nick":"isaacs","message":"trevnorris: +1 on naming wiht - instead of _","date":"2013-02-13T00:15:44.503Z","type":"message"}
{"nick":"trevnorris","message":"coolio","date":"2013-02-13T00:15:53.384Z","type":"message"}
{"nick":"trevnorris","message":"but just so we understand, the first time you load a domain, all callbacks must be run with a domain check until the queue (tick?) empties.","date":"2013-02-13T00:17:57.499Z","type":"message"}
{"nick":"isaacs","message":"no","date":"2013-02-13T00:19:02.885Z","type":"message"}
{"nick":"isaacs","message":"the domain is attached to the object passed to MakeCallback","date":"2013-02-13T00:19:20.054Z","type":"message"}
{"nick":"isaacs","message":"or to the tock object, timer, or EventEmitter","date":"2013-02-13T00:19:28.908Z","type":"message"}
{"nick":"isaacs","message":"at creation time, they get attached to process.domain (the active domain)","date":"2013-02-13T00:19:45.944Z","type":"message"}
{"nick":"isaacs","message":"then that domain exits, etc.  eons pass.","date":"2013-02-13T00:19:53.263Z","type":"message"}
{"nick":"isaacs","message":"then their thing triggers.  *their* domain becomes active (ie, calls .enter() on it), the function runs, and then it exits.","date":"2013-02-13T00:20:17.146Z","type":"message"}
{"nick":"isaacs","message":"but, even in that tick, there may be some mix of domains.  and well AFTER that tick ends, anything *scheduled* in that tick needs to have a domain check.","date":"2013-02-13T00:20:57.133Z","type":"message"}
{"nick":"trevnorris","message":"and each callback can load/unload it's own domain. so each callback object must be checked, right?","date":"2013-02-13T00:21:08.825Z","type":"message"}
{"nick":"isaacs","message":"so, once you have touched domains, you have to check for domains, literally forever.","date":"2013-02-13T00:21:10.325Z","type":"message"}
{"nick":"isaacs","message":"yes.","date":"2013-02-13T00:21:16.769Z","type":"message"}
{"nick":"trevnorris","message":"ok, yeah.","date":"2013-02-13T00:21:20.175Z","type":"message"}
{"nick":"isaacs","message":"require('domain').create().on('error', console.log).run(function(){setTimeout(funciton() {throw 'foo'},100000)})","date":"2013-02-13T00:21:58.139Z","type":"message"}
{"nick":"isaacs","message":"once that line runs, any future callback could be the one with the domain","date":"2013-02-13T00:22:13.034Z","type":"message"}
{"nick":"isaacs","message":"so.. we may as well just make the \"maybe domains\" world faster.","date":"2013-02-13T00:23:59.651Z","type":"message"}
{"nick":"isaacs","message":"rather than optimize for never using domains","date":"2013-02-13T00:24:09.229Z","type":"message"}
{"nick":"trevnorris","message":"both have had the living shiz optimized out of them.","date":"2013-02-13T00:24:23.886Z","type":"message"}
{"nick":"isaacs","message":"well... that's good.  you dont' want any living shiz inside of your code.","date":"2013-02-13T00:24:37.449Z","type":"message"}
{"nick":"isaacs","message":":)","date":"2013-02-13T00:24:38.780Z","type":"message"}
{"nick":"trevnorris","message":"lol, yeah.","date":"2013-02-13T00:24:42.188Z","type":"message"}
{"nick":"trevnorris","message":"the entire logic path has been optimized so once a domain is/isn't detected it knows exactly what to do w/o any more checks.","date":"2013-02-13T00:25:01.544Z","type":"message"}
{"nick":"trevnorris","message":"(or at least w/ few as possible)","date":"2013-02-13T00:25:24.229Z","type":"message"}
{"nick":"trevnorris","message":"ok. going to post this soon. then going to try the external data array trick real quick to see if it does anything.","date":"2013-02-13T00:27:42.539Z","type":"message"}
{"nick":"isaacs","message":"awesome","date":"2013-02-13T00:28:45.311Z","type":"message"}
{"nick":"isaacs","message":"don't get too much stuff in a single pull req.","date":"2013-02-13T00:28:54.527Z","type":"message"}
{"nick":"isaacs","message":"it's a lot easier to pull if it's smaller :)","date":"2013-02-13T00:28:59.676Z","type":"message"}
{"nick":"isaacs","message":"and also manage, review, etc.","date":"2013-02-13T00:29:04.667Z","type":"message"}
{"nick":"isaacs","message":"trevnorris: i know i kinda got you to sneak a few bugfixes and stuff into it, so i'm partly to blame there :)","date":"2013-02-13T00:29:30.657Z","type":"message"}
{"nick":"isaacs","message":"but the most important thing is just getting it working.  especially with performance improvements, you can definitely sit there slicing away at it forever.","date":"2013-02-13T00:30:07.750Z","type":"message"}
{"nick":"isaacs","action":"guilty of doing this many times.","date":"2013-02-13T00:30:12.657Z","type":"action"}
{"nick":"trevnorris","message":"lol, yeah. really easy to do.","date":"2013-02-13T00:30:27.251Z","type":"message"}
{"nick":"MI61","message":"\u0002joyent/node:\u0002 \u00033isaacs\u000f \u00037v0.8\u000f * \u000282ad5fb\u0002 : blog: Forgot slug on peer-dependencies article - http://git.io/tyc1Cg","date":"2013-02-13T00:30:38.029Z","type":"message"}
{"nick":"karupanerura","reason":"Excess Flood","date":"2013-02-13T00:30:43.691Z","type":"quit"}
{"nick":"isaacs","message":"trevnorris: i think a good rule of thumb is a net improvemnet on relevant benchmarks of at least 2% for high-level stuff (http, net, tls) and 10% on \"targeted\" stuff (basically, everything I'm putting in benchmark/misc/)","date":"2013-02-13T00:31:45.163Z","type":"message"}
{"nick":"trevnorris","message":"cool.","date":"2013-02-13T00:32:04.267Z","type":"message"}
{"nick":"isaacs","message":"if you can get more, sure, of course that's better, but that's the time to start cleaning it up and shipping it","date":"2013-02-13T00:32:13.568Z","type":"message"}
{"nick":"trevnorris","message":"guess since i'm not a maintainer feel more freedom to have fun w/ the small stuff. ;-)","date":"2013-02-13T00:33:10.158Z","type":"message"}
{"nick":"trevnorris","message":"but after this pr i'm going to kick the shiz outta those streams.","date":"2013-02-13T00:33:21.711Z","type":"message"}
{"nick":"karupanerura","date":"2013-02-13T00:33:48.974Z","type":"join"}
{"nick":"isaacs","message":"nice :)","date":"2013-02-13T00:37:22.862Z","type":"message"}
{"nick":"trevnorris","message":"isaacs: you have any idea why the net-raw tests are slower than v0.8? very little lives in js land there.","date":"2013-02-13T00:41:03.664Z","type":"message"}
{"nick":"indexzero","reason":"Quit: indexzero","date":"2013-02-13T00:42:18.653Z","type":"quit"}
{"nick":"isaacs","message":"probably this makecallback nexttick stuff","date":"2013-02-13T00:44:02.668Z","type":"message"}
{"nick":"isaacs","message":"src/node.js changed quite a lot","date":"2013-02-13T00:44:11.317Z","type":"message"}
{"nick":"isaacs","message":"and not all for the better","date":"2013-02-13T00:44:17.697Z","type":"message"}
{"nick":"isaacs","message":"(as oyu know)","date":"2013-02-13T00:44:21.337Z","type":"message"}
{"nick":"trevnorris","message":"yeah. so far i'm getting 10% more than w/ just your revert.","date":"2013-02-13T00:44:31.971Z","type":"message"}
{"nick":"trevnorris","message":"so getting closer, but not quite.","date":"2013-02-13T00:44:42.839Z","type":"message"}
{"nick":"isaacs","message":"that's fantastic","date":"2013-02-13T00:44:59.677Z","type":"message"}
{"nick":"isaacs","message":"ship it!","date":"2013-02-13T00:45:04.398Z","type":"message"}
{"nick":"isaacs","message":"polish up the commits, send a pull req :)","date":"2013-02-13T00:45:19.267Z","type":"message"}
{"nick":"piscisaureus_","reason":"Quit: ~ Trillian Astra - www.trillian.im ~","date":"2013-02-13T00:45:23.216Z","type":"quit"}
{"nick":"isaacs","action":"off to clean up benchmark2","date":"2013-02-13T00:45:24.301Z","type":"action"}
{"nick":"isaacs","message":"thanks for the reviews","date":"2013-02-13T00:45:29.246Z","type":"message"}
{"nick":"trevnorris","message":"heh, now that's just for raw. streams are messing with the other net benchmarks.","date":"2013-02-13T00:45:39.557Z","type":"message"}
{"nick":"trevnorris","message":"np","date":"2013-02-13T00:45:40.317Z","type":"message"}
{"nick":"qmx|away","new_nick":"qmx","date":"2013-02-13T00:45:51.520Z","type":"nick"}
{"nick":"isaacs","message":"yeah","date":"2013-02-13T00:49:15.224Z","type":"message"}
{"nick":"MI61","message":"\u0002joyent/node:\u0002 \u00033isaacs\u000f \u00037master\u000f * \u00022789323\u0002 : net: Respect the 'readable' flag on sockets  Previously, we were only des - http://git.io/bI2dKA","date":"2013-02-13T00:49:40.254Z","type":"message"}
{"nick":"jmar777","date":"2013-02-13T00:54:29.235Z","type":"join"}
{"nick":"abraxas","date":"2013-02-13T00:54:35.465Z","type":"join"}
{"nick":"abraxas","reason":"Remote host closed the connection","date":"2013-02-13T00:58:21.948Z","type":"quit"}
{"nick":"abraxas","date":"2013-02-13T00:58:58.233Z","type":"join"}
{"nick":"abraxas","reason":"Read error: Connection reset by peer","date":"2013-02-13T00:59:33.416Z","type":"quit"}
{"nick":"indexzero","date":"2013-02-13T01:00:12.272Z","type":"join"}
{"nick":"abraxas","date":"2013-02-13T01:01:57.353Z","type":"join"}
{"nick":"c4milo","date":"2013-02-13T01:05:37.930Z","type":"join"}
{"nick":"MI61","message":"\u0002joyent/node:\u0002 \u00033Ben Noordhuis\u000f \u00037master\u000f * \u00023f7e88a\u0002 : buffer: accept negative indices in Buffer#slice()  A negative start or en - http://git.io/nIqyKg","date":"2013-02-13T01:18:12.942Z","type":"message"}
{"nick":"trevnorris","message":"ah, come on. just rebased...","date":"2013-02-13T01:18:27.644Z","type":"message"}
{"nick":"qmx","new_nick":"qmx|away","date":"2013-02-13T01:21:19.389Z","type":"nick"}
{"nick":"trevnorris","message":"isaacs: done and up. have fun!","date":"2013-02-13T01:22:58.645Z","type":"message"}
{"nick":"trevnorris","reason":"Quit: Leaving","date":"2013-02-13T01:23:00.923Z","type":"quit"}
{"nick":"isaacs","message":"nice :)","date":"2013-02-13T01:23:17.035Z","type":"message"}
{"nick":"AvianFlu","reason":"Remote host closed the connection","date":"2013-02-13T02:01:48.518Z","type":"quit"}
{"nick":"dap","reason":"Quit: Leaving.","date":"2013-02-13T02:06:26.067Z","type":"quit"}
{"nick":"AvianFlu","date":"2013-02-13T02:41:42.993Z","type":"join"}
{"nick":"abraxas","reason":"Read error: Connection reset by peer","date":"2013-02-13T02:49:12.018Z","type":"quit"}
{"nick":"abraxas","date":"2013-02-13T02:49:45.329Z","type":"join"}
{"nick":"abraxas","reason":"Remote host closed the connection","date":"2013-02-13T02:55:09.397Z","type":"quit"}
{"nick":"abraxas","date":"2013-02-13T02:55:46.366Z","type":"join"}
{"nick":"abraxas","reason":"Ping timeout: 248 seconds","date":"2013-02-13T03:00:17.128Z","type":"quit"}
{"nick":"abraxas","date":"2013-02-13T03:03:22.613Z","type":"join"}
{"nick":"TooTallNate","reason":"Quit: Computer has gone to sleep.","date":"2013-02-13T03:12:57.938Z","type":"quit"}
{"nick":"jmar777","reason":"Remote host closed the connection","date":"2013-02-13T03:13:59.645Z","type":"quit"}
{"nick":"kazupon","date":"2013-02-13T03:23:48.611Z","type":"join"}
{"nick":"brson","reason":"Ping timeout: 276 seconds","date":"2013-02-13T03:29:45.825Z","type":"quit"}
{"nick":"trevnorris","date":"2013-02-13T03:45:05.967Z","type":"join"}
{"nick":"mmalecki","new_nick":"mmalecki[zzz]","date":"2013-02-13T03:59:46.111Z","type":"nick"}
{"nick":"mikeal","date":"2013-02-13T03:59:58.660Z","type":"join"}
{"nick":"indexzero","reason":"Quit: indexzero","date":"2013-02-13T04:02:41.227Z","type":"quit"}
{"nick":"abraxas","reason":"Remote host closed the connection","date":"2013-02-13T04:17:43.190Z","type":"quit"}
{"nick":"abraxas","date":"2013-02-13T04:18:16.672Z","type":"join"}
{"nick":"abraxas","reason":"Ping timeout: 255 seconds","date":"2013-02-13T04:22:41.420Z","type":"quit"}
{"nick":"mikeal","reason":"Quit: Leaving.","date":"2013-02-13T04:24:07.815Z","type":"quit"}
{"nick":"mikeal","date":"2013-02-13T04:26:26.648Z","type":"join"}
{"nick":"TooTallNate","date":"2013-02-13T04:34:51.375Z","type":"join"}
{"nick":"trevnorris","reason":"Quit: Leaving","date":"2013-02-13T04:44:07.392Z","type":"quit"}
{"nick":"c4milo","reason":"Remote host closed the connection","date":"2013-02-13T04:59:35.672Z","type":"quit"}
{"nick":"abraxas","date":"2013-02-13T05:11:16.329Z","type":"join"}
{"nick":"indexzero","date":"2013-02-13T05:14:30.648Z","type":"join"}
{"nick":"TooTallNate","reason":"Quit: [\"Textual IRC Client: www.textualapp.com\"]","date":"2013-02-13T05:23:05.540Z","type":"quit"}
{"nick":"mikeal","reason":"Quit: Leaving.","date":"2013-02-13T05:35:48.820Z","type":"quit"}
{"nick":"loladiro","date":"2013-02-13T05:42:34.907Z","type":"join"}
{"nick":"mikeal","date":"2013-02-13T06:06:06.917Z","type":"join"}
{"nick":"wolfeidau","reason":"Remote host closed the connection","date":"2013-02-13T06:07:27.232Z","type":"quit"}
{"nick":"trevnorris","date":"2013-02-13T06:09:49.026Z","type":"join"}
{"nick":"AvianFlu","reason":"Remote host closed the connection","date":"2013-02-13T06:24:56.171Z","type":"quit"}
{"nick":"mikeal","reason":"Quit: Leaving.","date":"2013-02-13T06:50:18.483Z","type":"quit"}
{"nick":"mikeal","date":"2013-02-13T07:06:05.182Z","type":"join"}
{"nick":"abraxas","reason":"Remote host closed the connection","date":"2013-02-13T07:18:32.962Z","type":"quit"}
{"nick":"rendar","date":"2013-02-13T07:31:57.006Z","type":"join"}
{"nick":"loladiro","reason":"Quit: loladiro","date":"2013-02-13T07:34:20.893Z","type":"quit"}
{"nick":"indutny","message":"hoya","date":"2013-02-13T07:43:25.251Z","type":"message"}
{"nick":"indutny","message":"good morning","date":"2013-02-13T07:43:26.887Z","type":"message"}
{"nick":"indexzero","reason":"Quit: indexzero","date":"2013-02-13T07:43:34.097Z","type":"quit"}
{"nick":"Ralt","date":"2013-02-13T08:12:27.669Z","type":"join"}
{"nick":"`3rdEden","date":"2013-02-13T08:24:35.934Z","type":"join"}
{"nick":"abraxas","date":"2013-02-13T09:09:29.282Z","type":"join"}
{"nick":"kazupon","reason":"Remote host closed the connection","date":"2013-02-13T09:18:58.053Z","type":"quit"}
{"nick":"kazupon","date":"2013-02-13T09:57:22.978Z","type":"join"}
{"nick":"indutny","reason":"Quit: IRCRelay - http://ircrelay.com","date":"2013-02-13T10:09:29.145Z","type":"quit"}
{"nick":"indutny","date":"2013-02-13T10:11:42.952Z","type":"join"}
{"nick":"trevnorris","reason":"Ping timeout: 276 seconds","date":"2013-02-13T10:30:57.813Z","type":"quit"}
{"nick":"indutny","message":"ircretary: tell bnoordhuis to take a look at https://blogs.oracle.com/pgdh/entry/how_not_to_load_balance1","date":"2013-02-13T10:37:17.666Z","type":"message"}
{"nick":"ircretary","message":"indutny: I'll be sure to tell bnoordhuis","date":"2013-02-13T10:37:17.799Z","type":"message"}
{"nick":"abraxas","reason":"Remote host closed the connection","date":"2013-02-13T11:01:29.633Z","type":"quit"}
{"nick":"abraxas","date":"2013-02-13T11:02:02.478Z","type":"join"}
{"nick":"abraxas","reason":"Ping timeout: 252 seconds","date":"2013-02-13T11:06:15.137Z","type":"quit"}
{"nick":"wolfeidau","date":"2013-02-13T11:19:50.060Z","type":"join"}
{"nick":"indutny","message":"bnoordhuis: where art thou?","date":"2013-02-13T11:28:18.060Z","type":"message"}
{"nick":"kazupon","reason":"Remote host closed the connection","date":"2013-02-13T11:55:43.228Z","type":"quit"}
{"nick":"c4milo","date":"2013-02-13T12:07:37.020Z","type":"join"}
{"nick":"bnoordhuis","date":"2013-02-13T12:16:51.680Z","type":"join"}
{"nick":"indutny","message":"bnoordhuis: morning","date":"2013-02-13T12:18:17.191Z","type":"message"}
{"nick":"bnoordhuis","message":"indutny: sup fedor?","date":"2013-02-13T12:24:28.604Z","type":"message"}
{"nick":"indutny","message":"wanna discuss load-balancing a little bit?","date":"2013-02-13T12:24:40.064Z","type":"message"}
{"nick":"indutny","message":"bt","date":"2013-02-13T12:24:41.355Z","type":"message"}
{"nick":"indutny","message":"btw","date":"2013-02-13T12:24:42.979Z","type":"message"}
{"nick":"indutny","message":"have you seen the link I've sent you 2 hours ago?","date":"2013-02-13T12:24:52.208Z","type":"message"}
{"nick":"indutny","message":"https://blogs.oracle.com/pgdh/entry/how_not_to_load_balance1","date":"2013-02-13T12:24:56.265Z","type":"message"}
{"nick":"bnoordhuis","message":"oh hah","date":"2013-02-13T12:25:08.197Z","type":"message"}
{"nick":"bnoordhuis","message":"i miss privmsgs all the time because i've no notifications set up here","date":"2013-02-13T12:25:20.011Z","type":"message"}
{"nick":"bnoordhuis","message":"so what do you want to talk about?","date":"2013-02-13T12:26:31.704Z","type":"message"}
{"nick":"indutny","message":"about our problem with load balancing","date":"2013-02-13T12:27:15.029Z","type":"message"}
{"nick":"indutny","message":"I don't think that usleep(1) is really solving it","date":"2013-02-13T12:27:23.007Z","type":"message"}
{"nick":"indutny","message":"also","date":"2013-02-13T12:27:34.020Z","type":"message"}
{"nick":"bnoordhuis","message":"i disabled that already","date":"2013-02-13T12:27:47.957Z","type":"message"}
{"nick":"indutny","message":"yep","date":"2013-02-13T12:27:50.410Z","type":"message"}
{"nick":"indutny","message":"I know","date":"2013-02-13T12:27:51.211Z","type":"message"}
{"nick":"indutny","message":"I wanted to ask you if calling accept() in a loop is worth it","date":"2013-02-13T12:28:02.771Z","type":"message"}
{"nick":"indutny","message":"probably its not that bad to do it just once per epoll_wait()/kevent() return","date":"2013-02-13T12:28:18.003Z","type":"message"}
{"nick":"indutny","message":"to verify my assumption","date":"2013-02-13T12:28:32.361Z","type":"message"}
{"nick":"indutny","message":"can I ask you to build https://github.com/indutny/fork-accept","date":"2013-02-13T12:28:36.564Z","type":"message"}
{"nick":"indutny","message":"and run ./fork-accept 24","date":"2013-02-13T12:28:42.643Z","type":"message"}
{"nick":"indutny","message":"and then benchmark it","date":"2013-02-13T12:28:44.903Z","type":"message"}
{"nick":"indutny","message":"and then move initialization code inside the loop: https://github.com/indutny/fork-accept/blob/master/fork-accept.c#L127","date":"2013-02-13T12:29:12.154Z","type":"message"}
{"nick":"indutny","message":"and benchmark again","date":"2013-02-13T12:29:14.294Z","type":"message"}
{"nick":"bnoordhuis","message":"i'm on the same os as you currently","date":"2013-02-13T12:31:02.355Z","type":"message"}
{"nick":"bnoordhuis","message":"so i expect we'll see the same numbers","date":"2013-02-13T12:31:16.654Z","type":"message"}
{"nick":"bnoordhuis","message":"btw, accept()ing once per loop iteration is something i've tried in the past","date":"2013-02-13T12:31:36.938Z","type":"message"}
{"nick":"indutny","message":"bnoordhuis: and?","date":"2013-02-13T12:31:44.251Z","type":"message"}
{"nick":"bnoordhuis","message":"it didn't really help, distribution was still very uneven","date":"2013-02-13T12:31:56.269Z","type":"message"}
{"nick":"indutny","message":"interesting","date":"2013-02-13T12:32:03.588Z","type":"message"}
{"nick":"indutny","message":"so the problem is that epoll_wait()/kevent() is returning for all threads at once","date":"2013-02-13T12:32:15.069Z","type":"message"}
{"nick":"indutny","message":"s/threads/forks/","date":"2013-02-13T12:32:20.895Z","type":"message"}
{"nick":"indutny","message":"in the most of the cases","date":"2013-02-13T12:32:30.577Z","type":"message"}
{"nick":"indutny","message":"or","date":"2013-02-13T12:32:31.059Z","type":"message"}
{"nick":"bnoordhuis","message":"no","date":"2013-02-13T12:32:35.096Z","type":"message"}
{"nick":"indutny","message":"it returns nearly at the same time","date":"2013-02-13T12:32:41.155Z","type":"message"}
{"nick":"bnoordhuis","message":"only one thread gets the readiness event","date":"2013-02-13T12:32:42.625Z","type":"message"}
{"nick":"indutny","message":"that's impossible","date":"2013-02-13T12:32:48.326Z","type":"message"}
{"nick":"indutny","message":"kqueue/epoll is level-triggered by default","date":"2013-02-13T12:32:55.556Z","type":"message"}
{"nick":"indutny","message":"so one incoming socket should trigger all forks that were listening","date":"2013-02-13T12:33:16.384Z","type":"message"}
{"nick":"bnoordhuis","message":"i'm pretty sure they don't","date":"2013-02-13T12:33:26.528Z","type":"message"}
{"nick":"bnoordhuis","message":"that's the thundering herd problem all over again","date":"2013-02-13T12:33:35.586Z","type":"message"}
{"nick":"indutny","message":"well","date":"2013-02-13T12:33:43.360Z","type":"message"}
{"nick":"bnoordhuis","message":"but you can verify that yourself, of course","date":"2013-02-13T12:33:44.498Z","type":"message"}
{"nick":"indutny","message":"why not?","date":"2013-02-13T12:33:48.402Z","type":"message"}
{"nick":"indutny","message":"I mean","date":"2013-02-13T12:33:49.837Z","type":"message"}
{"nick":"indutny","message":"this is logical","date":"2013-02-13T12:33:51.742Z","type":"message"}
{"nick":"indutny","message":"otherwise it doesn't work as it is documented","date":"2013-02-13T12:34:00.592Z","type":"message"}
{"nick":"bnoordhuis","message":"i might be wrong. try it and find out :)","date":"2013-02-13T12:34:07.269Z","type":"message"}
{"nick":"indutny","message":"suppose you've 32 forks that ain't calling accept() at all","date":"2013-02-13T12:34:10.253Z","type":"message"}
{"nick":"indutny","message":"my guess, is that every fork will observe that server socket has received incoming connection","date":"2013-02-13T12:34:33.180Z","type":"message"}
{"nick":"indutny","message":"(which is true only for level-triggered systems)","date":"2013-02-13T12:34:51.455Z","type":"message"}
{"nick":"indutny","message":"otherwise implementation is incorrect","date":"2013-02-13T12:35:03.349Z","type":"message"}
{"nick":"bnoordhuis","message":"well, maybe","date":"2013-02-13T12:35:35.572Z","type":"message"}
{"nick":"indutny","message":"so, this is what really causes the problem","date":"2013-02-13T12:35:44.577Z","type":"message"}
{"nick":"indutny","message":"as far as I understand it","date":"2013-02-13T12:35:48.024Z","type":"message"}
{"nick":"bnoordhuis","message":"if those 32 threads are calling accept() in blocking mode, only one is woken up though","date":"2013-02-13T12:35:51.014Z","type":"message"}
{"nick":"indutny","message":"yes","date":"2013-02-13T12:35:55.684Z","type":"message"}
{"nick":"indutny","message":"exactly","date":"2013-02-13T12:35:57.314Z","type":"message"}
{"nick":"indutny","message":"and that way load balancing works a little bit better","date":"2013-02-13T12:36:13.302Z","type":"message"}
{"nick":"indutny","message":"right?","date":"2013-02-13T12:36:15.148Z","type":"message"}
{"nick":"indutny","message":"well, I'm pretty sure it is","date":"2013-02-13T12:36:55.817Z","type":"message"}
{"nick":"indutny","message":"what I think we could try to do is randomly (or in a round-robin way) ignoring events for server socket","date":"2013-02-13T12:37:49.055Z","type":"message"}
{"nick":"bnoordhuis","message":"err","date":"2013-02-13T12:38:01.907Z","type":"message"}
{"nick":"indutny","message":"yeah","date":"2013-02-13T12:38:04.994Z","type":"message"}
{"nick":"indutny","message":"I'll experiment with it more","date":"2013-02-13T12:38:14.486Z","type":"message"}
{"nick":"indutny","message":"but it seems to be the right way to solve it","date":"2013-02-13T12:38:21.770Z","type":"message"}
{"nick":"indutny","message":"btw","date":"2013-02-13T12:38:23.549Z","type":"message"}
{"nick":"indutny","message":"do you know how nginx deals with this problem?","date":"2013-02-13T12:38:30.286Z","type":"message"}
{"nick":"indutny","message":"hint: http://wiki.nginx.org/EventsModule","date":"2013-02-13T12:39:33.025Z","type":"message"}
{"nick":"indutny","message":"accept_mutex","date":"2013-02-13T12:39:34.788Z","type":"message"}
{"nick":"bnoordhuis","message":"is that a process-shared mutex?","date":"2013-02-13T12:40:05.467Z","type":"message"}
{"nick":"indutny","message":"yes","date":"2013-02-13T12:40:10.090Z","type":"message"}
{"nick":"indutny","message":"we can't really use it","date":"2013-02-13T12:40:18.747Z","type":"message"}
{"nick":"indutny","message":"but its pretty interesting that this hack is enabled by default","date":"2013-02-13T12:40:30.534Z","type":"message"}
{"nick":"indutny","message":"ah","date":"2013-02-13T12:41:04.885Z","type":"message"}
{"nick":"indutny","message":"it seems that its just reducing contention inside kernel","date":"2013-02-13T12:41:15.879Z","type":"message"}
{"nick":"qmx|away","new_nick":"qmx","date":"2013-02-13T12:42:01.227Z","type":"nick"}
{"nick":"indutny","message":"bnoordhuis: must admit usleep() solution works pretty well on ubuntu for me too","date":"2013-02-13T12:57:28.907Z","type":"message"}
{"nick":"indutny","message":"not like all processes are getting the same amount of work-load","date":"2013-02-13T12:57:47.476Z","type":"message"}
{"nick":"indutny","message":"but its pretty close","date":"2013-02-13T12:57:50.305Z","type":"message"}
{"nick":"kazupon","date":"2013-02-13T13:06:09.922Z","type":"join"}
{"nick":"indutny","message":"I'm scared","date":"2013-02-13T13:11:10.896Z","type":"message"}
{"nick":"kazupon","reason":"Ping timeout: 272 seconds","date":"2013-02-13T13:11:54.820Z","type":"quit"}
{"nick":"bnoordhuis","message":"hah :)","date":"2013-02-13T13:16:36.302Z","type":"message"}
{"nick":"bnoordhuis","message":"the only problem is that it kills throughput","date":"2013-02-13T13:16:51.790Z","type":"message"}
{"nick":"indutny","message":"yes","date":"2013-02-13T13:17:43.396Z","type":"message"}
{"nick":"indutny","message":"and it does it surprisingly well","date":"2013-02-13T13:17:52.767Z","type":"message"}
{"nick":"kazupon","date":"2013-02-13T13:21:26.995Z","type":"join"}
{"nick":"kazupon","reason":"Remote host closed the connection","date":"2013-02-13T13:22:56.952Z","type":"quit"}
{"nick":"jmar777","date":"2013-02-13T13:28:44.641Z","type":"join"}
{"nick":"benoitc","reason":"Excess Flood","date":"2013-02-13T13:44:34.645Z","type":"quit"}
{"nick":"benoitc","date":"2013-02-13T13:44:41.468Z","type":"join"}
{"nick":"mmalecki[zzz]","new_nick":"mmalecki","date":"2013-02-13T14:23:45.492Z","type":"nick"}
{"nick":"bradleymeck","date":"2013-02-13T14:55:32.703Z","type":"join"}
{"nick":"loladiro","date":"2013-02-13T14:55:38.793Z","type":"join"}
{"nick":"MI61","message":"\u0002joyent/node:\u0002 \u00033Ben Noordhuis\u000f \u00037master\u000f * \u00027bdd05b\u0002 : stream_wrap, udp_wrap: add read-only fd property  Expose the file descrip (+2 more commits) - http://git.io/E5tYqg","date":"2013-02-13T15:13:22.640Z","type":"message"}
{"nick":"saghul","message":"bnoordhuis is the fd \"public\" now?","date":"2013-02-13T15:29:27.375Z","type":"message"}
{"nick":"saghul","message":"at the libuv level, that is","date":"2013-02-13T15:30:06.556Z","type":"message"}
{"nick":"bnoordhuis","message":"saghul: no. i'm the only one that's allowed to cheat","date":"2013-02-13T15:35:53.129Z","type":"message"}
{"nick":"bnoordhuis","message":"because the only code i'll be breaking if i change it is my own","date":"2013-02-13T15:36:18.922Z","type":"message"}
{"nick":"saghul","message":"bnoordhuis haha, I see","date":"2013-02-13T15:36:29.451Z","type":"message"}
{"nick":"MI61","message":"\u0002joyent/node:\u0002 \u00033Dan Kohn\u000f \u00037v0.8\u000f * \u00022e1ebbf\u0002 : doc: add prompt to fix repl_test.js example  Running repl.start without t - http://git.io/WCT0kQ","date":"2013-02-13T15:40:49.376Z","type":"message"}
{"nick":"AvianFlu","date":"2013-02-13T15:53:23.815Z","type":"join"}
{"nick":"loladiro","reason":"Quit: loladiro","date":"2013-02-13T15:55:05.343Z","type":"quit"}
{"nick":"hz","date":"2013-02-13T15:59:25.452Z","type":"join"}
