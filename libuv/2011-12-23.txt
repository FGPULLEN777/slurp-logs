{"nick":"paddybyers","reason":"Quit: paddybyers","date":"2011-12-23T00:00:16.613Z","type":"quit"}
{"nick":"TooTallNate","reason":"Read error: Connection reset by peer","date":"2011-12-23T00:33:11.724Z","type":"quit"}
{"nick":"nathan","date":"2011-12-23T00:33:14.891Z","type":"join"}
{"nick":"nathan","new_nick":"Guest37993","date":"2011-12-23T00:33:41.104Z","type":"nick"}
{"nick":"Guest37993","new_nick":"TooTallNate","date":"2011-12-23T00:41:51.167Z","type":"nick"}
{"nick":"sh1mmer","reason":"Quit: sh1mmer","date":"2011-12-23T01:06:28.101Z","type":"quit"}
{"nick":"indexzero","reason":"Quit: indexzero","date":"2011-12-23T01:17:49.969Z","type":"quit"}
{"nick":"indexzero","date":"2011-12-23T01:19:47.282Z","type":"join"}
{"nick":"sh1mmer","date":"2011-12-23T01:19:47.963Z","type":"join"}
{"nick":"piscisaureus_","date":"2011-12-23T01:25:44.128Z","type":"join"}
{"nick":"piscisaureus_","message":"ryah bnoordhuis: http://groups.google.com/group/nodejs/msg/f5273f0a7b1c665e","date":"2011-12-23T01:36:03.830Z","type":"message"}
{"nick":"piscisaureus_","message":"do we know why?","date":"2011-12-23T01:36:13.094Z","type":"message"}
{"nick":"ryah","message":"piscisaureus_: no","date":"2011-12-23T01:39:33.373Z","type":"message"}
{"nick":"ryah","message":"piscisaureus_: that code has not been touched much between v0.4 and v0.6","date":"2011-12-23T01:39:46.160Z","type":"message"}
{"nick":"ryah","message":"but we should add a benchmark to the tree and get it up on http://arlolra.no.de/","date":"2011-12-23T01:40:02.852Z","type":"message"}
{"nick":"piscisaureus_","message":"ryah: I am afraid libuv could be slower than libev","date":"2011-12-23T01:40:09.342Z","type":"message"}
{"nick":"piscisaureus_","message":"that is, the number of rounds the event loop can make per second","date":"2011-12-23T01:40:21.911Z","type":"message"}
{"nick":"ryah","message":"yeah","date":"2011-12-23T01:41:06.373Z","type":"message"}
{"nick":"ryah","message":"could be ","date":"2011-12-23T01:41:09.905Z","type":"message"}
{"nick":"piscisaureus_","message":"maybe it's that we compile with EV_MULTIPLICITY and the overhead of uv_default_loop()","date":"2011-12-23T01:41:19.052Z","type":"message"}
{"nick":"piscisaureus_","message":"because afaict libuv-unix does not much more than libev otherwise","date":"2011-12-23T01:41:42.578Z","type":"message"}
{"nick":"ryah","message":"i seriously doubt that is the cause","date":"2011-12-23T01:41:55.461Z","type":"message"}
{"nick":"ryah","message":"more likely some random V8 shit","date":"2011-12-23T01:42:03.447Z","type":"message"}
{"nick":"piscisaureus_","message":"oh yeah","date":"2011-12-23T01:42:15.741Z","type":"message"}
{"nick":"piscisaureus_","message":"I should run it with --trace-bailout --trace-deopt","date":"2011-12-23T01:42:31.160Z","type":"message"}
{"nick":"ryah","message":"piscisaureus_: commit the benchmark into the benchmark dir","date":"2011-12-23T01:42:45.951Z","type":"message"}
{"nick":"piscisaureus_","message":"k","date":"2011-12-23T01:42:58.504Z","type":"message"}
{"nick":"sh1mmer","reason":"Quit: sh1mmer","date":"2011-12-23T01:43:51.463Z","type":"quit"}
{"nick":"sh1mmer","date":"2011-12-23T01:45:07.981Z","type":"join"}
{"nick":"sh1mmer","reason":"Client Quit","date":"2011-12-23T01:47:54.341Z","type":"quit"}
{"nick":"piscisaureus_","message":"ryah: we already have it in our tree :-/","date":"2011-12-23T02:07:14.371Z","type":"message"}
{"nick":"piscisaureus_","message":"but my benchmark tests something else so I am going to land that too","date":"2011-12-23T02:08:09.417Z","type":"message"}
{"nick":"CIA-111","message":"\u0002node:\u000f \u000303Bert Belder\u000f \u000307v0.6\u000f * r\u0002c6347dc\u000f \u000310\u000f/ benchmark/next-tick-2.js \u0002:\u000f ","date":"2011-12-23T02:10:22.021Z","type":"message"}
{"nick":"CIA-111","message":"\u0002node:\u000f Add another nextTick benchmark","date":"2011-12-23T02:10:22.250Z","type":"message"}
{"nick":"CIA-111","message":"\u0002node:\u000f It tests how many iterations the event loop can make per second. - http://git.io/wyBnDA","date":"2011-12-23T02:10:22.250Z","type":"message"}
{"nick":"travis-ci","date":"2011-12-23T02:18:10.885Z","type":"join"}
{"nick":"travis-ci","message":"[travis-ci] joyent/node#138 (v0.6 - c6347dc : Bert Belder): The build passed.","date":"2011-12-23T02:18:11.111Z","type":"message"}
{"nick":"travis-ci","message":"[travis-ci] Change view : https://github.com/joyent/node/compare/cf2513e...c6347dc","date":"2011-12-23T02:18:11.111Z","type":"message"}
{"nick":"travis-ci","message":"[travis-ci] Build details : http://travis-ci.org/joyent/node/builds/439460","date":"2011-12-23T02:18:11.111Z","type":"message"}
{"nick":"travis-ci","date":"2011-12-23T02:18:11.111Z","type":"part"}
{"nick":"ryah","message":"piscisaureus_: thanks","date":"2011-12-23T02:25:22.126Z","type":"message"}
{"nick":"ryah","message":"arlolra: yt?","date":"2011-12-23T02:29:07.839Z","type":"message"}
{"nick":"ryah","message":"arlolra: can you add https://github.com/joyent/node/commit/c6347dcfb43273214dc872e60c8cd94a93fee027 to the website?","date":"2011-12-23T02:29:16.579Z","type":"message"}
{"nick":"arlolra","message":"for sure","date":"2011-12-23T02:29:48.879Z","type":"message"}
{"nick":"ryah","message":"arlolra: danke","date":"2011-12-23T02:44:37.936Z","type":"message"}
{"nick":"sh1mmer","date":"2011-12-23T02:51:47.392Z","type":"join"}
{"nick":"indexzero","reason":"Quit: indexzero","date":"2011-12-23T03:07:52.502Z","type":"quit"}
{"nick":"TooTallNate","reason":"Quit: Linkinus - http://linkinus.com","date":"2011-12-23T03:18:19.982Z","type":"quit"}
{"nick":"indexzero","date":"2011-12-23T03:22:16.302Z","type":"join"}
{"nick":"pietern","reason":"Quit: pietern","date":"2011-12-23T03:54:08.318Z","type":"quit"}
{"nick":"rmustacc","date":"2011-12-23T04:20:58.278Z","type":"part"}
{"nick":"piscisaureus_","message":"ryah: https://gist.github.com/d50183eb434370cafe6a <-- think about it","date":"2011-12-23T04:23:46.965Z","type":"message"}
{"nick":"ryah","message":"isn't finally a keyword?","date":"2011-12-23T04:31:14.359Z","type":"message"}
{"nick":"piscisaureus_","message":"ryah: yeah","date":"2011-12-23T04:31:26.899Z","type":"message"}
{"nick":"piscisaureus_","message":"ryah: I just used it as a function name","date":"2011-12-23T04:31:34.246Z","type":"message"}
{"nick":"piscisaureus_","message":"ryah: replace it by `onend`  or by nameless functions","date":"2011-12-23T04:31:54.285Z","type":"message"}
{"nick":"ryah","message":"this seems like a math problem to me","date":"2011-12-23T04:32:45.057Z","type":"message"}
{"nick":"ryah","message":"it feels the same :)","date":"2011-12-23T04:32:56.089Z","type":"message"}
{"nick":"piscisaureus_","message":"to me too","date":"2011-12-23T04:33:06.679Z","type":"message"}
{"nick":"piscisaureus_","message":"it is extremely difficult to reason about","date":"2011-12-23T04:33:16.961Z","type":"message"}
{"nick":"piscisaureus_","message":"good luck you got a degree in math :-)","date":"2011-12-23T04:33:36.567Z","type":"message"}
{"nick":"piscisaureus_","message":"s/good luck/luckily/","date":"2011-12-23T04:33:52.881Z","type":"message"}
{"nick":"piscisaureus_","message":"the createServer(function(socket) { ... is a nasty problem","date":"2011-12-23T04:34:28.426Z","type":"message"}
{"nick":"ryah","message":"what does createDomain pass to it's first arg? ","date":"2011-12-23T04:35:01.030Z","type":"message"}
{"nick":"piscisaureus_","message":"nothing","date":"2011-12-23T04:35:14.574Z","type":"message"}
{"nick":"ryah","message":"var d2 = createDomain(function finally2(err) { if (err) console.log(err); console.log(\"the end\");","date":"2011-12-23T04:35:27.100Z","type":"message"}
{"nick":"ryah","message":"});","date":"2011-12-23T04:35:30.598Z","type":"message"}
{"nick":"ryah","message":"^-- is err ever non-null ?","date":"2011-12-23T04:35:34.797Z","type":"message"}
{"nick":"piscisaureus_","message":"oh yeah","date":"2011-12-23T04:35:38.890Z","type":"message"}
{"nick":"piscisaureus_","message":"if someone threw within the domain","date":"2011-12-23T04:35:46.089Z","type":"message"}
{"nick":"ryah","message":"oh i see","date":"2011-12-23T04:35:58.441Z","type":"message"}
{"nick":"benvie","message":"finally will throw because it's a keyword, but it'll only throw after the user throws? is that how it works?","date":"2011-12-23T04:36:04.596Z","type":"message"}
{"nick":"ryah","message":"i think you should rename finally piscisaureus_ - just so it's not confusing","date":"2011-12-23T04:36:22.966Z","type":"message"}
{"nick":"ryah","message":"`finally`","date":"2011-12-23T04:36:30.447Z","type":"message"}
{"nick":"piscisaureus_","message":"yeah","date":"2011-12-23T04:37:31.535Z","type":"message"}
{"nick":"ryah","message":"piscisaureus_: \"but not before at least one piece of code has been run in the domain.\"","date":"2011-12-23T04:37:43.672Z","type":"message"}
{"nick":"ryah","message":"what does \"one piece of code\" mean?","date":"2011-12-23T04:37:56.498Z","type":"message"}
{"nick":"piscisaureus_","message":"ryah: just like node. It will exit when the refcount drops to 0","date":"2011-12-23T04:39:18.265Z","type":"message"}
{"nick":"ryah","message":"piscisaureus_: i was thinking something more built in: net.createDomainServer(function (domain) { /* called for each connection */ })","date":"2011-12-23T04:39:57.689Z","type":"message"}
{"nick":"ryah","message":"piscisaureus_: it blocks?","date":"2011-12-23T04:40:09.035Z","type":"message"}
{"nick":"piscisaureus_","message":"ryah: oh no","date":"2011-12-23T04:40:18.074Z","type":"message"}
{"nick":"ryah","message":"then we don't have to say  The socket cannot have any callbacks attached at that point.","date":"2011-12-23T04:40:57.133Z","type":"message"}
{"nick":"ryah","message":"^-- this is a funny restriction","date":"2011-12-23T04:41:03.874Z","type":"message"}
{"nick":"ryah","message":"would be best to avoid","date":"2011-12-23T04:41:06.889Z","type":"message"}
{"nick":"ryah","message":"by a different API","date":"2011-12-23T04:41:13.121Z","type":"message"}
{"nick":"ryah","message":"although what you have is okay","date":"2011-12-23T04:41:59.326Z","type":"message"}
{"nick":"piscisaureus_","message":"ryah: no I mean, the refcount is the number of io handles attached to the domain. But after one domain.run(...) call the domain may still hold io handles so it doesn't exit.","date":"2011-12-23T04:42:02.537Z","type":"message"}
{"nick":"piscisaureus_","message":"If after the first run() call the refcount is 0 the domain yields immediately after that.","date":"2011-12-23T04:42:02.769Z","type":"message"}
{"nick":"piscisaureus_","message":"but right after the createDomain call the refcount is also 0","date":"2011-12-23T04:42:16.806Z","type":"message"}
{"nick":"piscisaureus_","message":"but it should not yield right away","date":"2011-12-23T04:42:22.425Z","type":"message"}
{"nick":"ryah","message":"yep","date":"2011-12-23T04:42:23.731Z","type":"message"}
{"nick":"ryah","message":"man domains are going to be awesome","date":"2011-12-23T04:42:29.727Z","type":"message"}
{"nick":"ryah","message":"if this actually works","date":"2011-12-23T04:42:40.977Z","type":"message"}
{"nick":"ryah","message":"node will destroy erlang","date":"2011-12-23T04:42:48.173Z","type":"message"}
{"nick":"ryah","message":"especially with isolates","date":"2011-12-23T04:43:07.797Z","type":"message"}
{"nick":"piscisaureus_","message":"I hope we won't find any nasty edge cases","date":"2011-12-23T04:45:23.953Z","type":"message"}
{"nick":"benvie","date":"2011-12-23T04:45:40.530Z","type":"quit"}
{"nick":"piscisaureus_","message":"the guarantuee that we *must* make is that every domain always yields reliably","date":"2011-12-23T04:45:47.037Z","type":"message"}
{"nick":"ryah","message":"piscisaureus_: yes the ref count thing i also thought baout before","date":"2011-12-23T04:46:54.068Z","type":"message"}
{"nick":"ryah","message":"i think it's a good idea","date":"2011-12-23T04:46:57.172Z","type":"message"}
{"nick":"piscisaureus_","message":"I like that part best. People want to encapsulate an complex operation and then they just want one result: did it work or did it not?","date":"2011-12-23T04:47:06.645Z","type":"message"}
{"nick":"ryah","message":"yes","date":"2011-12-23T04:47:16.204Z","type":"message"}
{"nick":"ryah","message":"it will be good for doing the debugger","date":"2011-12-23T04:47:23.367Z","type":"message"}
{"nick":"ryah","message":"we won't return until the V8 RPC returns","date":"2011-12-23T04:47:33.178Z","type":"message"}
{"nick":"ryah","message":"we can do that with a domain","date":"2011-12-23T04:47:40.899Z","type":"message"}
{"nick":"ryah","message":"that basically saves you from passing a callback through the system","date":"2011-12-23T04:47:56.088Z","type":"message"}
{"nick":"piscisaureus_","message":"yeah","date":"2011-12-23T04:48:28.085Z","type":"message"}
{"nick":"ryah","message":"well.. hm","date":"2011-12-23T04:48:29.836Z","type":"message"}
{"nick":"ryah","message":"if we opened the socket for each RPC - it would be easy","date":"2011-12-23T04:48:39.113Z","type":"message"}
{"nick":"ryah","message":"maybe in this case it doesnt","date":"2011-12-23T04:48:44.505Z","type":"message"}
{"nick":"piscisaureus_","message":"I am not quite sure about black holing a run() to a domain that has already yielded","date":"2011-12-23T04:49:39.476Z","type":"message"}
{"nick":"piscisaureus_","message":"it may be better to make it throw","date":"2011-12-23T04:49:46.583Z","type":"message"}
{"nick":"ryah","message":"try-catch for events","date":"2011-12-23T04:50:11.757Z","type":"message"}
{"nick":"ryah","message":"this is what it is","date":"2011-12-23T04:50:19.508Z","type":"message"}
{"nick":"piscisaureus_","message":"that's what I wanted","date":"2011-12-23T04:50:51.889Z","type":"message"}
{"nick":"piscisaureus_","message":"the only annoying thing is that you cannot really \"detect\" callbacks","date":"2011-12-23T04:51:05.699Z","type":"message"}
{"nick":"ryah","message":"oh right - that's why you call it finally","date":"2011-12-23T04:51:07.749Z","type":"message"}
{"nick":"piscisaureus_","message":"it needs work for sure ... this is just a draft","date":"2011-12-23T04:52:43.059Z","type":"message"}
{"nick":"piscisaureus_","message":"http://groups.google.com/group/nodejs/browse_thread/thread/9d608f19d9f7b5c4 hmmm","date":"2011-12-23T05:32:17.822Z","type":"message"}
{"nick":"arlolra","message":"piscisaureus_: from your gist above, on line 46, the d2.run(something) ... would that run if the above call to run hadn't yielded yet? that seems unreliable if it would","date":"2011-12-23T05:33:36.649Z","type":"message"}
{"nick":"arlolra","message":"maybe just ignore that question","date":"2011-12-23T05:35:28.309Z","type":"message"}
{"nick":"piscisaureus_","message":"arlolra: yeah I agree there may be a problem here","date":"2011-12-23T05:37:05.062Z","type":"message"}
{"nick":"arlolra","message":"ok, the rest seemed pretty clear though","date":"2011-12-23T05:37:54.224Z","type":"message"}
{"nick":"piscisaureus_","message":"maybe I should not allow a second run() call like that","date":"2011-12-23T05:37:57.645Z","type":"message"}
{"nick":"piscisaureus_","message":"ryah: why is the stream.write callback not documented? Is it not supposed to be used?","date":"2011-12-23T05:41:05.415Z","type":"message"}
{"nick":"benvie","date":"2011-12-23T05:44:57.051Z","type":"join"}
{"nick":"einaros-","reason":"Ping timeout: 276 seconds","date":"2011-12-23T05:47:49.242Z","type":"quit"}
{"nick":"ryah","message":"piscisaureus_: it should be documented","date":"2011-12-23T06:25:46.831Z","type":"message"}
{"nick":"piscisaureus_","reason":"Ping timeout: 255 seconds","date":"2011-12-23T06:28:49.076Z","type":"quit"}
{"nick":"sh1mmer","reason":"Read error: Connection reset by peer","date":"2011-12-23T07:21:31.411Z","type":"quit"}
{"nick":"sh1mmer","date":"2011-12-23T07:21:48.143Z","type":"join"}
{"nick":"sh1mmer","reason":"Client Quit","date":"2011-12-23T07:23:44.415Z","type":"quit"}
{"nick":"sh1mmer","date":"2011-12-23T07:26:39.966Z","type":"join"}
{"nick":"AvianFlu","reason":"Quit: Leaving","date":"2011-12-23T07:33:43.869Z","type":"quit"}
{"nick":"paddybyers","date":"2011-12-23T08:01:13.528Z","type":"join"}
{"nick":"paddybyers_","date":"2011-12-23T10:00:27.807Z","type":"join"}
{"nick":"Skomski","date":"2011-12-23T10:01:47.818Z","type":"join"}
{"nick":"paddybyers","reason":"Ping timeout: 240 seconds","date":"2011-12-23T10:03:16.377Z","type":"quit"}
{"nick":"paddybyers_","new_nick":"paddybyers","date":"2011-12-23T10:03:16.600Z","type":"nick"}
{"nick":"felixge","date":"2011-12-23T10:45:59.330Z","type":"join"}
{"nick":"felixge","reason":"Changing host","date":"2011-12-23T10:45:59.640Z","type":"quit"}
{"nick":"felixge","date":"2011-12-23T10:45:59.868Z","type":"join"}
{"nick":"dshaw_","date":"2011-12-23T11:44:18.897Z","type":"join"}
{"nick":"dshaw_","reason":"Ping timeout: 240 seconds","date":"2011-12-23T12:03:22.909Z","type":"quit"}
{"nick":"Skomski","reason":"Quit: Nettalk6 - www.ntalk.de","date":"2011-12-23T13:02:26.994Z","type":"quit"}
{"nick":"piscisaureus_","date":"2011-12-23T14:02:24.580Z","type":"join"}
{"nick":"felixge","reason":"Quit: http://www.debuggable.com/","date":"2011-12-23T14:31:14.436Z","type":"quit"}
{"nick":"CoverSli1e","date":"2011-12-23T14:47:20.595Z","type":"join"}
{"nick":"CoverSlide","reason":"Read error: Connection reset by peer","date":"2011-12-23T14:47:54.997Z","type":"quit"}
{"nick":"piscisaureus_","message":"ryah: bnoordhuis: no call tonight right?","date":"2011-12-23T17:46:54.439Z","type":"message"}
{"nick":"sh1mmer","reason":"Quit: sh1mmer","date":"2011-12-23T17:55:26.684Z","type":"quit"}
{"nick":"AvianFlu","date":"2011-12-23T17:58:54.252Z","type":"join"}
{"nick":"dshaw_","date":"2011-12-23T18:02:13.391Z","type":"join"}
{"nick":"piscisaureus_","reason":"Quit: ~ Trillian Astra - www.trillian.im ~","date":"2011-12-23T18:24:02.444Z","type":"quit"}
{"nick":"TooTallNate","date":"2011-12-23T18:47:30.916Z","type":"join"}
{"nick":"mraleph","date":"2011-12-23T19:06:24.006Z","type":"join"}
{"nick":"mjr_","message":"Hey guys, looks like we are still getting cores from http parser.","date":"2011-12-23T20:37:24.546Z","type":"message"}
{"nick":"mjr_","message":"I'll send up a few.","date":"2011-12-23T20:37:38.158Z","type":"message"}
{"nick":"dshaw_","reason":"Quit: Leaving.","date":"2011-12-23T20:42:07.370Z","type":"quit"}
{"nick":"mjr_","message":"https://gist.github.com/a9722d25619c0ef7eb21","date":"2011-12-23T20:42:20.188Z","type":"message"}
{"nick":"piscisaureus_","date":"2011-12-23T20:43:12.794Z","type":"join"}
{"nick":"mjr_","message":"So it looks like its still breaking in a similar place, although perhaps for a different reason.","date":"2011-12-23T20:44:41.218Z","type":"message"}
{"nick":"mjr_","message":"It seems like our client might be sending a seriously mangled header, but perhaps it is also node getting confused.","date":"2011-12-23T20:45:09.284Z","type":"message"}
{"nick":"mmalecki","message":"mjr_: do you maybe know headers client sends?","date":"2011-12-23T20:46:31.757Z","type":"message"}
{"nick":"mjr_","message":"oh sure, I have the source code","date":"2011-12-23T20:46:48.687Z","type":"message"}
{"nick":"mjr_","message":"But every time I look, the client is doing the right thing.","date":"2011-12-23T20:47:08.904Z","type":"message"}
{"nick":"mmalecki","message":"mjr_: hm, can you replicate it? or does it only appear under some bigger load?","date":"2011-12-23T20:47:54.244Z","type":"message"}
{"nick":"mjr_","message":"Only in production","date":"2011-12-23T20:48:02.759Z","type":"message"}
{"nick":"mmalecki","message":"mjr_: which version are you guys running?","date":"2011-12-23T20:50:51.262Z","type":"message"}
{"nick":"mjr_","message":"tracking v0.6 branch","date":"2011-12-23T20:51:01.854Z","type":"message"}
{"nick":"mjr_","message":"cores and current node executable are here:  http://voxer.com/media/cores2.tar.gz","date":"2011-12-23T20:53:24.742Z","type":"message"}
{"nick":"mjr_","message":"arch is x86_64, libs are Ubuntu 10.04","date":"2011-12-23T20:53:48.889Z","type":"message"}
{"nick":"mmalecki","message":"line 92 is weird, I'd expect length to be equal to header's length","date":"2011-12-23T20:56:36.544Z","type":"message"}
{"nick":"sh1mmer","date":"2011-12-23T21:15:56.105Z","type":"join"}
{"nick":"AndreasMadsen","date":"2011-12-23T21:17:28.113Z","type":"join"}
{"nick":"AndreasMadsen","reason":"Client Quit","date":"2011-12-23T21:18:30.855Z","type":"quit"}
{"nick":"perezd_","date":"2011-12-23T21:19:25.327Z","type":"join"}
{"nick":"perezd","reason":"Ping timeout: 252 seconds","date":"2011-12-23T21:20:11.619Z","type":"quit"}
{"nick":"perezd_","new_nick":"perezd","date":"2011-12-23T21:20:11.849Z","type":"nick"}
{"nick":"pquerna","message":"ryah: did that failure detector code ever make it into an npm package somewhere?","date":"2011-12-23T21:35:31.480Z","type":"message"}
{"nick":"mjr_","message":"pquerna: you guys ever run into this \"TCP incast\" thing in your big cassandra cluster or other big things?","date":"2011-12-23T22:28:25.417Z","type":"message"}
{"nick":"mjr_","message":"http://bradhedlund.com/2011/05/01/tcp-incast-and-cloud-application-performance/","date":"2011-12-23T22:28:26.240Z","type":"message"}
{"nick":"pquerna","message":"mjr_: yes, in memcached years ago","date":"2011-12-23T22:29:10.544Z","type":"message"}
{"nick":"pquerna","message":"mjr_: once we were above about 40 memcached nodes with a wide multi-get","date":"2011-12-23T22:29:23.744Z","type":"message"}
{"nick":"mjr_","message":"What did you do about it?","date":"2011-12-23T22:29:36.386Z","type":"message"}
{"nick":"pquerna","message":"short term, we changed our code to do multiget in batches of like 30 servers at once, and partitioned the memcached cluster along keys to keep the number of machines down","date":"2011-12-23T22:30:30.045Z","type":"message"}
{"nick":"pquerna","message":"longterm, this is why memcache added the udp protocol","date":"2011-12-23T22:30:42.424Z","type":"message"}
{"nick":"mjr_","message":"Seems like for small responses UDP would have the same issue though, no?","date":"2011-12-23T22:31:14.125Z","type":"message"}
{"nick":"pquerna","message":"in cassandra this isn't a real issue, because most of the time our replica count is like 5 or 7,  and most queries have 'row' locality","date":"2011-12-23T22:31:35.475Z","type":"message"}
{"nick":"pquerna","message":"and a row is the level of partitioning for cross-machine","date":"2011-12-23T22:31:49.047Z","type":"message"}
{"nick":"mjr_","message":"We seem to be hitting this in both our riak clusters and our node code.","date":"2011-12-23T22:32:24.161Z","type":"message"}
{"nick":"pquerna","message":"mjr_: well, back then, with tcp it would make the linux kernel do dumb stuff, like backoff and have a hard coded 200ms backoff, just switching to udp elminated that, but yes, if you start overloading switch ports, boo humbug","date":"2011-12-23T22:32:39.138Z","type":"message"}
{"nick":"mjr_","message":"Our replica count is only 3, but somehow we get into these nasty burst/loss cycles.","date":"2011-12-23T22:32:46.655Z","type":"message"}
{"nick":"mjr_","message":"Average bitrate is 500mbits or so, but there are 10ms bursts of over 1000, all the time.","date":"2011-12-23T22:33:34.077Z","type":"message"}
{"nick":"pquerna","message":"right","date":"2011-12-23T22:33:42.134Z","type":"message"}
{"nick":"pquerna","message":"do you have managed switches in there?","date":"2011-12-23T22:34:36.167Z","type":"message"}
{"nick":"pquerna","message":"should be able to get stats out","date":"2011-12-23T22:34:43.321Z","type":"message"}
{"nick":"mjr_","message":"yeah, they claim tons of output discards","date":"2011-12-23T22:35:03.372Z","type":"message"}
{"nick":"mjr_","message":"sampling interface counters at 10Hz reveals the awful, bursty truth.","date":"2011-12-23T22:35:31.550Z","type":"message"}
{"nick":"pquerna","message":"hrm. Whats really causing that kind of burst though?","date":"2011-12-23T22:36:59.294Z","type":"message"}
{"nick":"pquerna","message":"is this to do with how you span out audio data to large groups?","date":"2011-12-23T22:37:21.072Z","type":"message"}
{"nick":"mjr_","message":"I think riak does it on its own, based on how we are using it, for some reason.","date":"2011-12-23T22:38:03.103Z","type":"message"}
{"nick":"pquerna","message":"i guess i don't gork why such high bursts would be a property of riak, but don't know riak internals that well","date":"2011-12-23T22:38:13.254Z","type":"message"}
{"nick":"mjr_","message":"But I also think our node clusters are doing it to themselves.","date":"2011-12-23T22:38:15.838Z","type":"message"}
{"nick":"pquerna","message":"unless you have a 'very' wide query","date":"2011-12-23T22:38:19.065Z","type":"message"}
{"nick":"mjr_","message":"We don't do any of the coverage query stuff, it's all straight kv.","date":"2011-12-23T22:38:56.387Z","type":"message"}
{"nick":"pquerna","message":"something that gets 1mb of data from every riak node ","date":"2011-12-23T22:39:04.274Z","type":"message"}
{"nick":"pquerna","message":"(or less, just asks every ndoe for something)","date":"2011-12-23T22:39:13.105Z","type":"message"}
{"nick":"pquerna","message":"hrm","date":"2011-12-23T22:39:16.150Z","type":"message"}
{"nick":"mjr_","message":"So any given node only ever asks 3 other nodes for the answer.  Those 3 probably do all answer at once.","date":"2011-12-23T22:39:38.805Z","type":"message"}
{"nick":"pquerna","message":"right, but thats really not that much data","date":"2011-12-23T22:39:51.404Z","type":"message"}
{"nick":"pquerna","message":"should be just fine unless the switch is otherwise crappy","date":"2011-12-23T22:40:03.674Z","type":"message"}
{"nick":"mjr_","message":"Yeah, I know.  Hence the mystery.","date":"2011-12-23T22:40:04.597Z","type":"message"}
{"nick":"mjr_","message":"It's a bunch of Cisco 3750's.  Legend has it that these are the most susceptible to this incast thing.","date":"2011-12-23T22:40:46.937Z","type":"message"}
{"nick":"pquerna","message":"span ports? then maybe you can at least see whats bursting ","date":"2011-12-23T22:41:11.433Z","type":"message"}
{"nick":"pquerna","message":"even regular tcp dump, should be able to see some 'smaller' bursts and maybe isolate it","date":"2011-12-23T22:41:47.404Z","type":"message"}
{"nick":"mjr_","message":"It's kind of impossible to monitor because the backup is happening inside the switch on the way to the output port, so spanning would just cause another backup.","date":"2011-12-23T22:41:48.814Z","type":"message"}
{"nick":"mjr_","message":"I don't yet know how to make tcpdump take 500 mbits of traffic for a second and pick out the bursts.","date":"2011-12-23T22:42:41.762Z","type":"message"}
{"nick":"pquerna","message":"true :-/","date":"2011-12-23T22:43:04.875Z","type":"message"}
{"nick":"mjr_","message":"Anyway, interesting problems for sure.","date":"2011-12-23T22:43:11.336Z","type":"message"}
{"nick":"pquerna","message":"wireshark has some graphing tools built into it","date":"2011-12-23T22:43:12.884Z","type":"message"}
{"nick":"pquerna","message":"so you can graph the throughput","date":"2011-12-23T22:43:20.494Z","type":"message"}
{"nick":"mjr_","message":"I really just want bigger output buffers, but these switches have relatively small ones.","date":"2011-12-23T22:44:26.129Z","type":"message"}
{"nick":"mjr_","message":"I also want ryan to fix my segfaults.  :)","date":"2011-12-23T22:44:54.799Z","type":"message"}
{"nick":"mraleph","reason":"Quit: Leaving.","date":"2011-12-23T22:46:16.638Z","type":"quit"}
{"nick":"pquerna","message":"https://github.com/vrv/linux-microsecondrto","date":"2011-12-23T22:46:24.454Z","type":"message"}
{"nick":"pquerna","message":"ah nice","date":"2011-12-23T22:47:18.522Z","type":"message"}
{"nick":"pquerna","message":"they added a tunable for the tro","date":"2011-12-23T22:47:22.759Z","type":"message"}
{"nick":"pquerna","message":"rto","date":"2011-12-23T22:47:24.164Z","type":"message"}
{"nick":"pquerna","message":"yeahaaa","date":"2011-12-23T22:47:38.193Z","type":"message"}
{"nick":"mjr_","message":"That looks cool, at least if there's no way to avoid it, you can more effectively cope with it.","date":"2011-12-23T22:48:06.777Z","type":"message"}
{"nick":"pquerna","message":"makes sense though, 200ms just doesn't make sense in a X cluster of 100 machines on LAN :)","date":"2011-12-23T22:48:45.381Z","type":"message"}
{"nick":"mjr_","message":"Yeah, which normally have rtt of less than 1ms","date":"2011-12-23T22:50:19.141Z","type":"message"}
{"nick":"pquerna","message":"mjr_: simple hack maybe, depending on what ports are overloading","date":"2011-12-23T22:53:19.114Z","type":"message"}
{"nick":"pquerna","message":"mjr_: plug in another port, split your client traffic over both","date":"2011-12-23T22:53:32.044Z","type":"message"}
{"nick":"mjr_","message":"Yeah, that's what we are doing actually.","date":"2011-12-23T22:53:44.115Z","type":"message"}
{"nick":"mjr_","message":"Dumb way to double the receive port buffers","date":"2011-12-23T22:53:54.608Z","type":"message"}
{"nick":"mjr_","message":"Just painful to add another NIC to every machine, and for some reason these machines won't do 10GB.","date":"2011-12-23T22:54:32.427Z","type":"message"}
{"nick":"pquerna","message":"another physical card? that sucks","date":"2011-12-23T22:55:29.973Z","type":"message"}
{"nick":"pquerna","message":"most our machines got 4 em in now days :-/","date":"2011-12-23T22:55:39.457Z","type":"message"}
{"nick":"mjr_","message":"10Gb is the real solution to this problem, but our Ubuntu-supplied kernels are unhappy with it.","date":"2011-12-23T22:58:24.889Z","type":"message"}
{"nick":"CIA-111","message":"\u0002node:\u000f \u000303Ryan Dahl\u000f \u000307isolates2\u000f * r\u00021a3b283\u000f \u000310\u000f/ (6 files in 3 dirs)\u0002:\u000f move isolate V8 functions out of node.cc - http://git.io/fGzaEw","date":"2011-12-23T23:02:44.323Z","type":"message"}
{"nick":"CIA-111","message":"\u0002node:\u000f \u000303Ryan Dahl\u000f \u000307master\u000f * r\u0002624f70e\u000f \u000310\u000f/ (.gitignore Makefile configure tools/gyp_node)\u0002:\u000f ","date":"2011-12-23T23:02:44.855Z","type":"message"}
{"nick":"CIA-111","message":"\u0002node:\u000f GYP: rename options.gypi to config.gypi","date":"2011-12-23T23:02:45.078Z","type":"message"}
{"nick":"CIA-111","message":"\u0002node:\u000f Sounds more familiar to unix users used to config.h - http://git.io/eLlIzA","date":"2011-12-23T23:02:45.078Z","type":"message"}
{"nick":"ryah","message":"pquerna: probably not - but let me get it for you...","date":"2011-12-23T23:02:58.448Z","type":"message"}
{"nick":"pquerna","message":"really wish delayed acks and rto could be set by-subnets","date":"2011-12-23T23:04:07.565Z","type":"message"}
{"nick":"ryah","message":"mjr_: did the frequency of segfaults decrease?","date":"2011-12-23T23:04:27.728Z","type":"message"}
{"nick":"ryah","message":"piscisaureus_: srry - everyone is on vacation so i didn't go online this morning","date":"2011-12-23T23:04:54.772Z","type":"message"}
{"nick":"pietern","date":"2011-12-23T23:06:06.554Z","type":"join"}
{"nick":"mjr_","message":"ryah: I think so, but there are still quite a lot of them.","date":"2011-12-23T23:07:42.057Z","type":"message"}
{"nick":"ryah","message":"pquerna: https://gist.github.com/454b33101532a2e43340","date":"2011-12-23T23:07:52.408Z","type":"message"}
{"nick":"mjr_","message":"Perhaps they come in bursts, the timestamps seem to support this.","date":"2011-12-23T23:07:53.580Z","type":"message"}
{"nick":"pquerna","message":"ryah: thanks","date":"2011-12-23T23:08:07.400Z","type":"message"}
{"nick":"ryah","message":"mjr_: damn. i thought we nailed that bug :///","date":"2011-12-23T23:08:48.766Z","type":"message"}
{"nick":"mjr_","message":"Yeah, I guess not.","date":"2011-12-23T23:09:01.559Z","type":"message"}
{"nick":"mjr_","message":"It was clean on that one server for a day.","date":"2011-12-23T23:09:14.876Z","type":"message"}
{"nick":"mjr_","message":"Aside from moving this all to Joyent, which can't happen until your guys deliver the machines, is there a better way to see what's going on here?","date":"2011-12-23T23:09:54.424Z","type":"message"}
{"nick":"CIA-111","message":"\u0002node:\u000f \u000303Ryan Dahl\u000f \u000307v0.6\u000f * r\u0002d85c85a\u000f \u000310\u000f/ doc/api/addons.markdown \u0002:\u000f Change 'real example' in addon doc - http://git.io/I9j8GQ","date":"2011-12-23T23:11:08.901Z","type":"message"}
{"nick":"ryah","message":"what is the freq of crashes?","date":"2011-12-23T23:12:08.084Z","type":"message"}
{"nick":"mjr_","message":"I'll get the full list of timestamps","date":"2011-12-23T23:12:20.123Z","type":"message"}
{"nick":"mjr_","message":"https://gist.github.com/7a371382bc8ed825f89c","date":"2011-12-23T23:13:57.300Z","type":"message"}
{"nick":"travis-ci","date":"2011-12-23T23:14:15.838Z","type":"join"}
{"nick":"travis-ci","message":"[travis-ci] joyent/node#139 (isolates2 - 1a3b283 : Ryan Dahl): The build is still failing.","date":"2011-12-23T23:14:16.064Z","type":"message"}
{"nick":"travis-ci","message":"[travis-ci] Change view : https://github.com/joyent/node/compare/2ac02f4...1a3b283","date":"2011-12-23T23:14:16.064Z","type":"message"}
{"nick":"travis-ci","message":"[travis-ci] Build details : http://travis-ci.org/joyent/node/builds/442139","date":"2011-12-23T23:14:16.064Z","type":"message"}
{"nick":"travis-ci","date":"2011-12-23T23:14:16.064Z","type":"part"}
{"nick":"mjr_","message":"Is there some obvious unix way to sort those, or do I have to employ elaborate awk/perl magic?","date":"2011-12-23T23:14:39.593Z","type":"message"}
{"nick":"travis-ci","date":"2011-12-23T23:15:12.067Z","type":"join"}
{"nick":"travis-ci","message":"[travis-ci] joyent/node#140 (master - 624f70e : Ryan Dahl): The build is still failing.","date":"2011-12-23T23:15:12.295Z","type":"message"}
{"nick":"travis-ci","message":"[travis-ci] Change view : https://github.com/joyent/node/compare/6ac22bf...624f70e","date":"2011-12-23T23:15:12.295Z","type":"message"}
{"nick":"travis-ci","message":"[travis-ci] Build details : http://travis-ci.org/joyent/node/builds/442141","date":"2011-12-23T23:15:12.295Z","type":"message"}
{"nick":"travis-ci","date":"2011-12-23T23:15:12.295Z","type":"part"}
{"nick":"pquerna","message":"ryah: cool with making it a little npm package (crediting joyent of course)?","date":"2011-12-23T23:16:59.393Z","type":"message"}
{"nick":"travis-ci","date":"2011-12-23T23:18:59.634Z","type":"join"}
{"nick":"travis-ci","message":"[travis-ci] joyent/node#141 (v0.6 - d85c85a : Ryan Dahl): The build passed.","date":"2011-12-23T23:18:59.860Z","type":"message"}
{"nick":"travis-ci","message":"[travis-ci] Change view : https://github.com/joyent/node/compare/c6347dc...d85c85a","date":"2011-12-23T23:18:59.861Z","type":"message"}
{"nick":"travis-ci","message":"[travis-ci] Build details : http://travis-ci.org/joyent/node/builds/442174","date":"2011-12-23T23:18:59.861Z","type":"message"}
{"nick":"travis-ci","date":"2011-12-23T23:18:59.861Z","type":"part"}
{"nick":"ryah","message":"mjr_: sort -n --key=7 cores.txt ","date":"2011-12-23T23:19:54.208Z","type":"message"}
{"nick":"ryah","message":"pquerna: sure","date":"2011-12-23T23:19:57.658Z","type":"message"}
{"nick":"ryah","message":"mjr_: oops i guess no -n","date":"2011-12-23T23:20:31.391Z","type":"message"}
{"nick":"mjr_","message":"also, it spans days","date":"2011-12-23T23:20:45.036Z","type":"message"}
{"nick":"mjr_","message":"That's the tricky part.","date":"2011-12-23T23:21:00.135Z","type":"message"}
{"nick":"ryah","message":"sort --key=6,7 cores.txt","date":"2011-12-23T23:21:13.768Z","type":"message"}
{"nick":"piscisaureus_","reason":"Ping timeout: 240 seconds","date":"2011-12-23T23:21:14.793Z","type":"quit"}
{"nick":"mjr_","message":"oh shit, I didn't know you could do two keys like that.","date":"2011-12-23T23:21:35.843Z","type":"message"}
{"nick":"mjr_","message":"well, I'm glad I asked.","date":"2011-12-23T23:21:47.896Z","type":"message"}
{"nick":"ryah","message":"me neither :)","date":"2011-12-23T23:21:56.648Z","type":"message"}
{"nick":"mjr_","message":"https://gist.github.com/815d097ba175bccfedf0","date":"2011-12-23T23:22:03.136Z","type":"message"}
{"nick":"mjr_","message":"looks like it roughly follows the traffic pattern","date":"2011-12-23T23:22:36.356Z","type":"message"}
{"nick":"ryah","message":"this is one box?","date":"2011-12-23T23:22:51.524Z","type":"message"}
{"nick":"mjr_","message":"No, this is the entire cluster.","date":"2011-12-23T23:23:02.934Z","type":"message"}
{"nick":"ryah","message":"k","date":"2011-12-23T23:23:29.188Z","type":"message"}
{"nick":"ryah","message":"just to check - all the machines are upgrade to v0.6 HEAD ?","date":"2011-12-23T23:23:56.704Z","type":"message"}
{"nick":"mjr_","message":"Not sure if this helps or not, and I hate to even mention it, but we are corrupting data somewhere.  Getting reports of mangled JPEG files and JSON with bits of previous messages interspersed.","date":"2011-12-23T23:24:24.270Z","type":"message"}
{"nick":"mjr_","message":"Could be our fault somehow, like we are mangling it between the client and server, actually uploading corrupted data.","date":"2011-12-23T23:24:52.741Z","type":"message"}
{"nick":"mjr_","message":"Yes, all machines are v0.6 branch as of right after you landed that patch.","date":"2011-12-23T23:25:10.662Z","type":"message"}
{"nick":"ryah","message":"it might be worthwhile to load efence into one of these processes?","date":"2011-12-23T23:25:17.700Z","type":"message"}
{"nick":"ryah","message":"i think i have code for that in wscript... one sec.","date":"2011-12-23T23:25:50.986Z","type":"message"}
{"nick":"ryah","message":"or maybe you can do it with LD_PRELOAD or whatever","date":"2011-12-23T23:26:03.580Z","type":"message"}
{"nick":"ryah","message":"yeah- i think you should be able to do LD_PRELOAD - you know efence?","date":"2011-12-23T23:26:30.124Z","type":"message"}
{"nick":"ryah","message":"it's like a ghetto version of valgrind","date":"2011-12-23T23:26:45.462Z","type":"message"}
{"nick":"mjr_","message":"I don't.  Does it have a significant performance impact?","date":"2011-12-23T23:26:50.615Z","type":"message"}
{"nick":"ryah","message":"but i think it runs closer to roduction speed","date":"2011-12-23T23:26:58.800Z","type":"message"}
{"nick":"ryah","message":"guessing - completely off the top of my head - maybe 20% hit","date":"2011-12-23T23:27:18.093Z","type":"message"}
{"nick":"ryah","message":"i haven't used it for over a year though so im not sure.","date":"2011-12-23T23:27:30.976Z","type":"message"}
{"nick":"indexzero","reason":"Quit: indexzero","date":"2011-12-23T23:27:36.886Z","type":"quit"}
{"nick":"ryah","message":"that will let us know if we're hitting any uninitialized memory","date":"2011-12-23T23:27:44.727Z","type":"message"}
{"nick":"ryah","message":"you should have it in apt-get","date":"2011-12-23T23:28:14.363Z","type":"message"}
{"nick":"mjr_","message":"OK, I'll try it on your user's router process.  :)","date":"2011-12-23T23:29:35.185Z","type":"message"}
{"nick":"ryah","message":":)","date":"2011-12-23T23:29:47.959Z","type":"message"}
{"nick":"ryah","message":"meanwhile i'm going to poke around in the parser code again","date":"2011-12-23T23:30:46.716Z","type":"message"}
{"nick":"ryah","message":"i really hate these fucking C features to tell functions to inline","date":"2011-12-23T23:33:10.602Z","type":"message"}
{"nick":"ryah","message":"the VM should be deciding that not me","date":"2011-12-23T23:33:28.535Z","type":"message"}
{"nick":"mjr_","message":"yes, in this post-llvm world that is more reasonable.","date":"2011-12-23T23:34:02.010Z","type":"message"}
{"nick":"ryah","message":"mjr_: i have a patch for you to try - i had some handlescopes in the wrong places","date":"2011-12-23T23:34:38.620Z","type":"message"}
{"nick":"mjr_","message":"heh, sure","date":"2011-12-23T23:34:47.579Z","type":"message"}
{"nick":"mjr_","message":"want me to try both that and efence, or one at a time?","date":"2011-12-23T23:34:58.264Z","type":"message"}
{"nick":"ryah","message":"mjr_: https://gist.github.com/52e8075223f7e36c00c5","date":"2011-12-23T23:34:59.083Z","type":"message"}
{"nick":"ryah","message":"mjr_: one at a time please","date":"2011-12-23T23:35:06.956Z","type":"message"}
{"nick":"mjr_","message":"patch first?","date":"2011-12-23T23:35:11.896Z","type":"message"}
{"nick":"ryah","message":"in parallel if you're down for it","date":"2011-12-23T23:35:22.912Z","type":"message"}
{"nick":"ryah","message":"(on differnt processes)","date":"2011-12-23T23:35:53.311Z","type":"message"}
{"nick":"ryah","message":"im also removing always_inline","date":"2011-12-23T23:36:09.535Z","type":"message"}
{"nick":"ryah","message":"which i dont trust","date":"2011-12-23T23:36:14.215Z","type":"message"}
{"nick":"ryah","message":"and i doubt is actually measurable","date":"2011-12-23T23:36:25.342Z","type":"message"}
{"nick":"mjr_","message":"Sorry, got distracted by splunk.  Have you seen this thing?  Pretty great.","date":"2011-12-23T23:53:15.542Z","type":"message"}
{"nick":"ryah","message":"the head of ops in the office next to me keeps telling me how great it is","date":"2011-12-23T23:56:25.843Z","type":"message"}
{"nick":"ryah","message":"havent used it","date":"2011-12-23T23:56:28.012Z","type":"message"}
{"nick":"mjr_","message":"So we generate 1TB of log data every day, and this thing indexes the shit out of it.","date":"2011-12-23T23:57:46.050Z","type":"message"}
{"nick":"mjr_","message":"grep became laughably slow","date":"2011-12-23T23:58:15.286Z","type":"message"}
