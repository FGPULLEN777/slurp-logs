{"nick":"ircretary","reason":"Remote host closed the connection","date":"2015-07-07T00:00:01.856Z","type":"quit"}
{"nick":"jasnell_","reason":"Remote host closed the connection","date":"2015-07-07T00:00:06.553Z","type":"quit"}
{"nick":"ircretary","date":"2015-07-07T00:00:11.660Z","type":"join"}
{"nick":"jasnell_","date":"2015-07-07T00:04:16.079Z","type":"join"}
{"nick":"Fishrock123","date":"2015-07-07T00:09:10.176Z","type":"join"}
{"nick":"ijroth","date":"2015-07-07T00:17:40.188Z","type":"join"}
{"nick":"ijroth","reason":"Client Quit","date":"2015-07-07T00:18:50.112Z","type":"quit"}
{"nick":"s3shs","date":"2015-07-07T00:25:30.975Z","type":"join"}
{"nick":"alexforster","date":"2015-07-07T00:27:01.448Z","type":"join"}
{"nick":"a3f","reason":"Quit: Zzzzz..","date":"2015-07-07T00:28:11.588Z","type":"quit"}
{"nick":"avalanche123","reason":"Remote host closed the connection","date":"2015-07-07T00:29:00.101Z","type":"quit"}
{"nick":"alexforster","reason":"Client Quit","date":"2015-07-07T00:31:50.738Z","type":"quit"}
{"nick":"jasnell_","reason":"Remote host closed the connection","date":"2015-07-07T00:32:24.246Z","type":"quit"}
{"nick":"Wraithan","date":"2015-07-07T00:37:53.099Z","type":"join"}
{"nick":"Wraithan","reason":"\"WeeChat 0.4.2\"","date":"2015-07-07T00:37:57.022Z","type":"part"}
{"nick":"brson","reason":"Quit: leaving","date":"2015-07-07T00:45:16.698Z","type":"quit"}
{"nick":"dap_","reason":"Quit: Leaving.","date":"2015-07-07T01:06:48.488Z","type":"quit"}
{"nick":"jgi","reason":"Quit: jgi","date":"2015-07-07T01:13:13.534Z","type":"quit"}
{"nick":"avalanche123","date":"2015-07-07T01:17:27.724Z","type":"join"}
{"nick":"avalanche123","reason":"Ping timeout: 246 seconds","date":"2015-07-07T01:21:56.568Z","type":"quit"}
{"nick":"jgi","date":"2015-07-07T01:51:48.449Z","type":"join"}
{"nick":"abraxas_","date":"2015-07-07T01:57:34.087Z","type":"join"}
{"nick":"toothrot","reason":"Ping timeout: 252 seconds","date":"2015-07-07T02:08:08.909Z","type":"quit"}
{"nick":"jgi","reason":"Quit: jgi","date":"2015-07-07T02:16:44.843Z","type":"quit"}
{"nick":"jasnell","date":"2015-07-07T02:27:17.263Z","type":"join"}
{"nick":"jasnell","reason":"Remote host closed the connection","date":"2015-07-07T02:40:05.053Z","type":"quit"}
{"nick":"jasnell","date":"2015-07-07T02:40:46.184Z","type":"join"}
{"nick":"jasnell","reason":"Ping timeout: 248 seconds","date":"2015-07-07T02:45:03.186Z","type":"quit"}
{"nick":"avalanche123","date":"2015-07-07T02:50:32.184Z","type":"join"}
{"nick":"avalanche123","reason":"Remote host closed the connection","date":"2015-07-07T03:00:00.416Z","type":"quit"}
{"nick":"toothrot","date":"2015-07-07T03:15:40.282Z","type":"join"}
{"nick":"jasnell","date":"2015-07-07T03:28:29.297Z","type":"join"}
{"nick":"jgi","date":"2015-07-07T03:31:54.332Z","type":"join"}
{"nick":"jgi","reason":"Client Quit","date":"2015-07-07T03:32:32.475Z","type":"quit"}
{"nick":"jgi","date":"2015-07-07T03:42:42.969Z","type":"join"}
{"nick":"inolen","reason":"Ping timeout: 252 seconds","date":"2015-07-07T03:57:46.874Z","type":"quit"}
{"nick":"rmg","reason":"Remote host closed the connection","date":"2015-07-07T04:02:12.324Z","type":"quit"}
{"nick":"jgi","reason":"Quit: jgi","date":"2015-07-07T04:06:28.365Z","type":"quit"}
{"nick":"inolen","date":"2015-07-07T04:45:47.409Z","type":"join"}
{"nick":"jgi","date":"2015-07-07T04:48:51.588Z","type":"join"}
{"nick":"Alcest","reason":"Ping timeout: 276 seconds","date":"2015-07-07T05:07:25.703Z","type":"quit"}
{"nick":"Fishrock123","reason":"Remote host closed the connection","date":"2015-07-07T05:18:34.393Z","type":"quit"}
{"nick":"jasnell","reason":"Remote host closed the connection","date":"2015-07-07T05:28:33.284Z","type":"quit"}
{"nick":"Fishrock123","date":"2015-07-07T05:28:58.127Z","type":"join"}
{"nick":"seishun","date":"2015-07-07T05:29:11.083Z","type":"join"}
{"nick":"jgi","reason":"Quit: jgi","date":"2015-07-07T05:29:44.745Z","type":"quit"}
{"nick":"jgi","date":"2015-07-07T05:31:50.396Z","type":"join"}
{"nick":"jgi","reason":"Client Quit","date":"2015-07-07T05:35:06.945Z","type":"quit"}
{"nick":"Fishrock123","reason":"Ping timeout: 244 seconds","date":"2015-07-07T05:43:49.087Z","type":"quit"}
{"nick":"Jacob8432","date":"2015-07-07T05:46:00.567Z","type":"join"}
{"nick":"Jacob843","reason":"Ping timeout: 248 seconds","date":"2015-07-07T05:48:31.208Z","type":"quit"}
{"nick":"avalanche123","date":"2015-07-07T05:52:14.573Z","type":"join"}
{"nick":"avalanche123","reason":"Remote host closed the connection","date":"2015-07-07T05:53:18.103Z","type":"quit"}
{"nick":"a3f","date":"2015-07-07T05:54:33.471Z","type":"join"}
{"nick":"inolen","reason":"Ping timeout: 264 seconds","date":"2015-07-07T06:15:25.425Z","type":"quit"}
{"nick":"Fishrock123","date":"2015-07-07T06:22:49.090Z","type":"join"}
{"nick":"Fishrock123","reason":"Remote host closed the connection","date":"2015-07-07T06:22:58.606Z","type":"quit"}
{"nick":"seishun","reason":"Ping timeout: 276 seconds","date":"2015-07-07T06:38:25.715Z","type":"quit"}
{"nick":"warehouse13","date":"2015-07-07T06:41:56.323Z","type":"join"}
{"nick":"Left_Turn","reason":"Ping timeout: 252 seconds","date":"2015-07-07T06:44:37.021Z","type":"quit"}
{"nick":"s3shs","reason":"Remote host closed the connection","date":"2015-07-07T06:51:02.483Z","type":"quit"}
{"nick":"s3shs","date":"2015-07-07T06:52:17.630Z","type":"join"}
{"nick":"inolen","date":"2015-07-07T06:52:56.007Z","type":"join"}
{"nick":"Ralith","reason":"Ping timeout: 256 seconds","date":"2015-07-07T06:59:29.284Z","type":"quit"}
{"nick":"Ralith","date":"2015-07-07T07:01:08.889Z","type":"join"}
{"nick":"SergeiRND","date":"2015-07-07T07:18:34.959Z","type":"join"}
{"nick":"s3shs_","date":"2015-07-07T07:19:21.295Z","type":"join"}
{"nick":"s3shs","reason":"Ping timeout: 256 seconds","date":"2015-07-07T07:23:08.336Z","type":"quit"}
{"nick":"toothrot","reason":"Ping timeout: 246 seconds","date":"2015-07-07T07:30:53.968Z","type":"quit"}
{"nick":"a3f","reason":"Quit: Zzzzz..","date":"2015-07-07T07:55:48.158Z","type":"quit"}
{"nick":"a3f","date":"2015-07-07T07:58:59.093Z","type":"join"}
{"nick":"a3f","reason":"Client Quit","date":"2015-07-07T07:58:59.977Z","type":"quit"}
{"nick":"tunniclm__","date":"2015-07-07T08:00:11.622Z","type":"join"}
{"nick":"AlexisMocha","reason":"Ping timeout: 256 seconds","date":"2015-07-07T08:09:02.287Z","type":"quit"}
{"nick":"SergeiRND","reason":"Quit: Leaving.","date":"2015-07-07T08:17:19.337Z","type":"quit"}
{"nick":"AlexisMocha","date":"2015-07-07T08:18:30.808Z","type":"join"}
{"nick":"jasnell","date":"2015-07-07T08:29:14.293Z","type":"join"}
{"nick":"jasnell","reason":"Ping timeout: 255 seconds","date":"2015-07-07T08:33:34.298Z","type":"quit"}
{"nick":"SergeiRND","date":"2015-07-07T08:35:28.964Z","type":"join"}
{"nick":"SergeiRND","reason":"Ping timeout: 246 seconds","date":"2015-07-07T08:39:50.952Z","type":"quit"}
{"nick":"Alcest","date":"2015-07-07T08:47:02.687Z","type":"join"}
{"nick":"saghul","date":"2015-07-07T08:48:51.547Z","type":"join"}
{"nick":"SergeiRND","date":"2015-07-07T09:23:08.984Z","type":"join"}
{"nick":"rendar","date":"2015-07-07T09:46:11.272Z","type":"join"}
{"nick":"rmg","date":"2015-07-07T10:33:00.678Z","type":"join"}
{"nick":"s3shs_","reason":"Ping timeout: 246 seconds","date":"2015-07-07T10:36:41.499Z","type":"quit"}
{"nick":"rmg","reason":"Ping timeout: 244 seconds","date":"2015-07-07T10:37:17.088Z","type":"quit"}
{"nick":"chris_99","date":"2015-07-07T10:47:43.843Z","type":"join"}
{"nick":"SergeiRND","reason":"Quit: Leaving.","date":"2015-07-07T11:00:09.026Z","type":"quit"}
{"nick":"tobias-swedev","date":"2015-07-07T11:05:54.795Z","type":"join"}
{"nick":"tobias-swedev","date":"2015-07-07T11:17:55.454Z","type":"quit"}
{"nick":"abraxas_","reason":"Remote host closed the connection","date":"2015-07-07T11:18:16.745Z","type":"quit"}
{"nick":"SergeiRND","date":"2015-07-07T11:38:27.901Z","type":"join"}
{"nick":"abraxas_","date":"2015-07-07T13:07:23.700Z","type":"join"}
{"nick":"abraxas_","reason":"Ping timeout: 264 seconds","date":"2015-07-07T13:11:49.420Z","type":"quit"}
{"nick":"tunniclm_","date":"2015-07-07T13:18:21.929Z","type":"join"}
{"nick":"tunniclm__","reason":"Ping timeout: 264 seconds","date":"2015-07-07T13:20:49.945Z","type":"quit"}
{"nick":"chris_99","reason":"Remote host closed the connection","date":"2015-07-07T13:28:31.070Z","type":"quit"}
{"nick":"alexforster","date":"2015-07-07T13:42:10.352Z","type":"join"}
{"nick":"lance|afk","new_nick":"lanceball","date":"2015-07-07T13:50:46.459Z","type":"nick"}
{"nick":"alexforster","reason":"Ping timeout: 250 seconds","date":"2015-07-07T14:00:35.489Z","type":"quit"}
{"nick":"kevinswiber","date":"2015-07-07T14:03:20.066Z","type":"join"}
{"nick":"kevinswiber","reason":"Remote host closed the connection","date":"2015-07-07T14:15:25.058Z","type":"quit"}
{"nick":"kevinswiber","date":"2015-07-07T14:22:37.121Z","type":"join"}
{"nick":"normanm","reason":"Ping timeout: 252 seconds","date":"2015-07-07T14:28:26.910Z","type":"quit"}
{"nick":"normanm","date":"2015-07-07T14:29:22.417Z","type":"join"}
{"nick":"kkaefer","date":"2015-07-07T14:38:31.451Z","type":"join"}
{"nick":"kkaefer","message":"hey","date":"2015-07-07T14:38:35.494Z","type":"message"}
{"nick":"kkaefer","message":"I have the following code: thread A runs a uv_loop(). A uv_async handle is constructed in that thread, the handle's callback function immediately closes the uv_async handle by calling uv_close, and then deletes the handle in the callback","date":"2015-07-07T14:40:32.535Z","type":"message"}
{"nick":"kkaefer","message":"thread B calls uv_async_send() on that handle once","date":"2015-07-07T14:40:45.370Z","type":"message"}
{"nick":"kkaefer","message":"I'm seeing occasional failures when calling uv_async_send()","date":"2015-07-07T14:41:03.941Z","type":"message"}
{"nick":"kkaefer","message":"with libuv 0.10.38","date":"2015-07-07T14:41:12.298Z","type":"message"}
{"nick":"kkaefer","message":"err","date":"2015-07-07T14:41:14.406Z","type":"message"}
{"nick":"kkaefer","message":"0.10.36","date":"2015-07-07T14:41:16.596Z","type":"message"}
{"nick":"kkaefer","message":"the abort() function in uv__async_send() gets triggered","date":"2015-07-07T14:41:36.980Z","type":"message"}
{"nick":"lanceball","reason":"Quit: Bye bye","date":"2015-07-07T14:41:56.059Z","type":"quit"}
{"nick":"kkaefer","message":"with errno being 9 (= EBADF)","date":"2015-07-07T14:42:28.729Z","type":"message"}
{"nick":"kkaefer","message":"am I doing something wrong?","date":"2015-07-07T14:42:48.383Z","type":"message"}
{"nick":"kkaefer","message":"can I immediately delete the uv_async handle in its callback?","date":"2015-07-07T14:42:59.322Z","type":"message"}
{"nick":"Jacob8432","reason":"Quit: Leaving","date":"2015-07-07T14:43:01.723Z","type":"quit"}
{"nick":"Jacob843","date":"2015-07-07T14:43:27.201Z","type":"join"}
{"nick":"Ralith","message":"kkaefer: in general, it is not safe to delete handles until their close callbacks have been invoked","date":"2015-07-07T14:59:15.829Z","type":"message"}
{"nick":"kkaefer","message":"Ralith: the handle is deleted in the close callback","date":"2015-07-07T15:00:16.387Z","type":"message"}
{"nick":"avalanche123","date":"2015-07-07T15:00:23.839Z","type":"join"}
{"nick":"Ralith","message":"that should be safe","date":"2015-07-07T15:01:24.511Z","type":"message"}
{"nick":"Ralith","message":"try building with addresssanitizer to look for UB","date":"2015-07-07T15:02:41.640Z","type":"message"}
{"nick":"SergeiRND","reason":"Quit: Leaving.","date":"2015-07-07T15:02:45.247Z","type":"quit"}
{"nick":"Ralith","message":"or just break on writes to the handle's memory in gdb","date":"2015-07-07T15:03:12.196Z","type":"message"}
{"nick":"seishun","date":"2015-07-07T15:14:36.651Z","type":"join"}
{"nick":"normanm","reason":"Changing host","date":"2015-07-07T15:16:26.215Z","type":"quit"}
{"nick":"normanm","date":"2015-07-07T15:16:26.309Z","type":"join"}
{"nick":"saghul","message":"kkaefer any chance you're calling uv_async_send on the dead handle?","date":"2015-07-07T15:16:50.620Z","type":"message"}
{"nick":"saghul","message":"(after uv_close-ing it, that is)","date":"2015-07-07T15:17:04.305Z","type":"message"}
{"nick":"kkaefer","message":"I don't think so, I think I'm getting the error *while* the uv_async_send is still in progress","date":"2015-07-07T15:17:47.190Z","type":"message"}
{"nick":"saghul","message":"kkaefer uv_async_send has no protection since it has to be thread-safe: https://github.com/libuv/libuv/blob/v1.x/src/unix/async.c#L60","date":"2015-07-07T15:19:46.293Z","type":"message"}
{"nick":"saghul","message":"so it's possible that if you call uv_close and after call uv_async_send you get an error","date":"2015-07-07T15:20:04.980Z","type":"message"}
{"nick":"saghul","message":"hum, wait  a sec","date":"2015-07-07T15:20:57.416Z","type":"message"}
{"nick":"saghul","message":"the loop is still alive, right?","date":"2015-07-07T15:21:19.077Z","type":"message"}
{"nick":"saghul","message":"on Unix, there is internally a single uv__async handle, so if that fd is closed the loop must have been closed, or someone closed the fd by mistake","date":"2015-07-07T15:22:12.453Z","type":"message"}
{"nick":"jasnell","date":"2015-07-07T15:24:57.354Z","type":"join"}
{"nick":"kkaefer","message":"yeah, the loop is still alive in the main thread","date":"2015-07-07T15:25:54.770Z","type":"message"}
{"nick":"kkaefer","message":"https://gist.github.com/kkaefer/0162e83f74a58417042d","date":"2015-07-07T15:25:55.893Z","type":"message"}
{"nick":"kkaefer","message":"could something like ^^ happen?","date":"2015-07-07T15:26:05.313Z","type":"message"}
{"nick":"kkaefer","message":"i.e. deleting the loop while uv_async_send() hasn't returned yet leads to a crash","date":"2015-07-07T15:26:21.414Z","type":"message"}
{"nick":"kkaefer","message":"@saghul the loop on the main thread stays running; the uv_async_t handle isn't related to the loop's internal handle","date":"2015-07-07T15:27:39.828Z","type":"message"}
{"nick":"saghul","message":"kkaefer I don't think so. uv_async_send does very little, and doesn't wait. It does access fields in the handle struct, so memory has to be valid though","date":"2015-07-07T15:29:05.591Z","type":"message"}
{"nick":"kkaefer","message":"yeah, I looked at the code","date":"2015-07-07T15:29:21.637Z","type":"message"}
{"nick":"kkaefer","message":"https://github.com/libuv/libuv/blob/v1.x/src/unix/async.c#L161","date":"2015-07-07T15:30:01.125Z","type":"message"}
{"nick":"kkaefer","message":"in my case, r = -1 and len = 1","date":"2015-07-07T15:30:27.300Z","type":"message"}
{"nick":"kkaefer","message":"(and errno 9)","date":"2015-07-07T15:30:37.906Z","type":"message"}
{"nick":"kkaefer","message":"and fd is some negative number, which is weird...","date":"2015-07-07T15:31:06.454Z","type":"message"}
{"nick":"saghul","message":"That fd is global per loop","date":"2015-07-07T15:31:09.130Z","type":"message"}
{"nick":"saghul","message":"and we only destroy it when the loop is closed: https://github.com/libuv/libuv/blob/60e515d9e6f3d86c0eedad583805201f32ea3aed/src/unix/loop.c#L90","date":"2015-07-07T15:32:12.227Z","type":"message"}
{"nick":"saghul","message":"kkaefer do you have a reduced test case I could try?","date":"2015-07-07T15:32:56.518Z","type":"message"}
{"nick":"kkaefer","message":"I'm going to debug a little further and will attempt to create one","date":"2015-07-07T15:33:19.637Z","type":"message"}
{"nick":"saghul","message":"kewl","date":"2015-07-07T15:33:30.005Z","type":"message"}
{"nick":"kkaefer","message":"hm, the main loop is still running","date":"2015-07-07T15:37:33.692Z","type":"message"}
{"nick":"avalanche123","reason":"Remote host closed the connection","date":"2015-07-07T15:50:02.023Z","type":"quit"}
{"nick":"davi","date":"2015-07-07T15:51:16.296Z","type":"join"}
{"nick":"avalanche123","date":"2015-07-07T15:54:22.328Z","type":"join"}
{"nick":"rmg","date":"2015-07-07T15:54:46.249Z","type":"join"}
{"nick":"Ralith","reason":"Ping timeout: 252 seconds","date":"2015-07-07T15:56:48.967Z","type":"quit"}
{"nick":"Fishrock123","date":"2015-07-07T15:58:27.285Z","type":"join"}
{"nick":"Ralith","date":"2015-07-07T15:58:36.093Z","type":"join"}
{"nick":"jgi","date":"2015-07-07T15:59:47.942Z","type":"join"}
