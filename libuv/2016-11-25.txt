{"nick":"grantila","reason":"Quit: Leaving.","date":"2016-11-25T00:35:15.954Z","type":"quit"}
{"nick":"tunniclm","reason":"Ping timeout: 250 seconds","date":"2016-11-25T00:36:36.919Z","type":"quit"}
{"nick":"grantila","date":"2016-11-25T01:46:31.059Z","type":"join"}
{"nick":"grantila","reason":"Ping timeout: 252 seconds","date":"2016-11-25T01:51:01.937Z","type":"quit"}
{"nick":"grantila","date":"2016-11-25T02:57:27.826Z","type":"join"}
{"nick":"grantila","reason":"Client Quit","date":"2016-11-25T02:57:31.606Z","type":"quit"}
{"nick":"grantila","date":"2016-11-25T04:08:49.988Z","type":"join"}
{"nick":"grantila","reason":"Ping timeout: 252 seconds","date":"2016-11-25T04:13:17.980Z","type":"quit"}
{"nick":"pspi","reason":"Quit: leaving","date":"2016-11-25T05:22:37.821Z","type":"quit"}
{"nick":"pspi","date":"2016-11-25T05:23:41.014Z","type":"join"}
{"nick":"italoacasas","reason":"Quit: Connection closed for inactivity","date":"2016-11-25T06:23:03.212Z","type":"quit"}
{"nick":"grantila","date":"2016-11-25T06:30:52.075Z","type":"join"}
{"nick":"grantila","reason":"Ping timeout: 246 seconds","date":"2016-11-25T06:35:12.050Z","type":"quit"}
{"nick":"txdv","message":"kellabyte: linking the lien with the assert on github would make it easier for people too look it up","date":"2016-11-25T06:47:54.593Z","type":"message"}
{"nick":"txdv","message":"kellabyte: it means, your server is on one loop and the client you want to accept is on another","date":"2016-11-25T06:49:01.889Z","type":"message"}
{"nick":"txdv","message":"this is not allowed... though should be possible in theory at least on linux","date":"2016-11-25T06:50:22.586Z","type":"message"}
{"nick":"kellabyte","message":"txdv: the weird thing is it doesn't always happen","date":"2016-11-25T06:50:33.956Z","type":"message"}
{"nick":"kellabyte","message":"so I have no idea how the assert could sometimes be false and sometimes true","date":"2016-11-25T06:50:46.021Z","type":"message"}
{"nick":"txdv","message":"the assert only triggers if the handles or not on the same loop","date":"2016-11-25T06:51:13.978Z","type":"message"}
{"nick":"txdv","message":"you have the listener handle and you are creating a client handle ","date":"2016-11-25T06:51:46.232Z","type":"message"}
{"nick":"txdv","message":"during creationg you have to use the same loop","date":"2016-11-25T06:51:52.374Z","type":"message"}
{"nick":"kellabyte","message":"yeah I'm just really confused why it'll work many times then suddenly stop working","date":"2016-11-25T06:53:25.110Z","type":"message"}
{"nick":"kellabyte","message":"the code isn't changing lol","date":"2016-11-25T06:53:28.746Z","type":"message"}
{"nick":"txdv","message":"you are creating the handle you want to accept onto on a differnt loop?","date":"2016-11-25T06:54:10.951Z","type":"message"}
{"nick":"txdv","message":"The memory that handle is using is corrupt?","date":"2016-11-25T06:54:20.855Z","type":"message"}
{"nick":"txdv","message":"or changed somewhere?","date":"2016-11-25T06:54:36.362Z","type":"message"}
{"nick":"txdv","message":"don't know, is your code open source?","date":"2016-11-25T06:54:52.928Z","type":"message"}
{"nick":"kellabyte","message":"yeah it is, I've been trying to avoid just dumping code on someone like this but I've been stuck for awhile, I tried a repro but couldn't once I stripped stuff out","date":"2016-11-25T06:55:36.714Z","type":"message"}
{"nick":"kellabyte","message":"this is the related code: https://github.com/haywire/haywire/blob/master/src/haywire/http_server.c#L246","date":"2016-11-25T06:56:57.003Z","type":"message"}
{"nick":"txdv","message":"are you calling uv_accept on a different thread?","date":"2016-11-25T06:58:12.774Z","type":"message"}
{"nick":"kellabyte","message":"I don't think so","date":"2016-11-25T07:01:18.563Z","type":"message"}
{"nick":"txdv","message":"you are createing a thread in that linked line","date":"2016-11-25T07:02:24.454Z","type":"message"}
{"nick":"kellabyte","message":"right but thats to create an ipc worker thread","date":"2016-11-25T07:03:39.676Z","type":"message"}
{"nick":"txdv","message":"luajit","date":"2016-11-25T07:05:15.299Z","type":"message"}
{"nick":"txdv","message":"in your webbrowser","date":"2016-11-25T07:05:18.769Z","type":"message"}
{"nick":"kellabyte","message":"this whole run around is just because I want to be able to load balance across multiple event loops, its always been a really complex piece of code for what I want it to do","date":"2016-11-25T07:05:22.533Z","type":"message"}
{"nick":"txdv","message":"yeah, libuv is single threaded ...","date":"2016-11-25T07:05:42.164Z","type":"message"}
{"nick":"txdv","message":"so you have to do all the logic with multi threading yourself","date":"2016-11-25T07:05:50.811Z","type":"message"}
{"nick":"kellabyte","message":"yeah but I wish I could just move a socket to another event loop","date":"2016-11-25T07:06:01.514Z","type":"message"}
{"nick":"kellabyte","message":"in an easier way","date":"2016-11-25T07:06:14.394Z","type":"message"}
{"nick":"kellabyte","message":"its a common thing I see a lot of libuv http servers doing in various languages, each does it with varying quality","date":"2016-11-25T07:06:52.386Z","type":"message"}
{"nick":"txdv","message":"well, you have to do it over ipc","date":"2016-11-25T07:07:34.309Z","type":"message"}
{"nick":"txdv","message":"you could just pass the fd?","date":"2016-11-25T07:08:05.715Z","type":"message"}
{"nick":"txdv","message":"what line of your code throws that assert?","date":"2016-11-25T07:09:48.549Z","type":"message"}
{"nick":"txdv","message":"also, can you reproduce it reliably?","date":"2016-11-25T07:09:58.858Z","type":"message"}
{"nick":"txdv","message":"your tcp listining code seems to be correct","date":"2016-11-25T07:10:14.958Z","type":"message"}
{"nick":"txdv","message":"kellabyte: the line you linked me to just creates the thread, i want to know which uv_accept in your code blows up","date":"2016-11-25T07:10:42.488Z","type":"message"}
{"nick":"kellabyte","message":"#5  0x000000000041074a in ipc_read_cb (handle=0x7ffff75e7de8,","date":"2016-11-25T07:12:00.281Z","type":"message"}
{"nick":"kellabyte","message":"    nread=<optimized out>, buf=<optimized out>)","date":"2016-11-25T07:12:00.373Z","type":"message"}
{"nick":"kellabyte","message":"    at /root/git/haywire/src/haywire/connection_consumer.c:36","date":"2016-11-25T07:12:00.373Z","type":"message"}
{"nick":"kellabyte","message":"thank you for the help by the way :)","date":"2016-11-25T07:12:21.300Z","type":"message"}
{"nick":"txdv","message":"i didnt help yet","date":"2016-11-25T07:12:43.847Z","type":"message"}
{"nick":"txdv","message":"im on master right now, the 36 line is uv_close((uv_handle_t*) &ctx->ipc_pipe, NULL);\\","date":"2016-11-25T07:13:29.438Z","type":"message"}
{"nick":"txdv","message":"seems like you are closing the ipc pipe the read callback","date":"2016-11-25T07:14:46.680Z","type":"message"}
{"nick":"txdv","message":"https://github.com/haywire/haywire/blob/master/src/haywire/connection_consumer.c#L36","date":"2016-11-25T07:16:11.897Z","type":"message"}
{"nick":"txdv","message":"why are you doing this?","date":"2016-11-25T07:16:14.490Z","type":"message"}
{"nick":"kellabyte","message":"hmm good question, I don't remember why that was there","date":"2016-11-25T07:16:57.261Z","type":"message"}
{"nick":"kellabyte","message":"ah right, I remember following this example which also does that: https://github.com/libuv/libuv/blob/v1.x/test/benchmark-multi-accept.c#L195","date":"2016-11-25T07:18:08.513Z","type":"message"}
{"nick":"txdv","message":"it seems like you have mixed up what is the server handle and what is the client handle in that part of code","date":"2016-11-25T07:18:11.065Z","type":"message"}
{"nick":"txdv","message":"literally the smae code","date":"2016-11-25T07:18:36.036Z","type":"message"}
{"nick":"txdv","message":"D","date":"2016-11-25T07:18:38.085Z","type":"message"}
{"nick":"txdv","message":";D","date":"2016-11-25T07:18:40.085Z","type":"message"}
{"nick":"kellabyte","message":"yeah haha","date":"2016-11-25T07:18:51.855Z","type":"message"}
{"nick":"kellabyte","message":"it was a couple years ago I followed the pattern :P","date":"2016-11-25T07:19:03.301Z","type":"message"}
{"nick":"kellabyte","message":"which handle did I mix up?","date":"2016-11-25T07:20:04.302Z","type":"message"}
{"nick":"txdv","message":"nevermind","date":"2016-11-25T07:20:30.090Z","type":"message"}
{"nick":"txdv","message":"https://github.com/haywire/haywire/blob/master/src/haywire/connection_consumer.c#L23","date":"2016-11-25T07:20:31.969Z","type":"message"}
{"nick":"txdv","message":"first fix you need to do","date":"2016-11-25T07:20:34.910Z","type":"message"}
{"nick":"txdv","message":"this line returns the number of stuff you want to accept","date":"2016-11-25T07:21:17.060Z","type":"message"}
{"nick":"txdv","message":"its not a procedure, it is a function","date":"2016-11-25T07:21:25.453Z","type":"message"}
{"nick":"kellabyte","message":"so it should be 1? I'm not sure what you're saying needs to be fixed","date":"2016-11-25T07:22:38.912Z","type":"message"}
{"nick":"txdv","message":"this function returns the number of handles queued in the pipe","date":"2016-11-25T07:23:54.542Z","type":"message"}
{"nick":"txdv","message":"i put 2 connections into the pipe, this one returns the number 2 ","date":"2016-11-25T07:24:20.547Z","type":"message"}
{"nick":"txdv","message":"in the benchmark it always just gets 1 returned, because this is the way the benchmark is coded","date":"2016-11-25T07:24:37.257Z","type":"message"}
{"nick":"kellabyte","message":"oh I see, so I may have to loop and accept multiple?","date":"2016-11-25T07:24:38.387Z","type":"message"}
{"nick":"txdv","message":"I think you should","date":"2016-11-25T07:25:00.398Z","type":"message"}
{"nick":"txdv","message":"if you have a test to trigger your assertion","date":"2016-11-25T07:28:49.470Z","type":"message"}
{"nick":"txdv","message":"please try to printf that number","date":"2016-11-25T07:28:54.911Z","type":"message"}
{"nick":"txdv","message":"if it is 1 all the time, this wont fix the problem if it is > 1 then this might fix the problem","date":"2016-11-25T07:29:07.993Z","type":"message"}
{"nick":"kellabyte","message":"okay let me try that now that I know what that returns","date":"2016-11-25T07:30:01.725Z","type":"message"}
{"nick":"kellabyte","message":"lets see if I can reproduce","date":"2016-11-25T07:30:07.923Z","type":"message"}
{"nick":"kellabyte","message":"hmm I got some 0's","date":"2016-11-25T07:31:23.590Z","type":"message"}
{"nick":"kellabyte","message":"no 1 or no >1","date":"2016-11-25T07:31:27.383Z","type":"message"}
{"nick":"txdv","message":"are you sure you are sending stuff at all?","date":"2016-11-25T07:35:12.268Z","type":"message"}
{"nick":"txdv","message":"you need to rethink that part of code","date":"2016-11-25T07:35:31.378Z","type":"message"}
{"nick":"txdv","message":"that close there is in the test because it expects only ONE connection ","date":"2016-11-25T07:35:45.734Z","type":"message"}
{"nick":"txdv","message":"literally, it gets one connection, then the test is done","date":"2016-11-25T07:35:52.995Z","type":"message"}
{"nick":"txdv","message":"it seems like you want to be able to accept more than one connection?","date":"2016-11-25T07:36:15.161Z","type":"message"}
{"nick":"kellabyte","message":"yeah I misunderstood what that was for I guess, but like how is this working most of the time then? haha","date":"2016-11-25T07:36:40.169Z","type":"message"}
{"nick":"kellabyte","message":"like I'm running this on osx right now and the pending = 1 4 times for 4 threads started","date":"2016-11-25T07:36:56.631Z","type":"message"}
{"nick":"kellabyte","message":"and it runs fine","date":"2016-11-25T07:36:59.986Z","type":"message"}
{"nick":"kellabyte","message":"but on another linux machine its 0's and assert is failing","date":"2016-11-25T07:37:11.968Z","type":"message"}
{"nick":"txdv","message":"you have a mac?","date":"2016-11-25T07:38:24.011Z","type":"message"}
{"nick":"kellabyte","message":"yeah I'm debugging this in xcode and also running on linux because the linux server is the one having the troubles","date":"2016-11-25T07:38:47.569Z","type":"message"}
{"nick":"kellabyte","message":"which parts of that function do I need to do N times besides the uv_accept()?","date":"2016-11-25T07:39:22.120Z","type":"message"}
{"nick":"txdv","message":"can you give me a testcase so i can run it myself?","date":"2016-11-25T07:40:49.774Z","type":"message"}
{"nick":"grantila","date":"2016-11-25T07:41:39.939Z","type":"join"}
{"nick":"grantila","reason":"Client Quit","date":"2016-11-25T07:41:40.761Z","type":"quit"}
{"nick":"txdv","message":"i cant even compile haywire on linux debian","date":"2016-11-25T07:41:52.616Z","type":"message"}
{"nick":"kellabyte","message":"whats it complaining about?","date":"2016-11-25T07:42:42.320Z","type":"message"}
{"nick":"jessicaquynh","date":"2016-11-25T07:42:47.536Z","type":"join"}
{"nick":"saghul","date":"2016-11-25T07:43:45.724Z","type":"join"}
{"nick":"kellabyte","message":"its compiling some memory allocators and benchmarking tools, if its failing on those we can just comment those out","date":"2016-11-25T07:44:06.192Z","type":"message"}
{"nick":"kellabyte","message":"in compile_dependencies.sh just delete everything but libuv","date":"2016-11-25T07:44:28.935Z","type":"message"}
{"nick":"kellabyte","message":"then ./make.sh","date":"2016-11-25T07:44:32.284Z","type":"message"}
{"nick":"kellabyte","message":"then to reproduce the error ./build/hello_world --threads 4","date":"2016-11-25T07:45:33.277Z","type":"message"}
{"nick":"kellabyte","message":"but yeah on this linux machine thats now having issues, pending = 0 for all 20 threads","date":"2016-11-25T07:46:24.568Z","type":"message"}
{"nick":"txdv","message":"you have a linux machines with 20 cores?","date":"2016-11-25T07:48:25.962Z","type":"message"}
{"nick":"kellabyte","message":"40 cores but 20 are real, other 20 are hyperthreaded","date":"2016-11-25T07:48:40.190Z","type":"message"}
{"nick":"txdv","message":"is that your personal server>/","date":"2016-11-25T07:49:03.377Z","type":"message"}
{"nick":"kellabyte","message":"I have control of it yeah, rackspace gave me 2 bare metal instances to benchmark with","date":"2016-11-25T07:49:50.224Z","type":"message"}
{"nick":"kellabyte","message":"even if I do --threads 4 it has the same issue, so its not about number of threads","date":"2016-11-25T07:50:18.317Z","type":"message"}
{"nick":"txdv","message":"http://paste.debian.net/898700","date":"2016-11-25T07:51:47.294Z","type":"message"}
{"nick":"txdv","message":"im using ./build.sh","date":"2016-11-25T07:52:16.743Z","type":"message"}
{"nick":"kellabyte","message":"oh no don't use that","date":"2016-11-25T07:52:46.926Z","type":"message"}
{"nick":"kellabyte","message":"sorry I need to deprecate that","date":"2016-11-25T07:52:50.935Z","type":"message"}
{"nick":"kellabyte","message":"use ./make.sh","date":"2016-11-25T07:52:53.176Z","type":"message"}
{"nick":"kellabyte","message":"I'm moving from gyp to cmake","date":"2016-11-25T07:53:00.915Z","type":"message"}
{"nick":"kellabyte","action":"checks to make sure the README says make.sh lol","date":"2016-11-25T07:53:33.995Z","type":"action"}
{"nick":"txdv","message":"i didnt read it","date":"2016-11-25T07:54:56.223Z","type":"message"}
{"nick":"txdv","message":";D","date":"2016-11-25T07:54:59.280Z","type":"message"}
{"nick":"txdv","message":"just saw build in the dir and immediately used tghat","date":"2016-11-25T07:55:06.823Z","type":"message"}
{"nick":"kellabyte","message":"haha yeah I should just delete it","date":"2016-11-25T07:55:18.236Z","type":"message"}
{"nick":"kellabyte","message":"actually should just do a makefile now that I've learned how","date":"2016-11-25T07:55:46.039Z","type":"message"}
{"nick":"txdv","message":"so i started it","date":"2016-11-25T07:56:30.490Z","type":"message"}
{"nick":"txdv","message":"is there some special configuration i need to do?","date":"2016-11-25T07:56:44.616Z","type":"message"}
{"nick":"txdv","message":"im doing ab -c 1000 -n 10000 right now and everything wroks","date":"2016-11-25T07:56:55.016Z","type":"message"}
{"nick":"kellabyte","message":"you did --thread <N>?","date":"2016-11-25T07:57:24.867Z","type":"message"}
{"nick":"kellabyte","message":"err --threads","date":"2016-11-25T07:57:29.227Z","type":"message"}
{"nick":"txdv","message":"yeah","date":"2016-11-25T07:57:55.409Z","type":"message"}
{"nick":"kellabyte","message":"yeah see now its working lol","date":"2016-11-25T07:58:07.052Z","type":"message"}
{"nick":"kellabyte","message":"what would cause the ipc_read_cb() to be called but the pending pipes is 0?","date":"2016-11-25T07:59:09.734Z","type":"message"}
