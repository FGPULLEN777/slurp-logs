{"nick":"joshthecoder","message":"So got a question about how V8 collects objects. Say I have this object graph: https://gist.github.com/0bcc06581e4c57039654","date":"2012-08-23T00:00:19.430Z","type":"message"}
{"nick":"joshthecoder","message":"Would object B be collectable by the GC at this point?","date":"2012-08-23T00:00:29.522Z","type":"message"}
{"nick":"joshthecoder","message":"I seem to be running into a case where B is getting collected on me.","date":"2012-08-23T00:00:48.923Z","type":"message"}
{"nick":"joshthecoder","message":"Well I guess the thing that puzzles me is if the weak callback will occur before the GC collects B.","date":"2012-08-23T00:01:28.095Z","type":"message"}
{"nick":"bnoordhuis_","message":"joshthecoder: if A is weak, A gets collected. B has nothing pointing to it so it gets collected as well","date":"2012-08-23T00:01:33.288Z","type":"message"}
{"nick":"joshthecoder","message":"bnoordhuis_: yeah that's what I figure. So I am confused why B seems to be getting lost.","date":"2012-08-23T00:02:02.623Z","type":"message"}
{"nick":"bnoordhuis_","message":"lost?","date":"2012-08-23T00:02:31.277Z","type":"message"}
{"nick":"joshthecoder","message":"B also has a weak callback. That seems to be getting called before A's.","date":"2012-08-23T00:03:12.388Z","type":"message"}
{"nick":"bnoordhuis_","message":"joshthecoder: are you reviving either A or B? if not, everything is working as expected","date":"2012-08-23T00:04:51.222Z","type":"message"}
{"nick":"joshthecoder","message":"bnoordhuis_: A should get revived in the weak callback.","date":"2012-08-23T00:05:07.591Z","type":"message"}
{"nick":"joshthecoder","message":"ClearWeak() should make that handle strong again right?","date":"2012-08-23T00:05:19.218Z","type":"message"}
{"nick":"joshthecoder","message":"I also call MarkIndependent() on each handle to improve GC performance. Otherwise V8 seems to only collect them during global GC.","date":"2012-08-23T00:05:58.490Z","type":"message"}
{"nick":"bnoordhuis_","message":"i think you need to call MakeWeak() again in order to revive it","date":"2012-08-23T00:06:22.889Z","type":"message"}
{"nick":"bnoordhuis_","message":"in your WeakCallback at least","date":"2012-08-23T00:06:45.739Z","type":"message"}
{"nick":"joshthecoder","message":"bnoordhuis_: hmmm. Will that alone make the handle strong again or will the callback get called again.","date":"2012-08-23T00:07:42.053Z","type":"message"}
{"nick":"joshthecoder","message":"It's odd this seems to work fine most of the time. Just running into an odd edge case.","date":"2012-08-23T00:08:20.173Z","type":"message"}
{"nick":"bnoordhuis_","message":"no, it remains weak. i think you need to call ClearWeak() outside the gc","date":"2012-08-23T00:08:33.273Z","type":"message"}
{"nick":"joshthecoder","message":"bnoordhuis_: thanks","date":"2012-08-23T00:17:36.552Z","type":"message"}
{"nick":"bnoordhuis_","reason":"Ping timeout: 240 seconds","date":"2012-08-23T00:39:34.373Z","type":"quit"}
{"nick":"joshthecoder","reason":"Quit: Leaving...","date":"2012-08-23T01:22:41.303Z","type":"quit"}
{"nick":"C-Man","reason":"Quit: Connection reset by beer","date":"2012-08-23T01:45:02.637Z","type":"quit"}
{"nick":"lohkey","date":"2012-08-23T02:40:13.073Z","type":"part"}
{"nick":"joshthecoder","date":"2012-08-23T03:16:07.954Z","type":"join"}
{"nick":"joshthecoder","reason":"Remote host closed the connection","date":"2012-08-23T04:33:40.322Z","type":"quit"}
{"nick":"joshthecoder","date":"2012-08-23T04:33:53.094Z","type":"join"}
{"nick":"joshthecoder","reason":"Read error: Connection reset by peer","date":"2012-08-23T05:07:31.151Z","type":"quit"}
{"nick":"joshthecoder","date":"2012-08-23T05:07:48.197Z","type":"join"}
{"nick":"lohkey","date":"2012-08-23T06:01:02.527Z","type":"join"}
{"nick":"lllk^","date":"2012-08-23T07:03:27.758Z","type":"join"}
{"nick":"lllk^","reason":"Client Quit","date":"2012-08-23T07:05:17.122Z","type":"quit"}
{"nick":"rendar","date":"2012-08-23T07:06:13.790Z","type":"join"}
{"nick":"lohkey","reason":"Read error: Connection reset by peer","date":"2012-08-23T07:27:22.953Z","type":"quit"}
