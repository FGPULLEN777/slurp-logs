{"nick":"Cube","reason":"Remote host closed the connection","date":"2016-08-28T02:03:21.859Z","type":"quit"}
{"nick":"zv","date":"2016-08-28T02:08:02.610Z","type":"join"}
{"nick":"bradleymeck","date":"2016-08-28T02:51:01.518Z","type":"join"}
{"nick":"mikolalysenko_","date":"2016-08-28T03:21:54.282Z","type":"join"}
{"nick":"Garbee_","date":"2016-08-28T03:25:14.034Z","type":"join"}
{"nick":"mikolalysenko","reason":"Ping timeout: 258 seconds","date":"2016-08-28T03:25:57.067Z","type":"quit"}
{"nick":"jochen__","reason":"Ping timeout: 258 seconds","date":"2016-08-28T03:25:57.760Z","type":"quit"}
{"nick":"scottmg","reason":"Ping timeout: 258 seconds","date":"2016-08-28T03:25:57.925Z","type":"quit"}
{"nick":"Garbee","reason":"Ping timeout: 258 seconds","date":"2016-08-28T03:25:58.668Z","type":"quit"}
{"nick":"seththompson","reason":"Ping timeout: 258 seconds","date":"2016-08-28T03:25:59.116Z","type":"quit"}
{"nick":"Martijnc","reason":"Ping timeout: 258 seconds","date":"2016-08-28T03:25:59.282Z","type":"quit"}
{"nick":"s1w","reason":"Ping timeout: 258 seconds","date":"2016-08-28T03:26:00.487Z","type":"quit"}
{"nick":"s1w","date":"2016-08-28T03:27:53.379Z","type":"join"}
{"nick":"mikolalysenko_","new_nick":"mikolalysenko","date":"2016-08-28T03:28:04.575Z","type":"nick"}
{"nick":"s1w","new_nick":"Guest22353","date":"2016-08-28T03:28:17.120Z","type":"nick"}
{"nick":"Garbee_","new_nick":"Garbee","date":"2016-08-28T03:30:28.545Z","type":"nick"}
{"nick":"seththompson","date":"2016-08-28T03:31:56.013Z","type":"join"}
{"nick":"jochen__","date":"2016-08-28T03:32:08.287Z","type":"join"}
{"nick":"scottmg","date":"2016-08-28T03:32:44.284Z","type":"join"}
{"nick":"Martijnc","date":"2016-08-28T03:34:36.436Z","type":"join"}
{"nick":"bradleymeck","reason":"Quit: bradleymeck","date":"2016-08-28T03:35:23.986Z","type":"quit"}
{"nick":"xaxxon","date":"2016-08-28T03:53:34.525Z","type":"join"}
{"nick":"xaxxon","message":"any issues with using FindInstanceInPrototypeChain when changing the prototype of an object after creation?","date":"2016-08-28T03:53:55.927Z","type":"message"}
{"nick":"xaxxon","message":"I'm getting no matches when I'm expecting one","date":"2016-08-28T03:54:10.344Z","type":"message"}
{"nick":"dostoyevsky","date":"2016-08-28T05:17:42.086Z","type":"join"}
{"nick":"dostoyevsky","message":" d->result = Array::New(d->isolate, 0); // is that going to free d->result?  I get an ``Allocation failed'' error after a while ","date":"2016-08-28T05:18:40.227Z","type":"message"}
{"nick":"dostoyevsky","message":"(always creating new d->result which are not that large individually )","date":"2016-08-28T05:20:28.536Z","type":"message"}
{"nick":"dostoyevsky","message":"Should I also generate a new isolate to get the GC going?","date":"2016-08-28T05:26:57.910Z","type":"message"}
{"nick":"xaxxon","message":"dostoyevsky, that will reduce the ref count on whatever d->result pointed to before, if anything","date":"2016-08-28T05:27:51.945Z","type":"message"}
{"nick":"xaxxon","message":"the GC won't run immedaitely because of it, most likely, though","date":"2016-08-28T05:28:13.711Z","type":"message"}
{"nick":"xaxxon","message":"GC is per-isolate... so I don't know what you mean by creating a new isolate to get GC going","date":"2016-08-28T05:28:33.764Z","type":"message"}
{"nick":"xaxxon","message":"an isolate is a completely independent interpreter and shares (virtually) nothing with other isolates","date":"2016-08-28T05:28:51.922Z","type":"message"}
{"nick":"xaxxon","message":"except for certain startup parameters, basically","date":"2016-08-28T05:29:02.871Z","type":"message"}
{"nick":"xaxxon","message":"not sure what your allocation failed error is.. are you making \"a lot\" of them?","date":"2016-08-28T05:29:28.255Z","type":"message"}
{"nick":"dostoyevsky","message":"xaxxon: Well, I create many tiny arrays and then call a callback... after calling the callback thousands of times, v8 crashes with \"Allocation error\"... the old arrays were never cleaned up... but nobody should be using them (reference counter should be 0)","date":"2016-08-28T05:30:00.887Z","type":"message"}
{"nick":"xaxxon","message":"you can run the GC manually.   I forget how but it's easy to find","date":"2016-08-28T05:30:40.539Z","type":"message"}
{"nick":"xaxxon","message":"dostoyevsky, ah, found it: *   while(!v8::Isolate::IdleNotificationDeadline([time])) {};                                                                                                ","date":"2016-08-28T05:31:39.881Z","type":"message"}
{"nick":"xaxxon","message":"I dunno what time is, but you can find it in the doxygen docs presumably","date":"2016-08-28T05:32:15.706Z","type":"message"}
{"nick":"xaxxon","message":"it's like floating point seconds or millis or something","date":"2016-08-28T05:32:23.751Z","type":"message"}
{"nick":"xaxxon","message":"maybe post the code for your callback somewhere and link it here?","date":"2016-08-28T05:33:28.503Z","type":"message"}
{"nick":"xaxxon","message":"also, I'm not the most knowledgable about v8... ","date":"2016-08-28T05:33:44.549Z","type":"message"}
{"nick":"xaxxon","message":"but as to one of your statements, you can see that the GC is called on the isolate object.. so a different isolate wouldn't have a related GC","date":"2016-08-28T05:35:17.809Z","type":"message"}
{"nick":"dostoyevsky","message":"xaxxon: yeah, I do not think running the gc is the problem...","date":"2016-08-28T05:35:27.077Z","type":"message"}
{"nick":"xaxxon","message":"is the \"allocation failed\" a v8 error or a system one?","date":"2016-08-28T05:35:54.923Z","type":"message"}
{"nick":"dostoyevsky","message":"Because you get this \"<--- Last few GCs --->\" error message","date":"2016-08-28T05:36:12.859Z","type":"message"}
{"nick":"xaxxon","message":"I have no idea what that is","date":"2016-08-28T05:36:27.416Z","type":"message"}
{"nick":"dostoyevsky","message":"226507 ms: Scavenge 1400.6 (1457.0) -> 1400.6 (1457.0) // 227789 ms: Mark-sweep 1400.6 (1457.0) -> 1398.5 (1457.0) MB // 229063 ms: Mark-sweep 1398.5 (1457.0) -> 1398.1 (1457.0) MB","date":"2016-08-28T05:36:46.860Z","type":"message"}
{"nick":"dostoyevsky","message":"So it ran but couldn't free anything","date":"2016-08-28T05:37:01.897Z","type":"message"}
{"nick":"dostoyevsky","message":"And then you get: FATAL ERROR: CALL_AND_RETRY_LAST Allocation failed - process out of memory","date":"2016-08-28T05:37:31.832Z","type":"message"}
{"nick":"xaxxon","message":"are you using promises?","date":"2016-08-28T05:37:44.658Z","type":"message"}
{"nick":"xaxxon","message":"if so: https://bugs.chromium.org/p/v8/issues/detail?id=4858","date":"2016-08-28T05:38:01.434Z","type":"message"}
{"nick":"xaxxon","message":"that link may be of interest (just skimmed it)","date":"2016-08-28T05:38:32.302Z","type":"message"}
{"nick":"xaxxon","message":"dostoyevsky, I'm curious what you find, though.  this place is usually pretty dead and I'm always trying ot learn more about v","date":"2016-08-28T05:42:52.818Z","type":"message"}
{"nick":"xaxxon","message":"8","date":"2016-08-28T05:42:53.510Z","type":"message"}
{"nick":"dostoyevsky","message":"And then there is this: https://github.com/katlogic/lv8/blob/344353dac702901c917a4c05438252121c527ab3/lv8.cpp#L755","date":"2016-08-28T05:43:27.389Z","type":"message"}
{"nick":"dostoyevsky","message":"> V8 keeps one instace stale for fast reuse. Allocate dummy one to force flush.","date":"2016-08-28T05:43:43.431Z","type":"message"}
{"nick":"dostoyevsky","message":"So I assume that I should change contexts regularly because the GC might ignore the current context and it is not meant to use it for such a long time, as I do","date":"2016-08-28T05:46:00.738Z","type":"message"}
{"nick":"xaxxon","message":"contexts are what have your functions in them, so you can't just \"switch\" them arbitrarily.   ","date":"2016-08-28T05:46:47.019Z","type":"message"}
{"nick":"xaxxon","message":"I mean, they get built with the templates you've set up","date":"2016-08-28T05:47:09.577Z","type":"message"}
{"nick":"xaxxon","message":"but bec areful.  ","date":"2016-08-28T05:47:14.522Z","type":"message"}
{"nick":"xaxxon","message":"I'd be surprised if the problem isn't something speific with your code, not that you're not playing the right games with v8","date":"2016-08-28T05:47:30.619Z","type":"message"}
{"nick":"xaxxon","message":"can you post the code you're running?","date":"2016-08-28T05:48:09.732Z","type":"message"}
{"nick":"dostoyevsky","message":"xaxxon: it's about 50k of C++ code... not sure if posting it might be helpful","date":"2016-08-28T05:49:35.172Z","type":"message"}
{"nick":"dostoyevsky","message":"xaxxon: but since you say that one isolate per function, then that's interesting... because I have a function with a callback... so that's actually two functions..  and I prepare the parameters for another function in v8 and then call the javascript callback... I could create a new isolate for each function call","date":"2016-08-28T05:51:58.019Z","type":"message"}
{"nick":"xaxxon","message":"I don't think I said what you said I said","date":"2016-08-28T05:52:29.251Z","type":"message"}
{"nick":"xaxxon","message":"and that sounds like a VERY slow way to do things","date":"2016-08-28T05:52:41.154Z","type":"message"}
{"nick":"xaxxon","message":"if you could isolate the memory issue to a smaller section of code, it could help -- both for your own sanity and for someone else to try to help","date":"2016-08-28T05:54:03.879Z","type":"message"}
{"nick":"dostoyevsky","message":"xaxxon: Isolate* isolate = Isolate::GetCurrent(); HandleScope scope(isolate); // that's quite cheap imho... I do it for each call into my v8 module","date":"2016-08-28T05:54:08.885Z","type":"message"}
{"nick":"xaxxon","message":"that's not creating a new isolate","date":"2016-08-28T05:54:26.973Z","type":"message"}
{"nick":"dostoyevsky","message":"oh...","date":"2016-08-28T05:54:33.841Z","type":"message"}
{"nick":"xaxxon","message":"that's getting the \"current\" one","date":"2016-08-28T05:54:40.617Z","type":"message"}
{"nick":"xaxxon","message":"v8::Isolate::New() creates a new one","date":"2016-08-28T05:55:20.099Z","type":"message"}
{"nick":"xaxxon","message":"v8 has a lot of state information in it.   You're requesting the isolate it is storing as the \"current\" one to be given back to you","date":"2016-08-28T05:56:12.739Z","type":"message"}
{"nick":"Guest22353","reason":"Changing host","date":"2016-08-28T06:03:15.856Z","type":"quit"}
{"nick":"Guest22353","date":"2016-08-28T06:03:16.051Z","type":"join"}
{"nick":"Guest22353","new_nick":"s1w","date":"2016-08-28T06:03:17.492Z","type":"nick"}
{"nick":"dostoyevsky","message":"xaxxon: I got it down to a few line of code","date":"2016-08-28T06:17:35.991Z","type":"message"}
{"nick":"xaxxon","message":"well, share share :)","date":"2016-08-28T06:19:09.188Z","type":"message"}
{"nick":"dostoyevsky","message":"http://ideone.com/clWSy1","date":"2016-08-28T06:20:48.597Z","type":"message"}
{"nick":"dostoyevsky","message":"That will just blow up... because result is never freed","date":"2016-08-28T06:21:00.790Z","type":"message"}
{"nick":"xaxxon","message":"and what if you put a GC call in there?","date":"2016-08-28T06:22:20.908Z","type":"message"}
{"nick":"xaxxon","message":"V8 isn't threaded behidn the scenes","date":"2016-08-28T06:22:29.526Z","type":"message"}
{"nick":"xaxxon","message":"so it won't GC in the middle of your calls","date":"2016-08-28T06:22:41.588Z","type":"message"}
{"nick":"xaxxon","message":"(I don't think)","date":"2016-08-28T06:23:02.848Z","type":"message"}
{"nick":"dostoyevsky","message":"xaxxon: Well, result is used for a javascript callback... so the GC should run there, no?","date":"2016-08-28T06:23:14.764Z","type":"message"}
{"nick":"xaxxon","message":"well, that's a lot of objects.   not sure it's supposed to work","date":"2016-08-28T06:23:57.261Z","type":"message"}
{"nick":"dostoyevsky","message":"http://ideone.com/clWSy1 <- I added the error message... you can see that the GC ran... with a heap size of (1457.0) MB","date":"2016-08-28T06:24:14.164Z","type":"message"}
{"nick":"xaxxon","message":"I see.   The limit for 64 bit V8 is around 1.9Gbytes now.  Start V8 with the","date":"2016-08-28T06:25:24.924Z","type":"message"}
{"nick":"xaxxon","message":"https://bugs.chromium.org/p/v8/issues/detail?id=847","date":"2016-08-28T06:25:31.260Z","type":"message"}
{"nick":"xaxxon","message":"that's a bit old, but maybe try that flag","date":"2016-08-28T06:25:50.443Z","type":"message"}
{"nick":"dostoyevsky","message":"xaxxon: I know that I could use more RAM but I just want an array with 100 elements in ram... not the whole dataset","date":"2016-08-28T06:26:48.344Z","type":"message"}
{"nick":"xaxxon","message":"dostoyevsky, please update your example with where you call the callback","date":"2016-08-28T06:27:34.580Z","type":"message"}
{"nick":"xaxxon","message":"otherwise I can't know what data you need when you try to call it","date":"2016-08-28T06:27:51.482Z","type":"message"}
{"nick":"xaxxon","message":"hrm, try this.. move the handlescope inside the first for loop","date":"2016-08-28T06:28:33.552Z","type":"message"}
{"nick":"xaxxon","message":"maybe it doesn't do reference counting when you overwrite a local","date":"2016-08-28T06:28:46.461Z","type":"message"}
{"nick":"xaxxon","message":"maybe it only does it when the handlescope goes away","date":"2016-08-28T06:28:52.486Z","type":"message"}
{"nick":"xaxxon","message":"something like this: http://ideone.com/WnZDCC","date":"2016-08-28T06:29:22.447Z","type":"message"}
{"nick":"dostoyevsky","message":"xaxxon: yeah!","date":"2016-08-28T06:31:20.081Z","type":"message"}
{"nick":"xaxxon","message":":-)","date":"2016-08-28T06:31:28.989Z","type":"message"}
{"nick":"xaxxon","message":"did it work?","date":"2016-08-28T06:31:32.605Z","type":"message"}
{"nick":"dostoyevsky","message":"xaxxon: yeah... no more memory leaks... ","date":"2016-08-28T06:31:43.042Z","type":"message"}
{"nick":"xaxxon","message":"yay.  it wasn't actually leaking it, though.  it was just crashing before it had a chance to clean up","date":"2016-08-28T06:31:58.008Z","type":"message"}
{"nick":"xaxxon","message":"well, I learend something","date":"2016-08-28T06:32:06.080Z","type":"message"}
{"nick":"xaxxon","message":"I thought Local worked more like Global... but alas they are much lighter weight","date":"2016-08-28T06:32:30.463Z","type":"message"}
{"nick":"dostoyevsky","message":"now I just need to figure out if I can call handlescope manually... as I am not using a C++ scope for handling the callbaks","date":"2016-08-28T06:32:33.223Z","type":"message"}
{"nick":"xaxxon","message":"you can't, but that shouldn't matter.    overwriting a variable in JS is different","date":"2016-08-28T06:33:06.120Z","type":"message"}
{"nick":"xaxxon","message":"that DOES affect it's GCability","date":"2016-08-28T06:33:12.896Z","type":"message"}
{"nick":"xaxxon","message":"I'm afraid you may have created a similar, but different problem with your code you posted","date":"2016-08-28T06:34:03.587Z","type":"message"}
{"nick":"xaxxon","message":"vs your actual use case","date":"2016-08-28T06:35:32.488Z","type":"message"}
{"nick":"xaxxon","reason":"Quit: xaxxon","date":"2016-08-28T06:43:45.608Z","type":"quit"}
{"nick":"xaxxon","date":"2016-08-28T06:44:00.576Z","type":"join"}
{"nick":"xaxxon","message":"wrong button","date":"2016-08-28T06:44:04.667Z","type":"message"}
{"nick":"wingo","reason":"Quit: ZNC 1.6.1+deb1 - http://znc.in","date":"2016-08-28T07:46:25.816Z","type":"quit"}
{"nick":"wingo","date":"2016-08-28T07:48:21.177Z","type":"join"}
